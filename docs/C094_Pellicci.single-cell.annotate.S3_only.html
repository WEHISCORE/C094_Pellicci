<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
  <title>C094: Annotating Pellicci gamma-delta T-cell single-cell dataset (S3 only)</title>



  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2021-09-07"/>
  <meta property="article:created" itemprop="dateCreated" content="2021-09-07"/>
  <meta name="article:author" content="William Ho"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="C094: Annotating Pellicci gamma-delta T-cell single-cell dataset (S3 only)"/>
  <meta property="og:type" content="article"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:site_name" content="C094"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="C094: Annotating Pellicci gamma-delta T-cell single-cell dataset (S3 only)"/>

  <!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=Bias, robustness and scalability in single-cell differential expression analysis;citation_publication_date=2018;citation_volume=15;citation_author=C. Soneson;citation_author=M. D. Robinson"/>
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","editor_options","bibliography"]}},"value":[{"type":"character","attributes":{},"value":["Annotating Pellicci gamma-delta T-cell single-cell dataset (S3 only)"]},{"type":"NULL"},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","affiliation_url"]}},"value":[{"type":"character","attributes":{},"value":["William Ho"]},{"type":"character","attributes":{},"value":["Single Cell Open Research Endeavour (SCORE), WEHI"]},{"type":"character","attributes":{},"value":["https://www.wehi.edu.au/people/rory-bowden/4536/wehi-advanced-genomics-facility"]}]}]},{"type":"character","attributes":{},"value":["2021-09-07"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["chunk_output_type"]}},"value":[{"type":"character","attributes":{},"value":["console"]}]},{"type":"character","attributes":{},"value":["ref.bib"]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  <!--radix_placeholder_navigation_in_header-->
  <meta name="distill:offset" content=""/>

  <script type="application/javascript">

    window.headroom_prevent_pin = false;

    window.document.addEventListener("DOMContentLoaded", function (event) {

      // initialize headroom for banner
      var header = $('header').get(0);
      var headerHeight = header.offsetHeight;
      var headroom = new Headroom(header, {
        tolerance: 5,
        onPin : function() {
          if (window.headroom_prevent_pin) {
            window.headroom_prevent_pin = false;
            headroom.unpin();
          }
        }
      });
      headroom.init();
      if(window.location.hash)
        headroom.unpin();
      $(header).addClass('headroom--transition');

      // offset scroll location for banner on hash change
      // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
      window.addEventListener("hashchange", function(event) {
        window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
      });

      // responsive menu
      $('.distill-site-header').each(function(i, val) {
        var topnav = $(this);
        var toggle = topnav.find('.nav-toggle');
        toggle.on('click', function() {
          topnav.toggleClass('responsive');
        });
      });

      // nav dropdowns
      $('.nav-dropbtn').click(function(e) {
        $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
        $(this).parent().siblings('.nav-dropdown')
           .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $("body").click(function(e){
        $('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $(".nav-dropdown").click(function(e){
        e.stopPropagation();
      });
    });
  </script>

  <style type="text/css">

  /* Theme (user-documented overrideables for nav appearance) */

  .distill-site-nav {
    color: rgba(255, 255, 255, 0.8);
    background-color: #0F2E3D;
    font-size: 15px;
    font-weight: 300;
  }

  .distill-site-nav a {
    color: inherit;
    text-decoration: none;
  }

  .distill-site-nav a:hover {
    color: white;
  }

  @media print {
    .distill-site-nav {
      display: none;
    }
  }

  .distill-site-header {

  }

  .distill-site-footer {

  }


  /* Site Header */

  .distill-site-header {
    width: 100%;
    box-sizing: border-box;
    z-index: 3;
  }

  .distill-site-header .nav-left {
    display: inline-block;
    margin-left: 8px;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header .nav-left {
      margin-left: 0;
    }
  }


  .distill-site-header .nav-right {
    float: right;
    margin-right: 8px;
  }

  .distill-site-header a,
  .distill-site-header .title {
    display: inline-block;
    text-align: center;
    padding: 14px 10px 14px 10px;
  }

  .distill-site-header .title {
    font-size: 18px;
    min-width: 150px;
  }

  .distill-site-header .logo {
    padding: 0;
  }

  .distill-site-header .logo img {
    display: none;
    max-height: 20px;
    width: auto;
    margin-bottom: -4px;
  }

  .distill-site-header .nav-image img {
    max-height: 18px;
    width: auto;
    display: inline-block;
    margin-bottom: -3px;
  }



  @media screen and (min-width: 1000px) {
    .distill-site-header .logo img {
      display: inline-block;
    }
    .distill-site-header .nav-left {
      margin-left: 20px;
    }
    .distill-site-header .nav-right {
      margin-right: 20px;
    }
    .distill-site-header .title {
      padding-left: 12px;
    }
  }


  .distill-site-header .nav-toggle {
    display: none;
  }

  .nav-dropdown {
    display: inline-block;
    position: relative;
  }

  .nav-dropdown .nav-dropbtn {
    border: none;
    outline: none;
    color: rgba(255, 255, 255, 0.8);
    padding: 16px 10px;
    background-color: transparent;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    margin: 0;
    margin-top: 1px;
    z-index: 2;
  }

  .nav-dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    min-width: 200px;
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 4px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
    z-index: 1;
    margin-top: 2px;
    white-space: nowrap;
    padding-top: 4px;
    padding-bottom: 4px;
  }

  .nav-dropdown-content hr {
    margin-top: 4px;
    margin-bottom: 4px;
    border: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .nav-dropdown-active {
    display: block;
  }

  .nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
    color: black;
    padding: 6px 24px;
    text-decoration: none;
    display: block;
    text-align: left;
  }

  .nav-dropdown-content .nav-dropdown-header {
    display: block;
    padding: 5px 24px;
    padding-bottom: 0;
    text-transform: uppercase;
    font-size: 14px;
    color: #999999;
    white-space: nowrap;
  }

  .nav-dropdown:hover .nav-dropbtn {
    color: white;
  }

  .nav-dropdown-content a:hover {
    background-color: #ddd;
    color: black;
  }

  .nav-right .nav-dropdown-content {
    margin-left: -45%;
    right: 0;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
    .distill-site-header a.nav-toggle {
      float: right;
      display: block;
    }
    .distill-site-header .title {
      margin-left: 0;
    }
    .distill-site-header .nav-right {
      margin-right: 0;
    }
    .distill-site-header {
      overflow: hidden;
    }
    .nav-right .nav-dropdown-content {
      margin-left: 0;
    }
  }


  @media screen and (max-width: 768px) {
    .distill-site-header.responsive {position: relative; min-height: 500px; }
    .distill-site-header.responsive a.nav-toggle {
      position: absolute;
      right: 0;
      top: 0;
    }
    .distill-site-header.responsive a,
    .distill-site-header.responsive .nav-dropdown {
      display: block;
      text-align: left;
    }
    .distill-site-header.responsive .nav-left,
    .distill-site-header.responsive .nav-right {
      width: 100%;
    }
    .distill-site-header.responsive .nav-dropdown {float: none;}
    .distill-site-header.responsive .nav-dropdown-content {position: relative;}
    .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
      display: block;
      width: 100%;
      text-align: left;
    }
  }

  /* Site Footer */

  .distill-site-footer {
    width: 100%;
    overflow: hidden;
    box-sizing: border-box;
    z-index: 3;
    margin-top: 30px;
    padding-top: 30px;
    padding-bottom: 30px;
    text-align: center;
  }

  /* Headroom */

  d-title {
    padding-top: 6rem;
  }

  @media print {
    d-title {
      padding-top: 4rem;
    }
  }

  .headroom {
    z-index: 1000;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
  }

  .headroom--transition {
    transition: all .4s ease-in-out;
  }

  .headroom--unpinned {
    top: -100px;
  }

  .headroom--pinned {
    top: 0;
  }

  /* adjust viewport for navbar height */
  /* helps vertically center bootstrap (non-distill) content */
  .min-vh-100 {
    min-height: calc(100vh - 100px) !important;
  }

  </style>

  <script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
  <link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
  <link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
  <script src="site_libs/headroom-0.9.4/headroom.min.js"></script>
  <script src="site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
  <script src="site_libs/fuse-6.4.1/fuse.min.js"></script>

  <script type="application/javascript">

  function getMeta(metaName) {
    var metas = document.getElementsByTagName('meta');
    for (let i = 0; i < metas.length; i++) {
      if (metas[i].getAttribute('name') === metaName) {
        return metas[i].getAttribute('content');
      }
    }
    return '';
  }

  function offsetURL(url) {
    var offset = getMeta('distill:offset');
    return offset ? offset + '/' + url : url;
  }

  function createFuseIndex() {

    // create fuse index
    var options = {
      keys: [
        { name: 'title', weight: 20 },
        { name: 'categories', weight: 15 },
        { name: 'description', weight: 10 },
        { name: 'contents', weight: 5 },
      ],
      ignoreLocation: true,
      threshold: 0
    };
    var fuse = new window.Fuse([], options);

    // fetch the main search.json
    return fetch(offsetURL('search.json'))
      .then(function(response) {
        if (response.status == 200) {
          return response.json().then(function(json) {
            // index main articles
            json.articles.forEach(function(article) {
              fuse.add(article);
            });
            // download collections and index their articles
            return Promise.all(json.collections.map(function(collection) {
              return fetch(offsetURL(collection)).then(function(response) {
                if (response.status === 200) {
                  return response.json().then(function(articles) {
                    articles.forEach(function(article) {
                      fuse.add(article);
                    });
                  })
                } else {
                  return Promise.reject(
                    new Error('Unexpected status from search index request: ' +
                              response.status)
                  );
                }
              });
            })).then(function() {
              return fuse;
            });
          });

        } else {
          return Promise.reject(
            new Error('Unexpected status from search index request: ' +
                        response.status)
          );
        }
      });
  }

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // get search element (bail if we don't have one)
    var searchEl = window.document.getElementById('distill-search');
    if (!searchEl)
      return;

    createFuseIndex()
      .then(function(fuse) {

        // make search box visible
        searchEl.classList.remove('hidden');

        // initialize autocomplete
        var options = {
          autoselect: true,
          hint: false,
          minLength: 2,
        };
        window.autocomplete(searchEl, options, [{
          source: function(query, callback) {
            const searchOptions = {
              isCaseSensitive: false,
              shouldSort: true,
              minMatchCharLength: 2,
              limit: 10,
            };
            var results = fuse.search(query, searchOptions);
            callback(results
              .map(function(result) { return result.item; })
            );
          },
          templates: {
            suggestion: function(suggestion) {
              var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
                ? `<img src="${offsetURL(suggestion.preview)}"</img>`
                : '';
              var html = `
                <div class="search-item">
                  <h3>${suggestion.title}</h3>
                  <div class="search-item-description">
                    ${suggestion.description || ''}
                  </div>
                  <div class="search-item-preview">
                    ${img}
                  </div>
                </div>
              `;
              return html;
            }
          }
        }]).on('autocomplete:selected', function(event, suggestion) {
          window.location.href = offsetURL(suggestion.path);
        });
        // remove inline display style on autocompleter (we want to
        // manage responsive display via css)
        $('.algolia-autocomplete').css("display", "");
      })
      .catch(function(error) {
        console.log(error);
      });

  });

  </script>

  <style type="text/css">

  .nav-search {
    font-size: x-small;
  }

  /* Algolioa Autocomplete */

  .algolia-autocomplete {
    display: inline-block;
    margin-left: 10px;
    vertical-align: sub;
    background-color: white;
    color: black;
    padding: 6px;
    padding-top: 8px;
    padding-bottom: 0;
    border-radius: 6px;
    border: 1px #0F2E3D solid;
    width: 180px;
  }


  @media screen and (max-width: 768px) {
    .distill-site-nav .algolia-autocomplete {
      display: none;
      visibility: hidden;
    }
    .distill-site-nav.responsive .algolia-autocomplete {
      display: inline-block;
      visibility: visible;
    }
    .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
      margin-left: 0;
      width: 400px;
      max-height: 400px;
    }
  }

  .algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
    width: 90%;
    outline: none;
    border: none;
  }

  .algolia-autocomplete .aa-hint {
    color: #999;
  }
  .algolia-autocomplete .aa-dropdown-menu {
    width: 550px;
    max-height: 70vh;
    overflow-x: visible;
    overflow-y: scroll;
    padding: 5px;
    margin-top: 3px;
    margin-left: -150px;
    background-color: #fff;
    border-radius: 5px;
    border: 1px solid #999;
    border-top: none;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
    cursor: pointer;
    padding: 5px 4px;
    border-bottom: 1px solid #eee;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
    border-bottom: none;
    margin-bottom: 2px;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
    overflow: hidden;
    font-size: 0.8em;
    line-height: 1.4em;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
    font-size: 1rem;
    margin-block-start: 0;
    margin-block-end: 5px;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
    display: inline-block;
    overflow: hidden;
    height: 2.8em;
    width: 80%;
    margin-right: 4%;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
    display: inline-block;
    width: 15%;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
    height: 3em;
    width: auto;
    display: none;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
    display: initial;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
    background-color: #eee;
  }
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
    font-weight: bold;
    font-style: normal;
  }

  </style>


  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refHtml = $('#ref-' + $(this).attr('data-cites')).html();
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="site_libs/header-attrs-2.7/header-attrs.js"></script>
  <link href="site_libs/panelset-0.2.6/panelset.css" rel="stylesheet" />
  <script src="site_libs/panelset-0.2.6/panelset.js"></script>
  <script src="site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Annotating Pellicci gamma-delta T-cell single-cell dataset (S3 only)","authors":[{"author":"William Ho","authorURL":"#","affiliation":"Single Cell Open Research Endeavour (SCORE), WEHI","affiliationURL":"https://www.wehi.edu.au/people/rory-bowden/4536/wehi-advanced-genomics-facility","orcidID":""}],"publishedDate":"2021-09-07T00:00:00.000+10:00","citationText":"Ho, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="index.html" class="title">C094</a>
<a href="index.html">Introduction</a>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Preprocessing
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="C094_Pellicci.single-cell.preprocess.html">Single cell</a>
<a href="C094_Pellicci.mini-bulk.preprocess.html">Mini bulk</a>
</div>
</div>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Selecting biologically relevant cells
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="C094_Pellicci.single-cell.cell_selection.html">Single cell</a>
</div>
</div>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Merging cells
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="C094_Pellicci.single-cell.merge.whole_cell.html">Single cell (whole cell)</a>
<a href="C094_Pellicci.single-cell.merge.S1_S2_only.html">Single cell (S1 and S2 only)</a>
<a href="C094_Pellicci.single-cell.merge.S3_only.html">Single cell (S3 only)</a>
<a href="C094_Pellicci.single-cell.merge.thymus_only.html">Single cell (thymus only)</a>
<a href="C094_Pellicci.single-cell.merge.thymusS1_thymusS2_only.html">Single cell (thymus.S1 and thymus.S2 only)</a>
</div>
</div>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Annotating cells
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="C094_Pellicci.single-cell.annotate.whole_cell.html">Single cell (whole cell)</a>
<a href="C094_Pellicci.single-cell.annotate.S1_S2_only.html">Single cell (S1 and S2 only)</a>
<a href="C094_Pellicci.single-cell.annotate.S3_only.html">Single cell (S3 only)</a>
<a href="C094_Pellicci.single-cell.annotate.thymus_only.html">Single cell (thymus only)</a>
<a href="C094_Pellicci.single-cell.annotate.thymusS1_thymusS2_only.html">Single cell (thymus.S1 and thymus.S2 only)</a>
</div>
</div>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Mini-bulk differential analyses
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="C094_Pellicci.mini-bulk.multi-sample_comparisons.all_samples.html">All samples</a>
<a href="C094_Pellicci.mini-bulk.multi-sample_comparisons.excluding_blood_1-3.html">Excluding Blood.1 - Blood.3</a>
<a href="C094_Pellicci.mini-bulk.multi-sample_comparisons.excluding_donors_1-3.html">Excluding donors 1-3</a>
</div>
</div>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Supplementary files
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="../output/scPipe/">scPipe reports</a>
<a href="../output/DEGs/">Differentially expressed genes</a>
<a href="../output/glimma-plots/">Glimma plots</a>
</div>
</div>
</div>
<div class="nav-right">
<a href="https://github.com/WEHISCORE/C094_Pellicci">
<i class="fa fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Annotating Pellicci gamma-delta T-cell single-cell dataset (S3 only)</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->

</div>

<div class="d-byline">
  William Ho  (Single Cell Open Research Endeavour (SCORE), WEHI)<a href="https://www.wehi.edu.au/people/rory-bowden/4536/wehi-advanced-genomics-facility" class="uri">https://www.wehi.edu.au/people/rory-bowden/4536/wehi-advanced-genomics-facility</a>
  
<br/>2021-09-07
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#preparing-the-data">Preparing the data</a></li>
<li><a href="#re-clustering">Re-clustering</a></li>
<li><a href="#data-overview">Data overview</a></li>
<li><a href="#marker-gene-detection">Marker gene detection</a>
<ul>
<li><a href="#cluster-9-vs.-10-vs.-11-vs.-12">Cluster <code>9</code> vs. <code>10</code> vs. <code>11</code> vs. <code>12</code></a></li>
<li><a href="#selected-pairwise-comparisons">Selected pairwise comparisons</a></li>
<li><a href="#selected-pairwise-comparisons---integrated">Selected pairwise comparisons - integrated</a></li>
<li><a href="#supplemental-info">Supplemental info</a>
<ul>
<li><a href="#comparison-of-key-marker-expression-by-clusters">Comparison of key marker expression by clusters</a></li>
<li><a href="#expression-of-minibulk-de-in-the-single-cell-dataset">Expression of minibulk DE in the single-cell dataset</a></li>
</ul></li>
</ul></li>
<li><a href="#session-info">Session info</a></li>
</ul>
</nav>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>SingleCellExperiment</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://here.r-lib.org/'>here</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://bioconductor.org/packages/scater/'>scater</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>scran</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggplot2.tidyverse.org'>ggplot2</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://wilkelab.org/cowplot/'>cowplot</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://bioinf.wehi.edu.au/edgeR'>edgeR</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/hasaru-k/GlimmaV2'>Glimma</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/Bioconductor/BiocParallel'>BiocParallel</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://patchwork.data-imaginist.com'>patchwork</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/sfirke/janitor'>janitor</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>pheatmap</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>batchelor</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/rstudio/rmarkdown'>rmarkdown</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/Bioconductor/BiocStyle'>BiocStyle</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://readxl.tidyverse.org'>readxl</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://dplyr.tidyverse.org'>dplyr</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyr.tidyverse.org'>tidyr</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/slowkow/ggrepel'>ggrepel</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://magrittr.tidyverse.org'>magrittr</a></span><span class='op'>)</span>

<span class='fu'>knitr</span><span class='fu'>::</span><span class='va'><a href='https://rdrr.io/pkg/knitr/man/opts_chunk.html'>opts_chunk</a></span><span class='op'>$</span><span class='fu'>set</span><span class='op'>(</span>fig.path <span class='op'>=</span> <span class='st'>"C094_Pellicci.single-cell.annotate.S3_only_files/"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<h1 id="preparing-the-data">Preparing the data</h1>
<p>We start from the cell selected <em>SingleCellExperiment</em> object created in <a href="C094_Pellicci.single-cell.merge.S3_only.html">‘Merging cells for Pellicci gamma-delta T-cell dataset (S3 only)’</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sce</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>readRDS</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"SCEs"</span>, <span class='st'>"C094_Pellicci.single-cell.merged.S3_only.SCE.rds"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># pre-create directories for saving export, or error (dir not exists)</span>
<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span><span class='op'>)</span>, recursive <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"output"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span><span class='op'>)</span>, recursive <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='co'># Some useful colours</span>
<span class='va'>plate_number_colours</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/setNames.html'>setNames</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>$</span><span class='va'>colours</span><span class='op'>$</span><span class='va'>plate_number_colours</span><span class='op'>)</span>,
  <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>$</span><span class='va'>colours</span><span class='op'>$</span><span class='va'>plate_number_colours</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>plate_number_colours</span> <span class='op'>&lt;-</span> <span class='va'>plate_number_colours</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>$</span><span class='va'>plate_number</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>tissue_colours</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/setNames.html'>setNames</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>$</span><span class='va'>colours</span><span class='op'>$</span><span class='va'>tissue_colours</span><span class='op'>)</span>,
  <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>$</span><span class='va'>colours</span><span class='op'>$</span><span class='va'>tissue_colours</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>tissue_colours</span> <span class='op'>&lt;-</span> <span class='va'>tissue_colours</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>$</span><span class='va'>tissue</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>donor_colours</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/setNames.html'>setNames</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>$</span><span class='va'>colours</span><span class='op'>$</span><span class='va'>donor_colours</span><span class='op'>)</span>,
  <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>$</span><span class='va'>colours</span><span class='op'>$</span><span class='va'>donor_colours</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>donor_colours</span> <span class='op'>&lt;-</span> <span class='va'>donor_colours</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>$</span><span class='va'>donor</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>stage_colours</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/setNames.html'>setNames</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>$</span><span class='va'>colours</span><span class='op'>$</span><span class='va'>stage_colours</span><span class='op'>)</span>,
  <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>$</span><span class='va'>colours</span><span class='op'>$</span><span class='va'>stage_colours</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>stage_colours</span> <span class='op'>&lt;-</span> <span class='va'>stage_colours</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>$</span><span class='va'>stage</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>group_colours</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/setNames.html'>setNames</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>$</span><span class='va'>colours</span><span class='op'>$</span><span class='va'>group_colours</span><span class='op'>)</span>,
  <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>$</span><span class='va'>colours</span><span class='op'>$</span><span class='va'>group_colours</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>group_colours</span> <span class='op'>&lt;-</span> <span class='va'>group_colours</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>$</span><span class='va'>group</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>cluster_colours</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/setNames.html'>setNames</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>$</span><span class='va'>colours</span><span class='op'>$</span><span class='va'>cluster_colours</span><span class='op'>)</span>,
  <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>$</span><span class='va'>colours</span><span class='op'>$</span><span class='va'>cluster_colours</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>cluster_colours</span> <span class='op'>&lt;-</span> <span class='va'>cluster_colours</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>$</span><span class='va'>cluster</span><span class='op'>)</span><span class='op'>]</span>

<span class='co'># Some useful gene sets</span>
<span class='va'>mito_set</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>)</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/any.html'>any</a></span><span class='op'>(</span><span class='fu'>rowData</span><span class='op'>(</span><span class='va'>sce</span><span class='op'>)</span><span class='op'>$</span><span class='va'>ENSEMBL.SEQNAME</span> <span class='op'>==</span> <span class='st'>"MT"</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>ribo_set</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span><span class='op'>(</span><span class='st'>"^RP(S|L)"</span>, <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>)</span>, value <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='co'># NOTE: A more curated approach for identifying ribosomal protein genes</span>
<span class='co'>#       (https://github.com/Bioconductor/OrchestratingSingleCellAnalysis-base/blob/ae201bf26e3e4fa82d9165d8abf4f4dc4b8e5a68/feature-selection.Rmd#L376-L380)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://igordot.github.io/msigdbr'>msigdbr</a></span><span class='op'>)</span>
<span class='va'>c2_sets</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://igordot.github.io/msigdbr/reference/msigdbr.html'>msigdbr</a></span><span class='op'>(</span>species <span class='op'>=</span> <span class='st'>"Homo sapiens"</span>, category <span class='op'>=</span> <span class='st'>"C2"</span><span class='op'>)</span>
<span class='va'>ribo_set</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>union</a></span><span class='op'>(</span>
  <span class='va'>ribo_set</span>,
  <span class='va'>c2_sets</span><span class='op'>[</span><span class='va'>c2_sets</span><span class='op'>$</span><span class='va'>gs_name</span> <span class='op'>==</span> <span class='st'>"KEGG_RIBOSOME"</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>gene_symbol</span><span class='op'>)</span>
<span class='va'>ribo_set</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>intersect</a></span><span class='op'>(</span><span class='va'>ribo_set</span>, <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>sex_set</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>)</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/any.html'>any</a></span><span class='op'>(</span><span class='fu'>rowData</span><span class='op'>(</span><span class='va'>sce</span><span class='op'>)</span><span class='op'>$</span><span class='va'>ENSEMBL.SEQNAME</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"X"</span>, <span class='st'>"Y"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>pseudogene_set</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>)</span><span class='op'>[</span>
  <span class='fu'><a href='https://rdrr.io/r/base/any.html'>any</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span><span class='op'>(</span><span class='st'>"pseudogene"</span>, <span class='fu'>rowData</span><span class='op'>(</span><span class='va'>sce</span><span class='op'>)</span><span class='op'>$</span><span class='va'>ENSEMBL.GENEBIOTYPE</span><span class='op'>)</span><span class='op'>)</span><span class='op'>]</span>
<span class='co'># NOTE: not suggest to narrow down into protein coding genes (pcg) as it remove all significant candidate in most of the comparison !!!</span>
<span class='va'>protein_coding_gene_set</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>)</span><span class='op'>[</span>
  <span class='fu'><a href='https://rdrr.io/r/base/any.html'>any</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span><span class='op'>(</span><span class='st'>"protein_coding"</span>, <span class='fu'>rowData</span><span class='op'>(</span><span class='va'>sce</span><span class='op'>)</span><span class='op'>$</span><span class='va'>ENSEMBL.GENEBIOTYPE</span><span class='op'>)</span><span class='op'>)</span><span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># include part of the FACS data (for plot of heatmap)</span>
<span class='va'>facs</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='fu'>assays</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/SingleCellExperiment/man/altExps.html'>altExp</a></span><span class='op'>(</span><span class='va'>sce</span>, <span class='st'>"FACS"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>$</span><span class='va'>pseudolog</span><span class='op'>)</span>
<span class='va'>facs_markers</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span><span class='op'>(</span><span class='st'>"V525_50_A_CD4_BV510|B530_30_A_CD161_FITC"</span>, <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>facs</span><span class='op'>)</span>, value <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='va'>facs_selected</span> <span class='op'>&lt;-</span> <span class='va'>facs</span><span class='op'>[</span>,<span class='va'>facs_markers</span><span class='op'>]</span>
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>facs_selected</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD161"</span>, <span class='st'>"CD4"</span><span class='op'>)</span>
<span class='fu'>colData</span><span class='op'>(</span><span class='va'>sce</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/edgeR/man/cbind.html'>cbind</a></span><span class='op'>(</span><span class='fu'>colData</span><span class='op'>(</span><span class='va'>sce</span><span class='op'>)</span>, <span class='va'>facs_selected</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<h1 id="re-clustering">Re-clustering</h1>
<p><strong>NOTE</strong>: Based on our explorative data analyses (EDA) on the <strong>S3 only subset</strong>, we conclude the optimal number of clusters for demonstrating the heterogeneity of the dataset, we therefore re-cluster in here. Also, as indicated by Dan during our online meeting on 11 Aug 2011, we need to use different numbering and colouring for clusters in different subsets of the dataset (to prepare for publication), we perform all these by the following script.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># re-clustering</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>4759</span><span class='op'>)</span>
<span class='va'>snn_gr</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scran/man/buildSNNGraph.html'>buildSNNGraph</a></span><span class='op'>(</span><span class='va'>sce</span>, use.dimred <span class='op'>=</span> <span class='st'>"corrected"</span>, k<span class='op'>=</span><span class='fl'>20</span><span class='op'>)</span>
<span class='va'>clusters</span> <span class='op'>&lt;-</span> <span class='fu'>igraph</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/igraph/man/cluster_louvain.html'>cluster_louvain</a></span><span class='op'>(</span><span class='va'>snn_gr</span><span class='op'>)</span>
<span class='va'>sce</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>clusters</span><span class='op'>$</span><span class='va'>membership</span><span class='op'>)</span>

<span class='co'># re-numbering of clusters</span>
<span class='va'>sce</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span>
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"1"</span> <span class='op'>~</span> <span class='st'>"9"</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"2"</span> <span class='op'>~</span> <span class='st'>"10"</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"3"</span> <span class='op'>~</span> <span class='st'>"11"</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"4"</span> <span class='op'>~</span> <span class='st'>"12"</span><span class='op'>)</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"9"</span>, <span class='st'>"10"</span>, <span class='st'>"11"</span>, <span class='st'>"12"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># re-colouring of clusters</span>
<span class='va'>cluster_colours</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/setNames.html'>setNames</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/grDevices/palette.html'>palette.colors</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nlevels.html'>nlevels</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>$</span><span class='va'>cluster</span><span class='op'>)</span>, <span class='st'>"Tableau"</span><span class='op'>)</span>,
  <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>$</span><span class='va'>cluster</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<p>After the re-clustering, there are 4 clusters for <strong>S3 only subset</strong> of the dataset.</p>
<h1 id="data-overview">Data overview</h1>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>p1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotReducedDim.html'>plotReducedDim</a></span><span class='op'>(</span><span class='va'>sce</span>, <span class='st'>"UMAP_corrected"</span>, colour_by <span class='op'>=</span> <span class='st'>"cluster"</span>, theme_size <span class='op'>=</span> <span class='fl'>7</span>, point_size <span class='op'>=</span> <span class='fl'>0.4</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_colour_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>cluster_colours</span>, name <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span>
<span class='va'>p2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotReducedDim.html'>plotReducedDim</a></span><span class='op'>(</span><span class='va'>sce</span>, <span class='st'>"UMAP_corrected"</span>, colour_by <span class='op'>=</span> <span class='st'>"stage"</span>, theme_size <span class='op'>=</span> <span class='fl'>7</span>, point_size <span class='op'>=</span> <span class='fl'>0.4</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_colour_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>stage_colours</span>, name <span class='op'>=</span> <span class='st'>"stage"</span><span class='op'>)</span>
<span class='va'>p3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotReducedDim.html'>plotReducedDim</a></span><span class='op'>(</span><span class='va'>sce</span>, <span class='st'>"UMAP_corrected"</span>, colour_by <span class='op'>=</span> <span class='st'>"plate_number"</span>, theme_size <span class='op'>=</span> <span class='fl'>7</span>, point_size <span class='op'>=</span> <span class='fl'>0.4</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_colour_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>plate_number_colours</span>, name <span class='op'>=</span> <span class='st'>"plate_number"</span><span class='op'>)</span>
<span class='va'>p4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotReducedDim.html'>plotReducedDim</a></span><span class='op'>(</span><span class='va'>sce</span>, <span class='st'>"UMAP_corrected"</span>, colour_by <span class='op'>=</span> <span class='st'>"tissue"</span>, theme_size <span class='op'>=</span> <span class='fl'>7</span>, point_size <span class='op'>=</span> <span class='fl'>0.4</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_colour_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>tissue_colours</span>, name <span class='op'>=</span> <span class='st'>"tissue"</span><span class='op'>)</span>
<span class='va'>p5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotReducedDim.html'>plotReducedDim</a></span><span class='op'>(</span><span class='va'>sce</span>, <span class='st'>"UMAP_corrected"</span>, colour_by <span class='op'>=</span> <span class='st'>"donor"</span>, theme_size <span class='op'>=</span> <span class='fl'>7</span>, point_size <span class='op'>=</span> <span class='fl'>0.4</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_colour_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>donor_colours</span>, name <span class='op'>=</span> <span class='st'>"donor"</span><span class='op'>)</span>
<span class='va'>p6</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotReducedDim.html'>plotReducedDim</a></span><span class='op'>(</span><span class='va'>sce</span>, <span class='st'>"UMAP_corrected"</span>, colour_by <span class='op'>=</span> <span class='st'>"group"</span>, theme_size <span class='op'>=</span> <span class='fl'>7</span>, point_size <span class='op'>=</span> <span class='fl'>0.4</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_colour_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>group_colours</span>, name <span class='op'>=</span> <span class='st'>"group"</span><span class='op'>)</span>
<span class='op'>(</span><span class='va'>p1</span> <span class='op'>|</span> <span class='va'>p2</span><span class='op'>)</span> <span class='op'>/</span> <span class='op'>(</span><span class='va'>p3</span> <span class='op'>|</span> <span class='va'>p4</span><span class='op'>)</span> <span class='op'>/</span> <span class='op'>(</span><span class='va'>p5</span> <span class='op'>|</span> <span class='va'>p6</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span id="fig:clusterplot-umap"></span>
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/clusterplot-umap-1.png" alt="UMAP plot, where each point represents a cell and is coloured according to the legend." width="624" />
<p class="caption">
Figure 1: UMAP plot, where each point represents a cell and is coloured according to the legend.
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># summary - stacked barplot</span>
<span class='va'>p1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scater/man/ggsce.html'>ggcells</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_bar.html'>geom_bar</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>cluster</span>, fill <span class='op'>=</span> <span class='va'>cluster</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_flip.html'>coord_flip</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ylab</a></span><span class='op'>(</span><span class='st'>"Number of samples"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://wilkelab.org/cowplot/reference/theme_cowplot.html'>theme_cowplot</a></span><span class='op'>(</span>font_size <span class='op'>=</span> <span class='fl'>8</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>cluster_colours</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span>stat<span class='op'>=</span><span class='st'>'count'</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>cluster</span>, label<span class='op'>=</span><span class='va'>..count..</span><span class='op'>)</span>, hjust<span class='op'>=</span><span class='fl'>1.5</span>, size<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span>
<span class='va'>p2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scater/man/ggsce.html'>ggcells</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_bar.html'>geom_bar</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>cluster</span>, fill <span class='op'>=</span> <span class='va'>stage</span><span class='op'>)</span>,
    position <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/position_stack.html'>position_fill</a></span><span class='op'>(</span>reverse <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_flip.html'>coord_flip</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ylab</a></span><span class='op'>(</span><span class='st'>"Frequency"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>stage_colours</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://wilkelab.org/cowplot/reference/theme_cowplot.html'>theme_cowplot</a></span><span class='op'>(</span>font_size <span class='op'>=</span> <span class='fl'>8</span><span class='op'>)</span>
<span class='va'>p3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scater/man/ggsce.html'>ggcells</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_bar.html'>geom_bar</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>cluster</span>, fill <span class='op'>=</span> <span class='va'>plate_number</span><span class='op'>)</span>,
    position <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/position_stack.html'>position_fill</a></span><span class='op'>(</span>reverse <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_flip.html'>coord_flip</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ylab</a></span><span class='op'>(</span><span class='st'>"Frequency"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://wilkelab.org/cowplot/reference/theme_cowplot.html'>theme_cowplot</a></span><span class='op'>(</span>font_size <span class='op'>=</span> <span class='fl'>8</span><span class='op'>)</span>
<span class='va'>p4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scater/man/ggsce.html'>ggcells</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_bar.html'>geom_bar</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>cluster</span>, fill <span class='op'>=</span> <span class='va'>tissue</span><span class='op'>)</span>,
    position <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/position_stack.html'>position_fill</a></span><span class='op'>(</span>reverse <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_flip.html'>coord_flip</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ylab</a></span><span class='op'>(</span><span class='st'>"Frequency"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>tissue_colours</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://wilkelab.org/cowplot/reference/theme_cowplot.html'>theme_cowplot</a></span><span class='op'>(</span>font_size <span class='op'>=</span> <span class='fl'>8</span><span class='op'>)</span>
<span class='va'>p5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scater/man/ggsce.html'>ggcells</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_bar.html'>geom_bar</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>cluster</span>, fill <span class='op'>=</span> <span class='va'>donor</span><span class='op'>)</span>,
    position <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/position_stack.html'>position_fill</a></span><span class='op'>(</span>reverse <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_flip.html'>coord_flip</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ylab</a></span><span class='op'>(</span><span class='st'>"Frequency"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>donor_colours</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://wilkelab.org/cowplot/reference/theme_cowplot.html'>theme_cowplot</a></span><span class='op'>(</span>font_size <span class='op'>=</span> <span class='fl'>8</span><span class='op'>)</span>
<span class='va'>p6</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scater/man/ggsce.html'>ggcells</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_bar.html'>geom_bar</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>cluster</span>, fill <span class='op'>=</span> <span class='va'>group</span><span class='op'>)</span>,
    position <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/position_stack.html'>position_fill</a></span><span class='op'>(</span>reverse <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_flip.html'>coord_flip</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ylab</a></span><span class='op'>(</span><span class='st'>"Frequency"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>group_colours</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://wilkelab.org/cowplot/reference/theme_cowplot.html'>theme_cowplot</a></span><span class='op'>(</span>font_size <span class='op'>=</span> <span class='fl'>8</span><span class='op'>)</span>
<span class='op'>(</span><span class='va'>p1</span> <span class='op'>|</span> <span class='va'>p2</span><span class='op'>)</span> <span class='op'>/</span> <span class='op'>(</span><span class='va'>p3</span> <span class='op'>|</span> <span class='va'>p4</span><span class='op'>)</span> <span class='op'>/</span> <span class='op'>(</span><span class='va'>p5</span> <span class='op'>|</span> <span class='va'>p6</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span id="fig:cluster-barplot"></span>
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/cluster-barplot-1.png" alt="Breakdown of clusters by experimental factors." width="624" />
<p class="caption">
Figure 2: Breakdown of clusters by experimental factors.
</p>
</div>
</div>
<p><strong>NOTE</strong>: Considering the fact that SingleR with use of the annotation reference (Monaco Immune Cell Data) most relevant to the gamma-delta T cells (even annotated at <code>cell</code> level) could not further sub-classify the developmental stage/subtype of them (either annotating cluster as <code>Th1 cell</code>-/<code>Naive CD8</code>/<code>CD4 T cell</code> or <code>Vd2gd T cells</code>-alike) [ref: EDA_annotation_SingleR_MI_fine_cell_level.R], we decide to characterize the clusters by manual detection and curation of specific marker genes directly.</p>
<h1 id="marker-gene-detection">Marker gene detection</h1>
<p>To interpret our clustering results, we identify the genes that drive separation between clusters. These marker genes allow us to assign biological meaning to each cluster based on their functional annotation. In the most obvious case, the marker genes for each cluster are <em>a priori</em> associated with particular cell types, allowing us to treat the clustering as a proxy for cell type identity. The same principle can be applied to more subtle differences in activation status or differentiation state.</p>
<p>Identification of marker genes is usually based around the retrospective detection of differential expression between clusters<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. Genes that are more strongly DE are more likely to have driven cluster separation in the first place. The top DE genes are likely to be good candidate markers as they can effectively distinguish between cells in different clusters.</p>
<p>The Welch <em>t</em>-test is an obvious choice of statistical method to test for differences in expression between clusters. It is quickly computed and has good statistical properties for large numbers of cells <span class="citation" data-cites="soneson2018bias">(<a href="#ref-soneson2018bias" role="doc-biblioref">Soneson and Robinson 2018</a>)</span>.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># block on plate</span>
<span class='va'>sce</span><span class='op'>$</span><span class='va'>block</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>$</span><span class='va'>plate_number</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<h2 id="cluster-9-vs.-10-vs.-11-vs.-12">Cluster <code>9</code> vs. <code>10</code> vs. <code>11</code> vs. <code>12</code></h2>
<p>Here we look for the unique up-regulated markers of each cluster when compared to the all remaining ones. For instance, unique markers of cluster <code>9</code> refer to the genes significantly up-regulated in <strong>all</strong> of these comparisons: cluster <code>10</code> vs. <code>9</code> <strong>and</strong> cluster <code>11</code> vs. <code>9</code> <strong>and</strong> cluster <code>12</code> vs. <code>9</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>###################################</span>
<span class='co'># (M1) raw unique</span>
<span class='co'>#</span>
<span class='co'># cluster 9 (i.e. S3.mix.more.thymus.1) </span>
<span class='co'># cluster 10 (i.e. S3.mix.more.thymus.2) </span>
<span class='co'># cluster 11 (i.e. S3.mix.more.thymus.3)</span>
<span class='co'># cluster 12 (i.e. S3.mix.more.thymus.4.center)</span>

<span class='co'># find unique DE ./. clusters</span>
<span class='va'>uniquely_up</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scran/man/findMarkers.html'>findMarkers</a></span><span class='op'>(</span>
  <span class='va'>sce</span>,
  groups <span class='op'>=</span> <span class='va'>sce</span><span class='op'>$</span><span class='va'>cluster</span>,
  block <span class='op'>=</span> <span class='va'>sce</span><span class='op'>$</span><span class='va'>block</span>,
  pval.type <span class='op'>=</span> <span class='st'>"all"</span>,
  direction <span class='op'>=</span> <span class='st'>"up"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># export DGE lists</span>
<span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span>
  <span class='va'>uniquely_up</span>,
  <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"C094_Pellicci.uniquely_up.cluster_9_vs_10_vs_11_vs_12.rds"</span><span class='op'>)</span>,
  compress <span class='op'>=</span> <span class='st'>"xz"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"output"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"uniquely_up"</span>, <span class='st'>"cluster_9_vs_10_vs_11_vs_12"</span><span class='op'>)</span>, recursive <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='va'>vs_pair</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"9"</span>, <span class='st'>"10"</span>, <span class='st'>"11"</span>, <span class='st'>"12"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='st'>"Writing 'uniquely_up (cluster_9_vs_10_vs_11_vs_12)' marker genes to file."</span><span class='op'>)</span>
<span class='kw'>for</span> <span class='op'>(</span><span class='va'>n</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>uniquely_up</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>
  <span class='va'>gzout</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>gzfile</a></span><span class='op'>(</span>
    description <span class='op'>=</span> <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span>
      <span class='st'>"output"</span>,
      <span class='st'>"marker_genes"</span>,
      <span class='st'>"S3_only"</span>,
      <span class='st'>"uniquely_up"</span>,
      <span class='st'>"cluster_9_vs_10_vs_11_vs_12"</span>,
      <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"cluster_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span>,
             <span class='st'>"_vs_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>,
             <span class='st'>"_vs_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>,
             <span class='st'>".uniquely_up.csv.gz"</span><span class='op'>)</span><span class='op'>)</span>,
    open <span class='op'>=</span> <span class='st'>"wb"</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/write.table.html'>write.table</a></span><span class='op'>(</span>
    x <span class='op'>=</span> <span class='va'>uniquely_up</span><span class='op'>[[</span><span class='va'>n</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>%&gt;%</span>
      <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>tibble</span><span class='fu'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/rownames.html'>rownames_to_column</a></span><span class='op'>(</span><span class='st'>"gene_ID"</span><span class='op'>)</span>,
    file <span class='op'>=</span> <span class='va'>gzout</span>,
    sep <span class='op'>=</span> <span class='st'>","</span>,
    quote <span class='op'>=</span> <span class='cn'>FALSE</span>,
    row.names <span class='op'>=</span> <span class='cn'>FALSE</span>,
    col.names <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>close</a></span><span class='op'>(</span><span class='va'>gzout</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># NOTE: The following is a workaround to the lack of support for tabsets in </span>
<span class='co'>#       distill (see https://github.com/rstudio/distill/issues/11 and </span>
<span class='co'>#       https://github.com/rstudio/distill/issues/11#issuecomment-692142414 in </span>
<span class='co'>#       particular).</span>
<span class='fu'>xaringanExtra</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/xaringanExtra/man/panelset.html'>use_panelset</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<div class="panelset">
<section id="cluster-9" class="panel-name panel">
<h4 class="panel-name"><code>Cluster 9</code></h4>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>##########################################</span>
<span class='co'># look at cluster 9 (i.e. S3.mix.more.thymus.1)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"9"</span>
<span class='va'>cluster9_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(S3.mix.more.thymus.1)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># cluster9_uniquely_up &lt;- cluster9_uniquely_up[intersect(protein_coding_gene_set, rownames(cluster9_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>cluster9_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>cluster9_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>cluster9_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>cluster9_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>cluster9_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>cluster9_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>cluster9_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>cluster9_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>cluster9_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>cluster9_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>sce</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  annotation_row <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    Sig <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>[</span>, <span class='st'>"FDR"</span><span class='op'>]</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span>, <span class='st'>"Yes"</span>, <span class='st'>"No"</span><span class='op'>)</span>,
      <span class='co'># TODO: temp trick to deal with the row-colouring problem</span>
      <span class='co'># levels = c("Yes", "No")),</span>
      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Yes"</span><span class='op'>)</span><span class='op'>)</span>,
    row.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span id="fig:heat-uniquely-up-logExp-cluster-9"></span>
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-9-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title" width="624" />
<p class="caption">
Figure 3: Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title
</p>
</div>
</div>
</section>
<section id="cluster-10" class="panel-name panel">
<h4 class="panel-name"><code>Cluster 10</code></h4>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>##########################################</span>
<span class='co'># look at cluster 7 (i.e. S3.mix.with.blood.1)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"10"</span>
<span class='va'>cluster10_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(S3.mix.more.thymus.2)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># cluster10_uniquely_up &lt;- cluster10_uniquely_up[intersect(protein_coding_gene_set, rownames(cluster10_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>cluster10_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>cluster10_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>cluster10_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>cluster10_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>cluster10_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>cluster10_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>cluster10_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>cluster10_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>cluster10_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>cluster10_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>sce</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  annotation_row <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    Sig <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>[</span>, <span class='st'>"FDR"</span><span class='op'>]</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span>, <span class='st'>"Yes"</span>, <span class='st'>"No"</span><span class='op'>)</span>,
      <span class='co'># TODO: temp trick to deal with the row-colouring problem</span>
      <span class='co'># levels = c("Yes", "No")),</span>
      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Yes"</span><span class='op'>)</span><span class='op'>)</span>,
    row.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span id="fig:heat-uniquely-up-logExp-cluster-10"></span>
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-10-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title" width="624" />
<p class="caption">
Figure 4: Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title
</p>
</div>
</div>
</section>
<section id="cluster-11" class="panel-name panel">
<h4 class="panel-name"><code>Cluster 11</code></h4>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>##########################################</span>
<span class='co'># look at cluster 11 (i.e. S3.mix.more.thymus.3)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"11"</span>
<span class='va'>cluster11_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(S3.mix.more.thymus.3)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># cluster11_uniquely_up &lt;- cluster11_uniquely_up[intersect(protein_coding_gene_set, rownames(cluster11_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>cluster11_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>cluster11_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>cluster11_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>cluster11_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>cluster11_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>cluster11_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>cluster11_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>cluster11_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>cluster11_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>cluster11_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>sce</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='co'># annotation_row = data.frame(</span>
  <span class='co'>#   Sig = factor(</span>
  <span class='co'>#     ifelse(best_set[, "FDR"] &lt; 0.05, "Yes", "No"),</span>
  <span class='co'>#     # TODO: temp trick to deal with the row-colouring problem</span>
  <span class='co'>#     # levels = c("Yes", "No")),</span>
  <span class='co'>#     levels = c("Yes")),</span>
  <span class='co'>#   row.names = rownames(best_set)),</span>
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span id="fig:heat-uniquely-up-logExp-cluster-11"></span>
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-11-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title" width="624" />
<p class="caption">
Figure 5: Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title
</p>
</div>
</div>
</section>
<section id="cluster-12" class="panel-name panel">
<h4 class="panel-name"><code>Cluster 12</code></h4>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>##########################################</span>
<span class='co'># look at cluster 12 (i.e. S3.mix.more.thymus.4.center)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"12"</span>
<span class='va'>cluster12_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(S3.mix.more.thymus.4.center)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># cluster12_uniquely_up &lt;- cluster12_uniquely_up[intersect(protein_coding_gene_set, rownames(cluster12_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>cluster12_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>cluster12_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>cluster12_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>cluster12_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>cluster12_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>cluster12_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>cluster12_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>cluster12_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>cluster12_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>cluster12_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>sce</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='co'># annotation_row = data.frame(</span>
  <span class='co'>#   Sig = factor(</span>
  <span class='co'>#     ifelse(best_set[, "FDR"] &lt; 0.05, "Yes", "No"),</span>
  <span class='co'>#     # TODO: temp trick to deal with the row-colouring problem</span>
  <span class='co'>#     # levels = c("Yes", "No")),</span>
  <span class='co'>#     levels = c("Yes")),</span>
  <span class='co'>#   row.names = rownames(best_set)),</span>
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span id="fig:heat-uniquely-up-logExp-cluster-12"></span>
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-12-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title" width="624" />
<p class="caption">
Figure 6: Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title
</p>
</div>
</div>
</section>
</div>
<p>DGE lists of these comparisons are available in <a href="..output/marker_genes/S3_only/uniquely_up/cluster_9_vs_10_vs_11_vs_12/"><code>output/marker_genes/S3_only/uniquely_up/cluster_9_vs_10_vs_11_vs_12/</code></a>.</p>
<p><strong>Summary</strong>:</p>
<p>IL7R is the clear and only unique marker of cluster 9. Cluster 10 also got number of NPBIB family members as marker, but if exclude them, AC009022.1 is the only global unique marker of this clusters. For cluster 11, no statistically significant marker can be spotted, but visually, genes like SOX4 seems to be a potential candidate if pairwise compare. Cluster 12 is the cluster located at the center and be surrounded by the other three clusters in the UMAP plot, as expected, we cannot find any globally unique markers for it.</p>
<p>With this regard, apart from making “all pairwise comparisons” between “all clusters” to pinpoint DE unique to each cluster as above, we took an alternative path and determined the DE unique to only the “selected pairwise comparisons” between “clusters” below. Say, for cluster <code>12</code>, we determine markers that is significantly up-regulated in <strong>at least one</strong> of these comparisons: cluster <code>9</code> vs. <code>12</code> <strong>or</strong> cluster <code>10</code> vs. <code>12</code> <strong>or</strong> cluster <code>11</code> vs. <code>12</code>.</p>
<p>Besides, we also look into the the pairwise comparisons between the interesting “cluster-groups.” For instance, as all cluster has a similar composition of S3-mix with higher proportion of thymus cells, it would be interesting to know how cluster <code>9</code>, <code>10</code>, <code>11</code> are different from each other, or if we could trace for the feature or role of the centered cluster <code>12</code> if we pairwise compare it with the rest.</p>
<p>Here are the list of pairwise comparisons and what they are anticipated to achieve when compared:</p>
<h4 id="fx-are-these-four-clusters-really-differernt-from-each-other-individually"><strong>fx</strong>: are these four clusters really differernt from each other individually</h4>
<ul>
<li>9 vs 10 (A vs B)</li>
<li>9 vs 11 (C vs D)</li>
<li>9 vs 12 (E vs F)</li>
<li>10 vs 11 (G vs H)</li>
<li>10 vs 12 (I vs J)</li>
<li>11 vs 12 (K vs L)</li>
</ul>
<h4 id="fx-how-different-between-clusters-at-the-peripheral"><strong>fx</strong>: how different between clusters at the peripheral</h4>
<ul>
<li>9_10 vs 11 (M vs N)</li>
<li>10_11 vs 9 (O vs P)</li>
<li>9_11 vs 10 (Q vs R)</li>
</ul>
<h4 id="fx-combined-peripheral-clusters-compare-with-the-central-cluster"><strong>fx</strong>: combined peripheral clusters compare with the central cluster</h4>
<ul>
<li>9_10 vs 12 (S vs T)</li>
<li>10_11 vs 12 (U vs V)</li>
<li>9_11 vs 12 (W vs X)</li>
<li>9_10_11 vs 12 (Y vs Z)</li>
</ul>
<h2 id="selected-pairwise-comparisons">Selected pairwise comparisons</h2>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># NOTE: The following is a workaround to the lack of support for tabsets in </span>
<span class='co'>#       distill (see https://github.com/rstudio/distill/issues/11 and </span>
<span class='co'>#       https://github.com/rstudio/distill/issues/11#issuecomment-692142414 in </span>
<span class='co'>#       particular).</span>
<span class='fu'>xaringanExtra</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/xaringanExtra/man/panelset.html'>use_panelset</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<div class="panelset">
<div class="panel">
<h4 class="panel-name" id="cluster_9_vs_cluster_10"><code>cluster_9_vs_cluster_10</code></h4>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#########</span>
<span class='co'># A vs B</span>
<span class='co'>#########</span>

<span class='co'>##########################################################################################</span>
<span class='co'># cluster 9 (i.e. S3.mix.more.thymus.1) vs cluster 10 (i.e. S3.mix.more.thymus.2)</span>

<span class='co'># checkpoint</span>
<span class='va'>cp</span> <span class='op'>&lt;-</span> <span class='va'>sce</span>
<span class='co'># exclude cells of uninterested cluster from cp</span>
<span class='va'>cp</span> <span class='op'>&lt;-</span> <span class='va'>cp</span><span class='op'>[</span>, <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"9"</span> <span class='op'>|</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"10"</span><span class='op'>]</span>
<span class='fu'>colData</span><span class='op'>(</span><span class='va'>cp</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/droplevels.html'>droplevels</a></span><span class='op'>(</span><span class='fu'>colData</span><span class='op'>(</span><span class='va'>cp</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># classify cluster-group for comparison</span>
<span class='va'>cp</span><span class='op'>$</span><span class='va'>vs1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='fl'>9</span>, <span class='st'>"A"</span>, <span class='st'>"B"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># set vs colours</span>
<span class='va'>vs1_colours</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/setNames.html'>setNames</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/grDevices/palette.html'>palette.colors</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nlevels.html'>nlevels</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs1</span><span class='op'>)</span>, <span class='st'>"Set1"</span><span class='op'>)</span>,
  <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs1</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>cp</span><span class='op'>$</span><span class='va'>colours</span><span class='op'>$</span><span class='va'>vs1_colours</span> <span class='op'>&lt;-</span> <span class='va'>vs1_colours</span><span class='op'>[</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs1</span><span class='op'>]</span>

<span class='co'># find unique DE ./. cluster-groups</span>
<span class='va'>vs1_uniquely_up</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scran/man/findMarkers.html'>findMarkers</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  groups <span class='op'>=</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs1</span>,
  block <span class='op'>=</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>block</span>,
  pval.type <span class='op'>=</span> <span class='st'>"all"</span>,
  direction <span class='op'>=</span> <span class='st'>"up"</span><span class='op'>)</span>

<span class='co'># export DGE lists</span>
<span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span>
  <span class='va'>vs1_uniquely_up</span>,
  <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"C094_Pellicci.uniquely_up.cluster_9_vs_10.rds"</span><span class='op'>)</span>,
  compress <span class='op'>=</span> <span class='st'>"xz"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"output"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"uniquely_up"</span>, <span class='st'>"cluster_9_vs_10"</span><span class='op'>)</span>, recursive <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='va'>vs_pair</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"9"</span>, <span class='st'>"10"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='st'>"Writing 'uniquely_up (cluster_9_vs_10)' marker genes to file."</span><span class='op'>)</span>
<span class='kw'>for</span> <span class='op'>(</span><span class='va'>n</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs1_uniquely_up</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>
  <span class='va'>gzout</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>gzfile</a></span><span class='op'>(</span>
    description <span class='op'>=</span> <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span>
      <span class='st'>"output"</span>,
      <span class='st'>"marker_genes"</span>,
      <span class='st'>"S3_only"</span>,
      <span class='st'>"uniquely_up"</span>,
      <span class='st'>"cluster_9_vs_10"</span>,
      <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"cluster_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs1_uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span>,
             <span class='st'>"_vs_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs1_uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>,
             <span class='st'>".uniquely_up.csv.gz"</span><span class='op'>)</span><span class='op'>)</span>,
    open <span class='op'>=</span> <span class='st'>"wb"</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/write.table.html'>write.table</a></span><span class='op'>(</span>
    x <span class='op'>=</span> <span class='va'>vs1_uniquely_up</span><span class='op'>[[</span><span class='va'>n</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>%&gt;%</span>
      <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>tibble</span><span class='fu'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/rownames.html'>rownames_to_column</a></span><span class='op'>(</span><span class='st'>"gene_ID"</span><span class='op'>)</span>,
    file <span class='op'>=</span> <span class='va'>gzout</span>,
    sep <span class='op'>=</span> <span class='st'>","</span>,
    quote <span class='op'>=</span> <span class='cn'>FALSE</span>,
    row.names <span class='op'>=</span> <span class='cn'>FALSE</span>,
    col.names <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>close</a></span><span class='op'>(</span><span class='va'>gzout</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>###############################################################</span>
<span class='co'># look at cluster-group A / cluster 9 (i.e. S3.mix.more.thymus.1)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"A"</span>
<span class='va'>A_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>vs1_uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(cluster 9; S3.mix.more.thymus.1)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># A_uniquely_up_pcg &lt;- A_uniquely_up[intersect(protein_coding_gene_set, rownames(A_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>A_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>A_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>A_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>A_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>A_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>A_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>A_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>A_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>A_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>A_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs1</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"vs1"</span>,
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  annotation_row <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    Sig <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>[</span>, <span class='st'>"FDR"</span><span class='op'>]</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span>, <span class='st'>"Yes"</span>, <span class='st'>"No"</span><span class='op'>)</span>,
      <span class='co'># TODO: temp trick to deal with the row-colouring problem</span>
      <span class='co'># levels = c("Yes", "No")),</span>
      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Yes"</span><span class='op'>)</span><span class='op'>)</span>,
    row.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster-group: "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    vs1 <span class='op'>=</span> <span class='va'>vs1_colours</span>,
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span id="fig:heat-uniquely-up-logExp-cluster-9-vs-10"></span>
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-9-vs-10-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title." width="624" />
<p class="caption">
Figure 7: Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title.
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>##########################################################</span>
<span class='co'># look at cluster-group B / cluster 10 (i.e. S3.mix.more.thymus.2)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"B"</span>
<span class='va'>B_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>vs1_uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(cluster 10; S3.mix.more.thymus.2)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># B_uniquely_up_pcg &lt;- B_uniquely_up[intersect(protein_coding_gene_set, rownames(B_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>B_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>B_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>B_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>B_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>B_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>B_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>B_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>B_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>B_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>B_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs1</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"vs1"</span>,
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  annotation_row <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    Sig <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>[</span>, <span class='st'>"FDR"</span><span class='op'>]</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span>, <span class='st'>"Yes"</span>, <span class='st'>"No"</span><span class='op'>)</span>,
      <span class='co'># TODO: temp trick to deal with the row-colouring problem</span>
      <span class='co'># levels = c("Yes", "No")),</span>
      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Yes"</span><span class='op'>)</span><span class='op'>)</span>,
    row.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster-group: "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    vs1 <span class='op'>=</span> <span class='va'>vs1_colours</span>,
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span id="fig:heat-uniquely-up-logExp-cluster-10-vs-9"></span>
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-10-vs-9-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title." width="624" />
<p class="caption">
Figure 8: Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title.
</p>
</div>
</div>
<p>DGE lists of these comparisons are available in <a href="..output/marker_genes/S3_only/uniquely_up/cluster_9_vs_10/"><code>output/marker_genes/S3_only/uniquely_up/cluster_9_vs_10/</code></a>.</p>
<h3 id="summary-9-vs-10-a-vs-b">SUMMARY: 9 vs 10 (A vs B)</h3>
<ul>
<li>cluster 9 (S3.mix.more.thymus.1 &gt;&gt;&gt; IL7R and LTB as the only markers; DE not associated with tissue</li>
<li>cluster 10 (S3.mix.more.thymus.2 &gt;&gt;&gt; besides NPIPB family, number of markers found (e.g. CCL5 and SYNE2 for both tissues; KLRD1 and EFHD2 mostly for blood)</li>
<li>COMMENT: they are two separated subtype S3 cells found in both thymus and blood (where cluster 9 si characterized by higher IL7R and LTB expression)</li>
</ul>
</div>
<div class="panel">
<h4 class="panel-name" id="cluster_9_vs_cluster_11"><code>cluster_9_vs_cluster_11</code></h4>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#########</span>
<span class='co'># C vs D</span>
<span class='co'>#########</span>

<span class='co'>##########################################################################################</span>
<span class='co'># cluster 9 (i.e. S3.mix.more.thymus.1) vs cluster 11 (i.e. S3.mix.more.thymus.3)</span>

<span class='co'># checkpoint</span>
<span class='va'>cp</span> <span class='op'>&lt;-</span> <span class='va'>sce</span>
<span class='co'># exclude cells of uninterested cluster from cp</span>
<span class='va'>cp</span> <span class='op'>&lt;-</span> <span class='va'>cp</span><span class='op'>[</span>, <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"9"</span> <span class='op'>|</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"11"</span><span class='op'>]</span>
<span class='fu'>colData</span><span class='op'>(</span><span class='va'>cp</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/droplevels.html'>droplevels</a></span><span class='op'>(</span><span class='fu'>colData</span><span class='op'>(</span><span class='va'>cp</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># classify cluster-group for comparison</span>
<span class='va'>cp</span><span class='op'>$</span><span class='va'>vs2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='fl'>9</span>, <span class='st'>"C"</span>, <span class='st'>"D"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># set vs colours</span>
<span class='va'>vs2_colours</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/setNames.html'>setNames</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/grDevices/palette.html'>palette.colors</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nlevels.html'>nlevels</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs2</span><span class='op'>)</span>, <span class='st'>"Set1"</span><span class='op'>)</span>,
  <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs2</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>cp</span><span class='op'>$</span><span class='va'>colours</span><span class='op'>$</span><span class='va'>vs2_colours</span> <span class='op'>&lt;-</span> <span class='va'>vs2_colours</span><span class='op'>[</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs2</span><span class='op'>]</span>

<span class='co'># find unique DE ./. cluster-groups</span>
<span class='va'>vs2_uniquely_up</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scran/man/findMarkers.html'>findMarkers</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  groups <span class='op'>=</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs2</span>,
  block <span class='op'>=</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>block</span>,
  pval.type <span class='op'>=</span> <span class='st'>"all"</span>,
  direction <span class='op'>=</span> <span class='st'>"up"</span><span class='op'>)</span>

<span class='co'># export DGE lists</span>
<span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span>
  <span class='va'>vs2_uniquely_up</span>,
  <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"C094_Pellicci.uniquely_up.cluster_9_vs_11.rds"</span><span class='op'>)</span>,
  compress <span class='op'>=</span> <span class='st'>"xz"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"output"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"uniquely_up"</span>, <span class='st'>"cluster_9_vs_11"</span><span class='op'>)</span>, recursive <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='va'>vs_pair</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"9"</span>, <span class='st'>"11"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='st'>"Writing 'uniquely_up (cluster_9_vs_11)' marker genes to file."</span><span class='op'>)</span>
<span class='kw'>for</span> <span class='op'>(</span><span class='va'>n</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs2_uniquely_up</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>
  <span class='va'>gzout</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>gzfile</a></span><span class='op'>(</span>
    description <span class='op'>=</span> <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span>
      <span class='st'>"output"</span>,
      <span class='st'>"marker_genes"</span>,
      <span class='st'>"S3_only"</span>,
      <span class='st'>"uniquely_up"</span>,
      <span class='st'>"cluster_9_vs_11"</span>,
      <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"cluster_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs2_uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span>,
             <span class='st'>"_vs_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs2_uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>,
             <span class='st'>".uniquely_up.csv.gz"</span><span class='op'>)</span><span class='op'>)</span>,
    open <span class='op'>=</span> <span class='st'>"wb"</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/write.table.html'>write.table</a></span><span class='op'>(</span>
    x <span class='op'>=</span> <span class='va'>vs2_uniquely_up</span><span class='op'>[[</span><span class='va'>n</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>%&gt;%</span>
      <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>tibble</span><span class='fu'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/rownames.html'>rownames_to_column</a></span><span class='op'>(</span><span class='st'>"gene_ID"</span><span class='op'>)</span>,
    file <span class='op'>=</span> <span class='va'>gzout</span>,
    sep <span class='op'>=</span> <span class='st'>","</span>,
    quote <span class='op'>=</span> <span class='cn'>FALSE</span>,
    row.names <span class='op'>=</span> <span class='cn'>FALSE</span>,
    col.names <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>close</a></span><span class='op'>(</span><span class='va'>gzout</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>###############################################################</span>
<span class='co'># look at cluster-group C / cluster 9 (i.e. S3.mix.more.thymus.1)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"C"</span>
<span class='va'>C_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>vs2_uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(cluster 9; S3.mix.more.thymus.1)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># C_uniquely_up_pcg &lt;- C_uniquely_up[intersect(protein_coding_gene_set, rownames(C_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>C_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>C_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>C_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>C_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>C_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>C_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>C_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>C_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>C_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>C_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs2</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"vs2"</span>,
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  annotation_row <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    Sig <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>[</span>, <span class='st'>"FDR"</span><span class='op'>]</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span>, <span class='st'>"Yes"</span>, <span class='st'>"No"</span><span class='op'>)</span>,
      <span class='co'># TODO: temp trick to deal with the row-colouring problem</span>
      <span class='co'># levels = c("Yes", "No")),</span>
      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Yes"</span><span class='op'>)</span><span class='op'>)</span>,
    row.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster-group: "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    vs2 <span class='op'>=</span> <span class='va'>vs2_colours</span>,
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span id="fig:heat-uniquely-up-logExp-cluster-9-vs-11"></span>
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-9-vs-11-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title." width="624" />
<p class="caption">
Figure 9: Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title.
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>##########################################################</span>
<span class='co'># look at cluster-group D / cluster 11 (i.e. S3.mix.more.thymus.3)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"D"</span>
<span class='va'>D_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>vs2_uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(cluster 11; S3.mix.more.thymus.3)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># D_uniquely_up_pcg &lt;- D_uniquely_up[intersect(protein_coding_gene_set, rownames(D_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>D_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>D_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>D_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>D_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>D_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>D_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>D_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>D_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>D_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>D_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs2</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"vs2"</span>,
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  annotation_row <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    Sig <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>[</span>, <span class='st'>"FDR"</span><span class='op'>]</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span>, <span class='st'>"Yes"</span>, <span class='st'>"No"</span><span class='op'>)</span>,
      <span class='co'># TODO: temp trick to deal with the row-colouring problem</span>
      <span class='co'># levels = c("Yes", "No")),</span>
      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Yes"</span><span class='op'>)</span><span class='op'>)</span>,
    row.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster-group: "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    vs2 <span class='op'>=</span> <span class='va'>vs2_colours</span>,
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span id="fig:heat-uniquely-up-logExp-cluster-11-vs-9"></span>
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-11-vs-9-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title." width="624" />
<p class="caption">
Figure 10: Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title.
</p>
</div>
</div>
<p>DGE lists of these comparisons are available in <a href="..output/marker_genes/S3_only/uniquely_up/cluster_9_vs_11/"><code>output/marker_genes/S3_only/uniquely_up/cluster_9_vs_11/</code></a>.</p>
<h4 id="summary-9-vs-11-c-vs-d">SUMMARY: 9 vs 11 (C vs D)</h4>
<ul>
<li>cluster 9 (S3.mix.more.thymus.1 &gt;&gt;&gt; besides NPIPB family, number of markers such as IL7R, IFITM3, TOMM7, etc shown as clear markers</li>
<li>cluster 11 (S3.mix.more.thymus.3 &gt;&gt;&gt; CCL5 as only unique makers (may look more highly expressed in “blood” cells)</li>
<li>COMMENT: these are also 2 separated subtypes of S3 cells (esp cluster 9 is IL7R IFITM3 driven, cluster 11 is CCL5 driven</li>
</ul>
</div>
<div class="panel">
<h4 class="panel-name" id="cluster_9_vs_cluster_12"><code>cluster_9_vs_cluster_12</code></h4>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#########</span>
<span class='co'># E vs F</span>
<span class='co'>#########</span>

<span class='co'>##########################################################################################</span>
<span class='co'># cluster 9 (i.e. S3.mix.more.thymus.1) vs cluster 12 (i.e. S3.mix.more.thymus.4.center)</span>

<span class='co'># checkpoint</span>
<span class='va'>cp</span> <span class='op'>&lt;-</span> <span class='va'>sce</span>
<span class='co'># exclude cells of uninterested cluster from cp</span>
<span class='va'>cp</span> <span class='op'>&lt;-</span> <span class='va'>cp</span><span class='op'>[</span>, <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"9"</span> <span class='op'>|</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"12"</span><span class='op'>]</span>
<span class='fu'>colData</span><span class='op'>(</span><span class='va'>cp</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/droplevels.html'>droplevels</a></span><span class='op'>(</span><span class='fu'>colData</span><span class='op'>(</span><span class='va'>cp</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># classify cluster-group for comparison</span>
<span class='va'>cp</span><span class='op'>$</span><span class='va'>vs3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='fl'>9</span>, <span class='st'>"E"</span>, <span class='st'>"F"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># set vs colours</span>
<span class='va'>vs3_colours</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/setNames.html'>setNames</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/grDevices/palette.html'>palette.colors</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nlevels.html'>nlevels</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs3</span><span class='op'>)</span>, <span class='st'>"Set1"</span><span class='op'>)</span>,
  <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs3</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>cp</span><span class='op'>$</span><span class='va'>colours</span><span class='op'>$</span><span class='va'>vs3_colours</span> <span class='op'>&lt;-</span> <span class='va'>vs3_colours</span><span class='op'>[</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs3</span><span class='op'>]</span>

<span class='co'># find unique DE ./. cluster-groups</span>
<span class='va'>vs3_uniquely_up</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scran/man/findMarkers.html'>findMarkers</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  groups <span class='op'>=</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs3</span>,
  block <span class='op'>=</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>block</span>,
  pval.type <span class='op'>=</span> <span class='st'>"all"</span>,
  direction <span class='op'>=</span> <span class='st'>"up"</span><span class='op'>)</span>

<span class='co'># export DGE lists</span>
<span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span>
  <span class='va'>vs3_uniquely_up</span>,
  <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"C094_Pellicci.uniquely_up.cluster_9_vs_12.rds"</span><span class='op'>)</span>,
  compress <span class='op'>=</span> <span class='st'>"xz"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"output"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"uniquely_up"</span>, <span class='st'>"cluster_9_vs_12"</span><span class='op'>)</span>, recursive <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='va'>vs_pair</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"9"</span>, <span class='st'>"12"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='st'>"Writing 'uniquely_up (cluster_9_vs_12)' marker genes to file."</span><span class='op'>)</span>
<span class='kw'>for</span> <span class='op'>(</span><span class='va'>n</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs3_uniquely_up</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>
  <span class='va'>gzout</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>gzfile</a></span><span class='op'>(</span>
    description <span class='op'>=</span> <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span>
      <span class='st'>"output"</span>,
      <span class='st'>"marker_genes"</span>,
      <span class='st'>"S3_only"</span>,
      <span class='st'>"uniquely_up"</span>,
      <span class='st'>"cluster_9_vs_12"</span>,
      <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"cluster_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs3_uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span>,
             <span class='st'>"_vs_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs3_uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>,
             <span class='st'>".uniquely_up.csv.gz"</span><span class='op'>)</span><span class='op'>)</span>,
    open <span class='op'>=</span> <span class='st'>"wb"</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/write.table.html'>write.table</a></span><span class='op'>(</span>
    x <span class='op'>=</span> <span class='va'>vs3_uniquely_up</span><span class='op'>[[</span><span class='va'>n</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>%&gt;%</span>
      <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>tibble</span><span class='fu'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/rownames.html'>rownames_to_column</a></span><span class='op'>(</span><span class='st'>"gene_ID"</span><span class='op'>)</span>,
    file <span class='op'>=</span> <span class='va'>gzout</span>,
    sep <span class='op'>=</span> <span class='st'>","</span>,
    quote <span class='op'>=</span> <span class='cn'>FALSE</span>,
    row.names <span class='op'>=</span> <span class='cn'>FALSE</span>,
    col.names <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>close</a></span><span class='op'>(</span><span class='va'>gzout</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>###############################################################</span>
<span class='co'># look at cluster-group E / cluster 9 (i.e. S3.mix.more.thymus.1)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"E"</span>
<span class='va'>E_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>vs3_uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(cluster 9; S3.mix.more.thymus.1)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># E_uniquely_up_pcg &lt;- E_uniquely_up[intersect(protein_coding_gene_set, rownames(E_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>E_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>E_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>E_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>E_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>E_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>E_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>E_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>E_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>E_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>E_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs3</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"vs3"</span>,
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  annotation_row <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    Sig <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>[</span>, <span class='st'>"FDR"</span><span class='op'>]</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span>, <span class='st'>"Yes"</span>, <span class='st'>"No"</span><span class='op'>)</span>,
      <span class='co'># TODO: temp trick to deal with the row-colouring problem</span>
      <span class='co'># levels = c("Yes", "No")),</span>
      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Yes"</span><span class='op'>)</span><span class='op'>)</span>,
    row.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster-group: "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    vs3 <span class='op'>=</span> <span class='va'>vs3_colours</span>,
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span id="fig:heat-uniquely-up-logExp-cluster-9-vs-12"></span>
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-9-vs-12-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title." width="624" />
<p class="caption">
Figure 11: Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title.
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>##########################################################</span>
<span class='co'># look at cluster-group F / cluster 12 (i.e. S3.mix.more.thymus.4.center)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"F"</span>
<span class='va'>F_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>vs3_uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(cluster 12; S3.mix.more.thymus.4.center)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># F_uniquely_up_pcg &lt;- F_uniquely_up[intersect(protein_coding_gene_set, rownames(F_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>F_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>F_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>F_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>F_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>F_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>F_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>F_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>F_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>F_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>F_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs3</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"vs3"</span>,
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  annotation_row <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    Sig <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>[</span>, <span class='st'>"FDR"</span><span class='op'>]</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span>, <span class='st'>"Yes"</span>, <span class='st'>"No"</span><span class='op'>)</span>,
      <span class='co'># TODO: temp trick to deal with the row-colouring problem</span>
      <span class='co'># levels = c("Yes", "No")),</span>
      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Yes"</span><span class='op'>)</span><span class='op'>)</span>,
    row.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster-group: "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    vs3 <span class='op'>=</span> <span class='va'>vs3_colours</span>,
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span id="fig:heat-uniquely-up-logExp-cluster-12-vs-9"></span>
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-12-vs-9-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title." width="624" />
<p class="caption">
Figure 12: Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title.
</p>
</div>
</div>
<p>DGE lists of these comparisons are available in <a href="..output/marker_genes/S3_only/uniquely_up/cluster_9_vs_12/"><code>output/marker_genes/S3_only/uniquely_up/cluster_9_vs_12/</code></a>.</p>
<h4 id="summary-9-vs-12-e-vs-f">SUMMARY: 9 vs 12 (E vs F)</h4>
<ul>
<li>cluster <code>9</code> (S3.mix.more.thymus.1 &gt;&gt;&gt; cluster <code>9</code> does show a number of cells more frequently expressed with lots of markers (not associated with tissue)</li>
<li>cluster <code>12</code> (S3.mix.more.thymus.4.center &gt;&gt;&gt; beside the two mitochondrial genes (i.e. most likely be noise) no sig marker found, though, visually, there seems like some</li>
<li>COMMENT: gene expression pattern of cluster <code>12</code> should be similar to cluster <code>9</code>; whilst cluster <code>9</code> does show a number of genes up-regulated in cluster <code>9</code>, but not in cluster <code>12</code>; needed to keep them apart</li>
</ul>
</div>
<div class="panel">
<h4 class="panel-name" id="cluster_10_vs_cluster_11"><code>cluster_10_vs_cluster_11</code></h4>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#########</span>
<span class='co'># G vs H</span>
<span class='co'>#########</span>

<span class='co'>##########################################################################################</span>
<span class='co'># cluster 10 (i.e. S3.mix.more.thymus.2) vs cluster 11 (i.e. S3.mix.more.thymus.3)</span>

<span class='co'># checkpoint</span>
<span class='va'>cp</span> <span class='op'>&lt;-</span> <span class='va'>sce</span>
<span class='co'># exclude cells of uninterested cluster from cp</span>
<span class='va'>cp</span> <span class='op'>&lt;-</span> <span class='va'>cp</span><span class='op'>[</span>, <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"10"</span> <span class='op'>|</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"11"</span><span class='op'>]</span>
<span class='fu'>colData</span><span class='op'>(</span><span class='va'>cp</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/droplevels.html'>droplevels</a></span><span class='op'>(</span><span class='fu'>colData</span><span class='op'>(</span><span class='va'>cp</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># classify cluster-group for comparison</span>
<span class='va'>cp</span><span class='op'>$</span><span class='va'>vs4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='fl'>10</span>, <span class='st'>"G"</span>, <span class='st'>"H"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># set vs colours</span>
<span class='va'>vs4_colours</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/setNames.html'>setNames</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/grDevices/palette.html'>palette.colors</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nlevels.html'>nlevels</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs4</span><span class='op'>)</span>, <span class='st'>"Set1"</span><span class='op'>)</span>,
  <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs4</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>cp</span><span class='op'>$</span><span class='va'>colours</span><span class='op'>$</span><span class='va'>vs4_colours</span> <span class='op'>&lt;-</span> <span class='va'>vs4_colours</span><span class='op'>[</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs4</span><span class='op'>]</span>

<span class='co'># find unique DE ./. cluster-groups</span>
<span class='va'>vs4_uniquely_up</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scran/man/findMarkers.html'>findMarkers</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  groups <span class='op'>=</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs4</span>,
  block <span class='op'>=</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>block</span>,
  pval.type <span class='op'>=</span> <span class='st'>"all"</span>,
  direction <span class='op'>=</span> <span class='st'>"up"</span><span class='op'>)</span>

<span class='co'># export DGE lists</span>
<span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span>
  <span class='va'>vs4_uniquely_up</span>,
  <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"C094_Pellicci.uniquely_up.cluster_10_vs_11.rds"</span><span class='op'>)</span>,
  compress <span class='op'>=</span> <span class='st'>"xz"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"output"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"uniquely_up"</span>, <span class='st'>"cluster_10_vs_11"</span><span class='op'>)</span>, recursive <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='va'>vs_pair</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"10"</span>, <span class='st'>"11"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='st'>"Writing 'uniquely_up (cluster_10_vs_11)' marker genes to file."</span><span class='op'>)</span>
<span class='kw'>for</span> <span class='op'>(</span><span class='va'>n</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs4_uniquely_up</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>
  <span class='va'>gzout</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>gzfile</a></span><span class='op'>(</span>
    description <span class='op'>=</span> <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span>
      <span class='st'>"output"</span>,
      <span class='st'>"marker_genes"</span>,
      <span class='st'>"S3_only"</span>,
      <span class='st'>"uniquely_up"</span>,
      <span class='st'>"cluster_10_vs_11"</span>,
      <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"cluster_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs4_uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span>,
             <span class='st'>"_vs_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs4_uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>,
             <span class='st'>".uniquely_up.csv.gz"</span><span class='op'>)</span><span class='op'>)</span>,
    open <span class='op'>=</span> <span class='st'>"wb"</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/write.table.html'>write.table</a></span><span class='op'>(</span>
    x <span class='op'>=</span> <span class='va'>vs4_uniquely_up</span><span class='op'>[[</span><span class='va'>n</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>%&gt;%</span>
      <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>tibble</span><span class='fu'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/rownames.html'>rownames_to_column</a></span><span class='op'>(</span><span class='st'>"gene_ID"</span><span class='op'>)</span>,
    file <span class='op'>=</span> <span class='va'>gzout</span>,
    sep <span class='op'>=</span> <span class='st'>","</span>,
    quote <span class='op'>=</span> <span class='cn'>FALSE</span>,
    row.names <span class='op'>=</span> <span class='cn'>FALSE</span>,
    col.names <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>close</a></span><span class='op'>(</span><span class='va'>gzout</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>###############################################################</span>
<span class='co'># look at cluster-group G / cluster 10 (i.e. S3.mix.more.thymus.2)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"G"</span>
<span class='va'>G_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>vs4_uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(cluster 10; S3.mix.more.thymus.2)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># G_uniquely_up_pcg &lt;- G_uniquely_up[intersect(protein_coding_gene_set, rownames(G_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>G_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>G_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>G_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>G_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>G_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>G_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>G_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>G_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>G_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>G_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"vs4"</span>,
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  annotation_row <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    Sig <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>[</span>, <span class='st'>"FDR"</span><span class='op'>]</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span>, <span class='st'>"Yes"</span>, <span class='st'>"No"</span><span class='op'>)</span>,
      <span class='co'># TODO: temp trick to deal with the row-colouring problem</span>
      <span class='co'># levels = c("Yes", "No")),</span>
      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Yes"</span><span class='op'>)</span><span class='op'>)</span>,
    row.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster-group: "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    vs4 <span class='op'>=</span> <span class='va'>vs4_colours</span>,
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span id="fig:heat-uniquely-up-logExp-cluster-10-vs-11"></span>
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-10-vs-11-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title." width="624" />
<p class="caption">
Figure 13: Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title.
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>##########################################################</span>
<span class='co'># look at cluster-group H / cluster 11 (i.e. S3.mix.more.thymus.3)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"H"</span>
<span class='va'>H_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>vs4_uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(cluster 11; S3.mix.more.thymus.3)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># H_uniquely_up_pcg &lt;- H_uniquely_up[intersect(protein_coding_gene_set, rownames(H_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>H_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>H_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>H_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>H_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>H_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>H_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>H_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>H_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>H_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>H_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"vs4"</span>,
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='co'># annotation_row = data.frame(</span>
  <span class='co'>#   Sig = factor(</span>
  <span class='co'>#     ifelse(best_set[, "FDR"] &lt; 0.05, "Yes", "No"),</span>
  <span class='co'>#     # TODO: temp trick to deal with the row-colouring problem</span>
  <span class='co'>#     # levels = c("Yes", "No")),</span>
  <span class='co'>#     levels = c("Yes")),</span>
  <span class='co'>#   row.names = rownames(best_set)),</span>
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster-group: "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    vs4 <span class='op'>=</span> <span class='va'>vs4_colours</span>,
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span id="fig:heat-uniquely-up-logExp-cluster-11-vs-10"></span>
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-11-vs-10-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title." width="624" />
<p class="caption">
Figure 14: Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title.
</p>
</div>
</div>
<p>DGE lists of these comparisons are available in <a href="..output/marker_genes/S3_only/uniquely_up/cluster_10_vs_11/"><code>output/marker_genes/S3_only/uniquely_up/cluster_10_vs_11/</code></a>.</p>
<h4 id="summary-10-vs-11-g-vs-h">SUMMARY: 10 vs 11 (G vs H)</h4>
<ul>
<li>cluster 10 (S3.mix.more.thymus.2 &gt;&gt;&gt; besides NPIPB, SYNE2 and AC009022.9 are clear markers</li>
<li>cluster 11 (S3.mix.more.thymus.3 &gt;&gt;&gt; no statistically significant markers</li>
<li>COMMENT: SYNE2 and AC009022.1 (and maybe NPIPB) may driven cluster 10 from 11</li>
</ul>
</div>
<div class="panel">
<h4 class="panel-name" id="cluster_10_vs_cluster_12"><code>cluster_10_vs_cluster_12</code></h4>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#########</span>
<span class='co'># I vs J</span>
<span class='co'>#########</span>

<span class='co'>##########################################################################################</span>
<span class='co'># cluster 10 (i.e. S3.mix.more.thymus.2) vs cluster 12 (i.e. S3.mix.more.thymus.4.center)</span>

<span class='co'># checkpoint</span>
<span class='va'>cp</span> <span class='op'>&lt;-</span> <span class='va'>sce</span>
<span class='co'># exclude cells of uninterested cluster from cp</span>
<span class='va'>cp</span> <span class='op'>&lt;-</span> <span class='va'>cp</span><span class='op'>[</span>, <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"10"</span> <span class='op'>|</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"12"</span><span class='op'>]</span>
<span class='fu'>colData</span><span class='op'>(</span><span class='va'>cp</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/droplevels.html'>droplevels</a></span><span class='op'>(</span><span class='fu'>colData</span><span class='op'>(</span><span class='va'>cp</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># classify cluster-group for comparison</span>
<span class='va'>cp</span><span class='op'>$</span><span class='va'>vs5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='fl'>10</span>, <span class='st'>"I"</span>, <span class='st'>"J"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># set vs colours</span>
<span class='va'>vs5_colours</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/setNames.html'>setNames</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/grDevices/palette.html'>palette.colors</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nlevels.html'>nlevels</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs5</span><span class='op'>)</span>, <span class='st'>"Set1"</span><span class='op'>)</span>,
  <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs5</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>cp</span><span class='op'>$</span><span class='va'>colours</span><span class='op'>$</span><span class='va'>vs5_colours</span> <span class='op'>&lt;-</span> <span class='va'>vs5_colours</span><span class='op'>[</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs5</span><span class='op'>]</span>

<span class='co'># find unique DE ./. cluster-groups</span>
<span class='va'>vs5_uniquely_up</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scran/man/findMarkers.html'>findMarkers</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  groups <span class='op'>=</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs5</span>,
  block <span class='op'>=</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>block</span>,
  pval.type <span class='op'>=</span> <span class='st'>"all"</span>,
  direction <span class='op'>=</span> <span class='st'>"up"</span><span class='op'>)</span>

<span class='co'># export DGE lists</span>
<span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span>
  <span class='va'>vs5_uniquely_up</span>,
  <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"C094_Pellicci.uniquely_up.cluster_10_vs_12.rds"</span><span class='op'>)</span>,
  compress <span class='op'>=</span> <span class='st'>"xz"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"output"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"uniquely_up"</span>, <span class='st'>"cluster_10_vs_12"</span><span class='op'>)</span>, recursive <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='va'>vs_pair</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"10"</span>, <span class='st'>"12"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='st'>"Writing 'uniquely_up (cluster_10_vs_12)' marker genes to file."</span><span class='op'>)</span>
<span class='kw'>for</span> <span class='op'>(</span><span class='va'>n</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs5_uniquely_up</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>
  <span class='va'>gzout</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>gzfile</a></span><span class='op'>(</span>
    description <span class='op'>=</span> <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span>
      <span class='st'>"output"</span>,
      <span class='st'>"marker_genes"</span>,
      <span class='st'>"S3_only"</span>,
      <span class='st'>"uniquely_up"</span>,
      <span class='st'>"cluster_10_vs_12"</span>,
      <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"cluster_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs5_uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span>,
             <span class='st'>"_vs_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs5_uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>,
             <span class='st'>".uniquely_up.csv.gz"</span><span class='op'>)</span><span class='op'>)</span>,
    open <span class='op'>=</span> <span class='st'>"wb"</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/write.table.html'>write.table</a></span><span class='op'>(</span>
    x <span class='op'>=</span> <span class='va'>vs5_uniquely_up</span><span class='op'>[[</span><span class='va'>n</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>%&gt;%</span>
      <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>tibble</span><span class='fu'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/rownames.html'>rownames_to_column</a></span><span class='op'>(</span><span class='st'>"gene_ID"</span><span class='op'>)</span>,
    file <span class='op'>=</span> <span class='va'>gzout</span>,
    sep <span class='op'>=</span> <span class='st'>","</span>,
    quote <span class='op'>=</span> <span class='cn'>FALSE</span>,
    row.names <span class='op'>=</span> <span class='cn'>FALSE</span>,
    col.names <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>close</a></span><span class='op'>(</span><span class='va'>gzout</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>###############################################################</span>
<span class='co'># look at cluster-group I / cluster 10 (i.e. S3.mix.more.thymus.2)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"I"</span>
<span class='va'>I_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>vs5_uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(cluster 10; S3.mix.more.thymus.2)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># I_uniquely_up_pcg &lt;- I_uniquely_up[intersect(protein_coding_gene_set, rownames(I_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>I_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>I_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>I_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>I_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>I_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>I_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>I_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>I_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>I_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>I_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs5</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"vs5"</span>,
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  annotation_row <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    Sig <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>[</span>, <span class='st'>"FDR"</span><span class='op'>]</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span>, <span class='st'>"Yes"</span>, <span class='st'>"No"</span><span class='op'>)</span>,
      <span class='co'># TODO: temp trick to deal with the row-colouring problem</span>
      <span class='co'># levels = c("Yes", "No")),</span>
      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Yes"</span><span class='op'>)</span><span class='op'>)</span>,
    row.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster-group: "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    vs5 <span class='op'>=</span> <span class='va'>vs5_colours</span>,
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span id="fig:heat-uniquely-up-logExp-cluster-10-vs-12"></span>
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-10-vs-12-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title." width="624" />
<p class="caption">
Figure 15: Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title.
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>##########################################################</span>
<span class='co'># look at cluster-group J / cluster 12 (i.e. S3.mix.more.thymus.4.center)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"J"</span>
<span class='va'>J_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>vs5_uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(cluster 12; S3-mix, set 4)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># J_uniquely_up_pcg &lt;- J_uniquely_up[intersect(protein_coding_gene_set, rownames(J_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>J_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>J_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>J_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>J_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>J_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>J_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>J_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>J_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>J_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>J_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs5</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"vs5"</span>,
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='co'># annotation_row = data.frame(</span>
  <span class='co'>#   Sig = factor(</span>
  <span class='co'>#     ifelse(best_set[, "FDR"] &lt; 0.05, "Yes", "No"),</span>
  <span class='co'>#     # TODO: temp trick to deal with the row-colouring problem</span>
  <span class='co'>#     # levels = c("Yes", "No")),</span>
  <span class='co'>#     levels = c("Yes")),</span>
  <span class='co'>#   row.names = rownames(best_set)),</span>
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster-group: "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    vs5 <span class='op'>=</span> <span class='va'>vs5_colours</span>,
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span id="fig:heat-uniquely-up-logExp-cluster-12-vs-10"></span>
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-12-vs-10-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title." width="624" />
<p class="caption">
Figure 16: Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title.
</p>
</div>
</div>
<p>DGE lists of these comparisons are available in <a href="..output/marker_genes/S3_only/uniquely_up/cluster_10_vs_12/"><code>output/marker_genes/S3_only/uniquely_up/cluster_10_vs_12/</code></a>.</p>
<h4 id="summary-10-vs-12-i-vs-j">SUMMARY: 10 vs 12 (I vs J)</h4>
<ul>
<li>cluster 10 (S3.mix.more.thymus.2 &gt;&gt;&gt; besides NPIPB, got number of markers (e.g. ACTG1, MBNL1, MDM4, etc.)</li>
<li>cluster 12 (S3.mix.more.thymus.4.center &gt;&gt;&gt; statistically, no significant marker can be found</li>
<li>COMMENT: gene like (ACTG1, MBNL1, MDM4, etc.) may drive cluster 10 away from 12 at the center</li>
</ul>
</div>
<div class="panel">
<h4 class="panel-name" id="cluster_11_vs_cluster_12"><code>cluster_11_vs_cluster_12</code></h4>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#########</span>
<span class='co'># K vs L</span>
<span class='co'>#########</span>

<span class='co'>##########################################################################################</span>
<span class='co'># cluster 11 (i.e. S3.mix.more.thymus.3) vs cluster 12 (i.e. S3.mix.more.thymus.4.center)</span>

<span class='co'># checkpoint</span>
<span class='va'>cp</span> <span class='op'>&lt;-</span> <span class='va'>sce</span>
<span class='co'># exclude cells of uninterested cluster from cp</span>
<span class='va'>cp</span> <span class='op'>&lt;-</span> <span class='va'>cp</span><span class='op'>[</span>, <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"11"</span> <span class='op'>|</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"12"</span><span class='op'>]</span>
<span class='fu'>colData</span><span class='op'>(</span><span class='va'>cp</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/droplevels.html'>droplevels</a></span><span class='op'>(</span><span class='fu'>colData</span><span class='op'>(</span><span class='va'>cp</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># classify cluster-group for comparison</span>
<span class='va'>cp</span><span class='op'>$</span><span class='va'>vs6</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='fl'>11</span>, <span class='st'>"K"</span>, <span class='st'>"L"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># set vs colours</span>
<span class='va'>vs6_colours</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/setNames.html'>setNames</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/grDevices/palette.html'>palette.colors</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nlevels.html'>nlevels</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs6</span><span class='op'>)</span>, <span class='st'>"Set1"</span><span class='op'>)</span>,
  <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs6</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>cp</span><span class='op'>$</span><span class='va'>colours</span><span class='op'>$</span><span class='va'>vs6_colours</span> <span class='op'>&lt;-</span> <span class='va'>vs6_colours</span><span class='op'>[</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs6</span><span class='op'>]</span>

<span class='co'># find unique DE ./. cluster-groups</span>
<span class='va'>vs6_uniquely_up</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scran/man/findMarkers.html'>findMarkers</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  groups <span class='op'>=</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs6</span>,
  block <span class='op'>=</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>block</span>,
  pval.type <span class='op'>=</span> <span class='st'>"all"</span>,
  direction <span class='op'>=</span> <span class='st'>"up"</span><span class='op'>)</span>

<span class='co'># export DGE lists</span>
<span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span>
  <span class='va'>vs6_uniquely_up</span>,
  <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"C094_Pellicci.uniquely_up.cluster_11_vs_12.rds"</span><span class='op'>)</span>,
  compress <span class='op'>=</span> <span class='st'>"xz"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"output"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"uniquely_up"</span>, <span class='st'>"cluster_11_vs_12"</span><span class='op'>)</span>, recursive <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='va'>vs_pair</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"3"</span>, <span class='st'>"4"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='st'>"Writing 'uniquely_up (cluster_11_vs_12)' marker genes to file."</span><span class='op'>)</span>
<span class='kw'>for</span> <span class='op'>(</span><span class='va'>n</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs6_uniquely_up</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>
  <span class='va'>gzout</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>gzfile</a></span><span class='op'>(</span>
    description <span class='op'>=</span> <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span>
      <span class='st'>"output"</span>,
      <span class='st'>"marker_genes"</span>,
      <span class='st'>"S3_only"</span>,
      <span class='st'>"uniquely_up"</span>,
      <span class='st'>"cluster_11_vs_12"</span>,
      <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"cluster_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs6_uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span>,
             <span class='st'>"_vs_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs6_uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>,
             <span class='st'>".uniquely_up.csv.gz"</span><span class='op'>)</span><span class='op'>)</span>,
    open <span class='op'>=</span> <span class='st'>"wb"</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/write.table.html'>write.table</a></span><span class='op'>(</span>
    x <span class='op'>=</span> <span class='va'>vs6_uniquely_up</span><span class='op'>[[</span><span class='va'>n</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>%&gt;%</span>
      <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>tibble</span><span class='fu'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/rownames.html'>rownames_to_column</a></span><span class='op'>(</span><span class='st'>"gene_ID"</span><span class='op'>)</span>,
    file <span class='op'>=</span> <span class='va'>gzout</span>,
    sep <span class='op'>=</span> <span class='st'>","</span>,
    quote <span class='op'>=</span> <span class='cn'>FALSE</span>,
    row.names <span class='op'>=</span> <span class='cn'>FALSE</span>,
    col.names <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>close</a></span><span class='op'>(</span><span class='va'>gzout</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>###############################################################</span>
<span class='co'># look at cluster-group K / cluster 11 (i.e. S3.mix.more.thymus.3)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"K"</span>
<span class='va'>K_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>vs6_uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(cluster 11; S3.mix.more.thymus.3)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># K_uniquely_up_pcg &lt;- K_uniquely_up[intersect(protein_coding_gene_set, rownames(K_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>K_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>K_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>K_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>K_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>K_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>K_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>K_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>K_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>K_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>K_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs6</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"vs6"</span>,
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  annotation_row <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    Sig <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>[</span>, <span class='st'>"FDR"</span><span class='op'>]</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span>, <span class='st'>"Yes"</span>, <span class='st'>"No"</span><span class='op'>)</span>,
      <span class='co'># TODO: temp trick to deal with the row-colouring problem</span>
      <span class='co'># levels = c("Yes", "No")),</span>
      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Yes"</span><span class='op'>)</span><span class='op'>)</span>,
    row.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster-group: "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    vs6 <span class='op'>=</span> <span class='va'>vs6_colours</span>,
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span id="fig:heat-uniquely-up-logExp-cluster-11-vs-12"></span>
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-11-vs-12-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title." width="624" />
<p class="caption">
Figure 17: Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title.
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>##########################################################</span>
<span class='co'># look at cluster-group L / cluster 12 (i.e. S3.mix.more.thymus.4.center)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"L"</span>
<span class='va'>L_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>vs6_uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(cluster 12; S3.mix.more.thymus.4.center)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># L_uniquely_up_pcg &lt;- L_uniquely_up[intersect(protein_coding_gene_set, rownames(L_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>L_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>L_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>L_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>L_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>L_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>L_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>L_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>L_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>L_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>L_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs6</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"vs6"</span>,
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='co'># annotation_row = data.frame(</span>
  <span class='co'>#   Sig = factor(</span>
  <span class='co'>#     ifelse(best_set[, "FDR"] &lt; 0.05, "Yes", "No"),</span>
  <span class='co'>#     # TODO: temp trick to deal with the row-colouring problem</span>
  <span class='co'>#     # levels = c("Yes", "No")),</span>
  <span class='co'>#     levels = c("Yes")),</span>
  <span class='co'>#   row.names = rownames(best_set)),</span>
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster-group: "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    vs6 <span class='op'>=</span> <span class='va'>vs6_colours</span>,
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span id="fig:heat-uniquely-up-logExp-cluster-12-vs-11"></span>
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-12-vs-11-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title." width="624" />
<p class="caption">
Figure 18: Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title.
</p>
</div>
</div>
<p>DGE lists of these comparisons are available in <a href="..output/marker_genes/S3_only/uniquely_up/cluster_11_vs_12/"><code>output/marker_genes/S3_only/uniquely_up/cluster_11_vs_12/</code></a>.</p>
<h4 id="summary-11-vs-12-k-vs-l">SUMMARY: 11 vs 12 (K vs L)</h4>
<ul>
<li>cluster 11 (S3.mix.more.thymus.3 &gt;&gt;&gt; got lots of genes statistically sig express in cluster 11 only, e.g. ACTG1, IST1, CCT3, etc.</li>
<li>cluster 12 (S3.mix.more.thymus.4.center &gt;&gt;&gt; no statistically significant markers found</li>
<li>COMMENT: cluster 11 got number of unique markers (e.g. e.g. ACTG1, IST1, CCT3, etc.) and drove cluster 11 from 12</li>
</ul>
</div>
<div class="panel">
<h4 class="panel-name" id="cluster_9_10_vs_cluster_11"><code>cluster_9_10_vs_cluster_11</code></h4>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#########</span>
<span class='co'># M vs N</span>
<span class='co'>#########</span>

<span class='co'>##########################################################################################</span>
<span class='co'># cluster 9 (i.e. S3.mix.more.thymus.1) vs cluster 10 (i.e. S3.mix.more.thymus.2)</span>

<span class='co'># checkpoint</span>
<span class='va'>cp</span> <span class='op'>&lt;-</span> <span class='va'>sce</span>
<span class='co'># exclude cells of uninterested cluster from cp</span>
<span class='va'>cp</span> <span class='op'>&lt;-</span> <span class='va'>cp</span><span class='op'>[</span>, <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"9"</span> <span class='op'>|</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"10"</span> <span class='op'>|</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"11"</span><span class='op'>]</span>
<span class='fu'>colData</span><span class='op'>(</span><span class='va'>cp</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/droplevels.html'>droplevels</a></span><span class='op'>(</span><span class='fu'>colData</span><span class='op'>(</span><span class='va'>cp</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># classify cluster-group for comparison</span>
<span class='va'>cp</span><span class='op'>$</span><span class='va'>vs7</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='fl'>9</span> <span class='op'>|</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='fl'>10</span>, <span class='st'>"M"</span>, <span class='st'>"N"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># set vs colours</span>
<span class='va'>vs7_colours</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/setNames.html'>setNames</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/grDevices/palette.html'>palette.colors</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nlevels.html'>nlevels</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs7</span><span class='op'>)</span>, <span class='st'>"Set1"</span><span class='op'>)</span>,
  <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs7</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>cp</span><span class='op'>$</span><span class='va'>colours</span><span class='op'>$</span><span class='va'>vs7_colours</span> <span class='op'>&lt;-</span> <span class='va'>vs7_colours</span><span class='op'>[</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs7</span><span class='op'>]</span>

<span class='co'># find unique DE ./. cluster-groups</span>
<span class='va'>vs7_uniquely_up</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scran/man/findMarkers.html'>findMarkers</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  groups <span class='op'>=</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs7</span>,
  block <span class='op'>=</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>block</span>,
  pval.type <span class='op'>=</span> <span class='st'>"all"</span>,
  direction <span class='op'>=</span> <span class='st'>"up"</span><span class='op'>)</span>

<span class='co'># export DGE lists</span>
<span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span>
  <span class='va'>vs7_uniquely_up</span>,
  <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"C094_Pellicci.uniquely_up.cluster_9_10_vs_11.rds"</span><span class='op'>)</span>,
  compress <span class='op'>=</span> <span class='st'>"xz"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"output"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"uniquely_up"</span>, <span class='st'>"cluster_9_10_vs_11"</span><span class='op'>)</span>, recursive <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='va'>vs_pair</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"9_10"</span>, <span class='st'>"11"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='st'>"Writing 'uniquely_up (cluster_9_10_vs_11)' marker genes to file."</span><span class='op'>)</span>
<span class='kw'>for</span> <span class='op'>(</span><span class='va'>n</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs7_uniquely_up</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>
  <span class='va'>gzout</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>gzfile</a></span><span class='op'>(</span>
    description <span class='op'>=</span> <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span>
      <span class='st'>"output"</span>,
      <span class='st'>"marker_genes"</span>,
      <span class='st'>"S3_only"</span>,
      <span class='st'>"uniquely_up"</span>,
      <span class='st'>"cluster_9_10_vs_11"</span>,
      <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"cluster_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs7_uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span>,
             <span class='st'>"_vs_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs7_uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>,
             <span class='st'>".uniquely_up.csv.gz"</span><span class='op'>)</span><span class='op'>)</span>,
    open <span class='op'>=</span> <span class='st'>"wb"</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/write.table.html'>write.table</a></span><span class='op'>(</span>
    x <span class='op'>=</span> <span class='va'>vs7_uniquely_up</span><span class='op'>[[</span><span class='va'>n</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>%&gt;%</span>
      <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>tibble</span><span class='fu'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/rownames.html'>rownames_to_column</a></span><span class='op'>(</span><span class='st'>"gene_ID"</span><span class='op'>)</span>,
    file <span class='op'>=</span> <span class='va'>gzout</span>,
    sep <span class='op'>=</span> <span class='st'>","</span>,
    quote <span class='op'>=</span> <span class='cn'>FALSE</span>,
    row.names <span class='op'>=</span> <span class='cn'>FALSE</span>,
    col.names <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>close</a></span><span class='op'>(</span><span class='va'>gzout</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>###############################################################</span>
<span class='co'># look at cluster-group M / cluster 9_10 (i.e. S3.mix.more.thymus.1.and.2)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"M"</span>
<span class='va'>M_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>vs7_uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(cluster 9_10; S3.mix.more.thymus.1.and.2)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># M_uniquely_up_pcg &lt;- M_uniquely_up[intersect(protein_coding_gene_set, rownames(M_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>M_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>M_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>M_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>M_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>M_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>M_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>M_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>M_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>M_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>M_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs7</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"vs7"</span>,
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='co'># annotation_row = data.frame(</span>
  <span class='co'>#   Sig = factor(</span>
  <span class='co'>#     ifelse(best_set[, "FDR"] &lt; 0.05, "Yes", "No"),</span>
  <span class='co'>#     # TODO: temp trick to deal with the row-colouring problem</span>
  <span class='co'>#     # levels = c("Yes", "No")),</span>
  <span class='co'>#     levels = c("Yes")),</span>
  <span class='co'>#   row.names = rownames(best_set)),</span>
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster-group: "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    vs7 <span class='op'>=</span> <span class='va'>vs7_colours</span>,
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure">
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-9_10-vs-11-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title." width="624" />
<p class="caption">
(#fig:heat-uniquely-up-logExp-cluster-9_10-vs-11)Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title.
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>##########################################################</span>
<span class='co'># look at cluster-group N / cluster 11 (i.e. S3.mix.more.thymus.3)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"N"</span>
<span class='va'>N_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>vs7_uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(cluster 11; S3.mix.more.thymus.3)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># N_uniquely_up_pcg &lt;- N_uniquely_up[intersect(protein_coding_gene_set, rownames(N_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>N_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>N_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>N_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>N_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>N_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>N_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>N_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>N_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>N_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>N_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs7</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"vs7"</span>,
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='co'># annotation_row = data.frame(</span>
  <span class='co'>#   Sig = factor(</span>
  <span class='co'>#     ifelse(best_set[, "FDR"] &lt; 0.05, "Yes", "No"),</span>
  <span class='co'>#     # TODO: temp trick to deal with the row-colouring problem</span>
  <span class='co'>#     # levels = c("Yes", "No")),</span>
  <span class='co'>#     levels = c("Yes")),</span>
  <span class='co'># row.names = rownames(best_set)),</span>
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster-group: "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    vs7 <span class='op'>=</span> <span class='va'>vs7_colours</span>,
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure">
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-11-vs-9_10-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title." width="624" />
<p class="caption">
(#fig:heat-uniquely-up-logExp-cluster-11-vs-9_10)Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title.
</p>
</div>
</div>
<p>DGE lists of these comparisons are available in <a href="..output/marker_genes/S3_only/uniquely_up/cluster_9_10_vs_11/"><code>output/marker_genes/S3_only/uniquely_up/cluster_9_10_vs_11/</code></a>.</p>
<h4 id="summary-9_10-vs-11-m-vs-n">SUMMARY: 9_10 vs 11 (M vs N)</h4>
<ul>
<li>cluster 1_2 (S3.mix.more.thymus.1.and.2 &gt;&gt;&gt; statistically no significant marker could be found</li>
<li>cluster 11 (S3.mix.more.thymus.3 &gt;&gt;&gt; statistically no significant marker could be found</li>
<li>COMMENT: could it be the case that when cluster 9 and 10 are too different; when compare something that is “internally different” with another cluster would decrease the statistical power (as both 9_vs_11 and 10_vs_11 are proven to be different)?</li>
</ul>
</div>
<div class="panel">
<h4 class="panel-name" id="cluster_10_11_vs_cluster_9"><code>cluster_10_11_vs_cluster_9</code></h4>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#########</span>
<span class='co'># O vs P</span>
<span class='co'>#########</span>

<span class='co'>##########################################################################################</span>
<span class='co'># cluster 10_11 (i.e. S3.mix.more.thymus.2.and.3) vs cluster 9 (i.e. S3.mix.more.thymus.1)</span>

<span class='co'># checkpoint</span>
<span class='va'>cp</span> <span class='op'>&lt;-</span> <span class='va'>sce</span>
<span class='co'># exclude cells of uninterested cluster from cp</span>
<span class='va'>cp</span> <span class='op'>&lt;-</span> <span class='va'>cp</span><span class='op'>[</span>, <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"9"</span> <span class='op'>|</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"10"</span> <span class='op'>|</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"11"</span><span class='op'>]</span>
<span class='fu'>colData</span><span class='op'>(</span><span class='va'>cp</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/droplevels.html'>droplevels</a></span><span class='op'>(</span><span class='fu'>colData</span><span class='op'>(</span><span class='va'>cp</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># classify cluster-group for comparison</span>
<span class='va'>cp</span><span class='op'>$</span><span class='va'>vs8</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='fl'>10</span> <span class='op'>|</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='fl'>11</span>, <span class='st'>"O"</span>, <span class='st'>"P"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># set vs colours</span>
<span class='va'>vs8_colours</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/setNames.html'>setNames</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/grDevices/palette.html'>palette.colors</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nlevels.html'>nlevels</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs8</span><span class='op'>)</span>, <span class='st'>"Set1"</span><span class='op'>)</span>,
  <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs8</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>cp</span><span class='op'>$</span><span class='va'>colours</span><span class='op'>$</span><span class='va'>vs8_colours</span> <span class='op'>&lt;-</span> <span class='va'>vs8_colours</span><span class='op'>[</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs8</span><span class='op'>]</span>

<span class='co'># find unique DE ./. cluster-groups</span>
<span class='va'>vs8_uniquely_up</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scran/man/findMarkers.html'>findMarkers</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  groups <span class='op'>=</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs8</span>,
  block <span class='op'>=</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>block</span>,
  pval.type <span class='op'>=</span> <span class='st'>"all"</span>,
  direction <span class='op'>=</span> <span class='st'>"up"</span><span class='op'>)</span>

<span class='co'># export DGE lists</span>
<span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span>
  <span class='va'>vs8_uniquely_up</span>,
  <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"C094_Pellicci.uniquely_up.cluster_10_11_vs_9.rds"</span><span class='op'>)</span>,
  compress <span class='op'>=</span> <span class='st'>"xz"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"output"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"uniquely_up"</span>, <span class='st'>"cluster_10_11_vs_9"</span><span class='op'>)</span>, recursive <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='va'>vs_pair</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"10_11"</span>, <span class='st'>"9"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='st'>"Writing 'uniquely_up (cluster_10_11_vs_9)' marker genes to file."</span><span class='op'>)</span>
<span class='kw'>for</span> <span class='op'>(</span><span class='va'>n</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs8_uniquely_up</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>
  <span class='va'>gzout</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>gzfile</a></span><span class='op'>(</span>
    description <span class='op'>=</span> <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span>
      <span class='st'>"output"</span>,
      <span class='st'>"marker_genes"</span>,
      <span class='st'>"S3_only"</span>,
      <span class='st'>"uniquely_up"</span>,
      <span class='st'>"cluster_10_11_vs_9"</span>,
      <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"cluster_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs8_uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span>,
             <span class='st'>"_vs_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs8_uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>,
             <span class='st'>".uniquely_up.csv.gz"</span><span class='op'>)</span><span class='op'>)</span>,
    open <span class='op'>=</span> <span class='st'>"wb"</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/write.table.html'>write.table</a></span><span class='op'>(</span>
    x <span class='op'>=</span> <span class='va'>vs8_uniquely_up</span><span class='op'>[[</span><span class='va'>n</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>%&gt;%</span>
      <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>tibble</span><span class='fu'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/rownames.html'>rownames_to_column</a></span><span class='op'>(</span><span class='st'>"gene_ID"</span><span class='op'>)</span>,
    file <span class='op'>=</span> <span class='va'>gzout</span>,
    sep <span class='op'>=</span> <span class='st'>","</span>,
    quote <span class='op'>=</span> <span class='cn'>FALSE</span>,
    row.names <span class='op'>=</span> <span class='cn'>FALSE</span>,
    col.names <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>close</a></span><span class='op'>(</span><span class='va'>gzout</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>###############################################################</span>
<span class='co'># look at cluster-group O / cluster 10_11 (i.e. S3.mix.more.thymus.2.and.3)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"O"</span>
<span class='va'>O_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>vs8_uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(cluster 10_11; S3.mix.more.thymus.2.and.3)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># O_uniquely_up_pcg &lt;- O_uniquely_up[intersect(protein_coding_gene_set, rownames(O_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>O_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>O_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>O_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>O_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>O_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>O_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>O_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>O_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>O_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>O_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs8</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"vs8"</span>,
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  annotation_row <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    Sig <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>[</span>, <span class='st'>"FDR"</span><span class='op'>]</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span>, <span class='st'>"Yes"</span>, <span class='st'>"No"</span><span class='op'>)</span>,
      <span class='co'># TODO: temp trick to deal with the row-colouring problem</span>
      <span class='co'># levels = c("Yes", "No")),</span>
      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Yes"</span><span class='op'>)</span><span class='op'>)</span>,
    row.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster-group: "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    vs8 <span class='op'>=</span> <span class='va'>vs8_colours</span>,
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure">
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-10_11-vs-9-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title." width="624" />
<p class="caption">
(#fig:heat-uniquely-up-logExp-cluster-10_11-vs-9)Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title.
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>##########################################################</span>
<span class='co'># look at cluster-group P / cluster 9 (i.e. S3.mix.more.thymus.1)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"P"</span>
<span class='va'>P_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>vs8_uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(cluster 9; S3.mix.more.thymus.1)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># P_uniquely_up_pcg &lt;- P_uniquely_up[intersect(protein_coding_gene_set, rownames(P_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>P_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>P_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>P_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>P_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>P_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>P_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>P_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>P_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>P_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>P_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs8</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"vs8"</span>,
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  annotation_row <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    Sig <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>[</span>, <span class='st'>"FDR"</span><span class='op'>]</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span>, <span class='st'>"Yes"</span>, <span class='st'>"No"</span><span class='op'>)</span>,
      <span class='co'># TODO: temp trick to deal with the row-colouring problem</span>
      <span class='co'># levels = c("Yes", "No")),</span>
      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Yes"</span><span class='op'>)</span><span class='op'>)</span>,
    row.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster-group: "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    vs8 <span class='op'>=</span> <span class='va'>vs8_colours</span>,
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure">
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-9-vs-10_11-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title." width="624" />
<p class="caption">
(#fig:heat-uniquely-up-logExp-cluster-9-vs-10_11)Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title.
</p>
</div>
</div>
<p>DGE lists of these comparisons are available in <a href="..output/marker_genes/S3_only/uniquely_up/cluster_10_11_vs_9/"><code>output/marker_genes/S3_only/uniquely_up/cluster_10_11_vs_9/</code></a>.</p>
<h4 id="summary-10_11-vs-9-o-vs-p">SUMMARY: 10_11 vs 9 (O vs P)</h4>
<ul>
<li>cluster 10_11 (S3.mix.more.thymus.2.and.3 &gt;&gt;&gt; got several marker significantly up-regulated in cluster 10_11 (e.g CCL5, EFHD2, CST7, ITGB2, etc.)</li>
<li>cluster 9 (S3.mix.more.thymus.1 &gt;&gt;&gt; got several markers as well (e.g. IL7R, LRRC75A; for LTB, IFITM3 and IFITM1, they seems to have higher expression in donor 3)</li>
<li>COMMENT: cluster 9 clearly separated from 10_11, where 10 and 11 could be more similar; this can also explain why cluster 9 partner with 10 show no difference when compare to 11 !</li>
</ul>
</div>
<div class="panel">
<h4 class="panel-name" id="cluster_9_11_vs_cluster_10"><code>cluster_9_11_vs_cluster_10</code></h4>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#########</span>
<span class='co'># Q vs R</span>
<span class='co'>#########</span>

<span class='co'>##########################################################################################</span>
<span class='co'># cluster 9_11 (i.e. S3.mix.more.thymus.1.and.3) vs cluster 10 (i.e. S3.mix.more.thymus.2)</span>

<span class='co'># checkpoint</span>
<span class='va'>cp</span> <span class='op'>&lt;-</span> <span class='va'>sce</span>
<span class='co'># exclude cells of uninterested cluster from cp</span>
<span class='va'>cp</span> <span class='op'>&lt;-</span> <span class='va'>cp</span><span class='op'>[</span>, <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"9"</span> <span class='op'>|</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"10"</span> <span class='op'>|</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"11"</span><span class='op'>]</span>
<span class='fu'>colData</span><span class='op'>(</span><span class='va'>cp</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/droplevels.html'>droplevels</a></span><span class='op'>(</span><span class='fu'>colData</span><span class='op'>(</span><span class='va'>cp</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># classify cluster-group for comparison</span>
<span class='va'>cp</span><span class='op'>$</span><span class='va'>vs9</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='fl'>9</span> <span class='op'>|</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='fl'>11</span>, <span class='st'>"Q"</span>, <span class='st'>"R"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># set vs colours</span>
<span class='va'>vs9_colours</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/setNames.html'>setNames</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/grDevices/palette.html'>palette.colors</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nlevels.html'>nlevels</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs9</span><span class='op'>)</span>, <span class='st'>"Set1"</span><span class='op'>)</span>,
  <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs9</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>cp</span><span class='op'>$</span><span class='va'>colours</span><span class='op'>$</span><span class='va'>vs9_colours</span> <span class='op'>&lt;-</span> <span class='va'>vs9_colours</span><span class='op'>[</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs9</span><span class='op'>]</span>

<span class='co'># find unique DE ./. cluster-groups</span>
<span class='va'>vs9_uniquely_up</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scran/man/findMarkers.html'>findMarkers</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  groups <span class='op'>=</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs9</span>,
  block <span class='op'>=</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>block</span>,
  pval.type <span class='op'>=</span> <span class='st'>"all"</span>,
  direction <span class='op'>=</span> <span class='st'>"up"</span><span class='op'>)</span>

<span class='co'># export DGE lists</span>
<span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span>
  <span class='va'>vs9_uniquely_up</span>,
  <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"C094_Pellicci.uniquely_up.cluster_9_11_vs_10.rds"</span><span class='op'>)</span>,
  compress <span class='op'>=</span> <span class='st'>"xz"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"output"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"uniquely_up"</span>, <span class='st'>"cluster_9_11_vs_10"</span><span class='op'>)</span>, recursive <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='va'>vs_pair</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"9_11"</span>, <span class='st'>"10"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='st'>"Writing 'uniquely_up (cluster_9_11_vs_10)' marker genes to file."</span><span class='op'>)</span>
<span class='kw'>for</span> <span class='op'>(</span><span class='va'>n</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs9_uniquely_up</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>
  <span class='va'>gzout</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>gzfile</a></span><span class='op'>(</span>
    description <span class='op'>=</span> <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span>
      <span class='st'>"output"</span>,
      <span class='st'>"marker_genes"</span>,
      <span class='st'>"S3_only"</span>,
      <span class='st'>"uniquely_up"</span>,
      <span class='st'>"cluster_9_11_vs_10"</span>,
      <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"cluster_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs9_uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span>,
             <span class='st'>"_vs_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs9_uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>,
             <span class='st'>".uniquely_up.csv.gz"</span><span class='op'>)</span><span class='op'>)</span>,
    open <span class='op'>=</span> <span class='st'>"wb"</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/write.table.html'>write.table</a></span><span class='op'>(</span>
    x <span class='op'>=</span> <span class='va'>vs9_uniquely_up</span><span class='op'>[[</span><span class='va'>n</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>%&gt;%</span>
      <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>tibble</span><span class='fu'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/rownames.html'>rownames_to_column</a></span><span class='op'>(</span><span class='st'>"gene_ID"</span><span class='op'>)</span>,
    file <span class='op'>=</span> <span class='va'>gzout</span>,
    sep <span class='op'>=</span> <span class='st'>","</span>,
    quote <span class='op'>=</span> <span class='cn'>FALSE</span>,
    row.names <span class='op'>=</span> <span class='cn'>FALSE</span>,
    col.names <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>close</a></span><span class='op'>(</span><span class='va'>gzout</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>###############################################################</span>
<span class='co'># look at cluster-group Q / cluster 9_11 (i.e. S3.mix.more.thymus.1.and.3)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"Q"</span>
<span class='va'>Q_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>vs9_uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(cluster 9_11; S3.mix.more.thymus.1.and.3)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># Q_uniquely_up_pcg &lt;- Q_uniquely_up[intersect(protein_coding_gene_set, rownames(Q_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>Q_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>Q_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>Q_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>Q_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>Q_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>Q_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>Q_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>Q_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>Q_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>Q_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs9</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"vs9"</span>,
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  annotation_row <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    Sig <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>[</span>, <span class='st'>"FDR"</span><span class='op'>]</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span>, <span class='st'>"Yes"</span>, <span class='st'>"No"</span><span class='op'>)</span>,
      <span class='co'># TODO: temp trick to deal with the row-colouring problem</span>
      <span class='co'># levels = c("Yes", "No")),</span>
      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Yes"</span><span class='op'>)</span><span class='op'>)</span>,
    row.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster-group: "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    vs9 <span class='op'>=</span> <span class='va'>vs9_colours</span>,
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure">
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-9_11-vs-10-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title." width="624" />
<p class="caption">
(#fig:heat-uniquely-up-logExp-cluster-9_11-vs-10)Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title.
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>##########################################################</span>
<span class='co'># look at cluster-group R / cluster 10 (i.e. S3.mix.more.thymus.2)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"R"</span>
<span class='va'>R_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>vs9_uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(cluster 10; S3.mix.more.thymus.2)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># R_uniquely_up_pcg &lt;- R_uniquely_up[intersect(protein_coding_gene_set, rownames(R_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>R_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>R_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>R_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>R_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>R_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>R_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>R_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>R_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>R_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>R_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs9</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"vs9"</span>,
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  annotation_row <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    Sig <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>[</span>, <span class='st'>"FDR"</span><span class='op'>]</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span>, <span class='st'>"Yes"</span>, <span class='st'>"No"</span><span class='op'>)</span>,
      <span class='co'># TODO: temp trick to deal with the row-colouring problem</span>
      <span class='co'># levels = c("Yes", "No")),</span>
      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Yes"</span><span class='op'>)</span><span class='op'>)</span>,
    row.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster-group: "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    vs9 <span class='op'>=</span> <span class='va'>vs9_colours</span>,
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure">
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-10-vs-9_11-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title." width="624" />
<p class="caption">
(#fig:heat-uniquely-up-logExp-cluster-10-vs-9_11)Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title.
</p>
</div>
</div>
<p>DGE lists of these comparisons are available in <a href="..output/marker_genes/S3_only/uniquely_up/cluster_9_11_vs_10/"><code>output/marker_genes/S3_only/uniquely_up/cluster_9_11_vs_10/</code></a>.</p>
<h4 id="summary-9_11-vs-10-q-vs-r">SUMMARY: 9_11 vs 10 (Q vs R)</h4>
<ul>
<li>cluster 9_11 (S3.mix.more.thymus.1.and.3 &gt;&gt;&gt; lots of markers significantly up-regulated in cluster 9_11 (e.g. PRKDC, SCAI, DDX54)</li>
<li>cluster 10 (S3.mix.more.thymus.2 &gt;&gt;&gt; besides NPIPB family member, it got CCL5, SYNE2 and AC009022.9 as its markers</li>
<li>COMMENT: if cluster 11 is in the combination, it returns DE; does this means … cluster 11 is more different from cluster 9 or 10 ?</li>
</ul>
</div>
<div class="panel">
<h4 class="panel-name" id="cluster_9_10_vs_cluster_12"><code>cluster_9_10_vs_cluster_12</code></h4>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#########</span>
<span class='co'># S vs T</span>
<span class='co'>#########</span>

<span class='co'>##########################################################################################</span>
<span class='co'># cluster 9_10 (i.e. S3.mix.more.thymus.1) vs cluster 12 (i.e. S3.mix.more.thymus.4.center)</span>

<span class='co'># checkpoint</span>
<span class='va'>cp</span> <span class='op'>&lt;-</span> <span class='va'>sce</span>
<span class='co'># exclude cells of uninterested cluster from cp</span>
<span class='va'>cp</span> <span class='op'>&lt;-</span> <span class='va'>cp</span><span class='op'>[</span>, <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"9"</span> <span class='op'>|</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"10"</span> <span class='op'>|</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"12"</span><span class='op'>]</span>
<span class='fu'>colData</span><span class='op'>(</span><span class='va'>cp</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/droplevels.html'>droplevels</a></span><span class='op'>(</span><span class='fu'>colData</span><span class='op'>(</span><span class='va'>cp</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># classify cluster-group for comparison</span>
<span class='va'>cp</span><span class='op'>$</span><span class='va'>vs10</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='fl'>9</span> <span class='op'>|</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='fl'>10</span>, <span class='st'>"S"</span>, <span class='st'>"T"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># set vs colours</span>
<span class='va'>vs10_colours</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/setNames.html'>setNames</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/grDevices/palette.html'>palette.colors</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nlevels.html'>nlevels</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs10</span><span class='op'>)</span>, <span class='st'>"Set1"</span><span class='op'>)</span>,
  <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs10</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>cp</span><span class='op'>$</span><span class='va'>colours</span><span class='op'>$</span><span class='va'>vs10_colours</span> <span class='op'>&lt;-</span> <span class='va'>vs10_colours</span><span class='op'>[</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs10</span><span class='op'>]</span>

<span class='co'># find unique DE ./. cluster-groups</span>
<span class='va'>vs10_uniquely_up</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scran/man/findMarkers.html'>findMarkers</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  groups <span class='op'>=</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs10</span>,
  block <span class='op'>=</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>block</span>,
  pval.type <span class='op'>=</span> <span class='st'>"all"</span>,
  direction <span class='op'>=</span> <span class='st'>"up"</span><span class='op'>)</span>

<span class='co'># export DGE lists</span>
<span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span>
  <span class='va'>vs10_uniquely_up</span>,
  <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"C094_Pellicci.uniquely_up.cluster_9_10_vs_12.rds"</span><span class='op'>)</span>,
  compress <span class='op'>=</span> <span class='st'>"xz"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"output"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"uniquely_up"</span>, <span class='st'>"cluster_9_10_vs_12"</span><span class='op'>)</span>, recursive <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='va'>vs_pair</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"9_10"</span>, <span class='st'>"12"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='st'>"Writing 'uniquely_up (cluster_9_10_vs_12)' marker genes to file."</span><span class='op'>)</span>
<span class='kw'>for</span> <span class='op'>(</span><span class='va'>n</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs10_uniquely_up</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>
  <span class='va'>gzout</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>gzfile</a></span><span class='op'>(</span>
    description <span class='op'>=</span> <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span>
      <span class='st'>"output"</span>,
      <span class='st'>"marker_genes"</span>,
      <span class='st'>"S3_only"</span>,
      <span class='st'>"uniquely_up"</span>,
      <span class='st'>"cluster_9_10_vs_12"</span>,
      <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"cluster_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs10_uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span>,
             <span class='st'>"_vs_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs10_uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>,
             <span class='st'>".uniquely_up.csv.gz"</span><span class='op'>)</span><span class='op'>)</span>,
    open <span class='op'>=</span> <span class='st'>"wb"</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/write.table.html'>write.table</a></span><span class='op'>(</span>
    x <span class='op'>=</span> <span class='va'>vs10_uniquely_up</span><span class='op'>[[</span><span class='va'>n</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>%&gt;%</span>
      <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>tibble</span><span class='fu'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/rownames.html'>rownames_to_column</a></span><span class='op'>(</span><span class='st'>"gene_ID"</span><span class='op'>)</span>,
    file <span class='op'>=</span> <span class='va'>gzout</span>,
    sep <span class='op'>=</span> <span class='st'>","</span>,
    quote <span class='op'>=</span> <span class='cn'>FALSE</span>,
    row.names <span class='op'>=</span> <span class='cn'>FALSE</span>,
    col.names <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>close</a></span><span class='op'>(</span><span class='va'>gzout</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>###############################################################</span>
<span class='co'># look at cluster-group S / cluster 9_10 (i.e. S3.mix.more.thymus.1.and.2)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"S"</span>
<span class='va'>S_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>vs10_uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(cluster 9_10; S3.mix.more.thymus.1.and.2)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># S_uniquely_up_pcg &lt;- S_uniquely_up[intersect(protein_coding_gene_set, rownames(S_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>S_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>S_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>S_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>S_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>S_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>S_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>S_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>S_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>S_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>S_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs10</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"vs10"</span>,
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  annotation_row <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    Sig <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>[</span>, <span class='st'>"FDR"</span><span class='op'>]</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span>, <span class='st'>"Yes"</span>, <span class='st'>"No"</span><span class='op'>)</span>,
      <span class='co'># TODO: temp trick to deal with the row-colouring problem</span>
      <span class='co'># levels = c("Yes", "No")),</span>
      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Yes"</span><span class='op'>)</span><span class='op'>)</span>,
    row.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster-group: "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    vs10 <span class='op'>=</span> <span class='va'>vs10_colours</span>,
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure">
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-9_10-vs-12-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title." width="624" />
<p class="caption">
(#fig:heat-uniquely-up-logExp-cluster-9_10-vs-12)Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title.
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>##########################################################</span>
<span class='co'># look at cluster-group T / cluster 12 (i.e. S3.mix.more.thymus.4.center)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"T"</span>
<span class='va'>T_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>vs10_uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(cluster 12; S3.mix.more.thymus.4.center)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># T_uniquely_up_pcg &lt;- T_uniquely_up[intersect(protein_coding_gene_set, rownames(T_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>T_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>T_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>T_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>T_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>T_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>T_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>T_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>T_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>T_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>T_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs10</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"vs10"</span>,
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  annotation_row <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    Sig <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>[</span>, <span class='st'>"FDR"</span><span class='op'>]</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span>, <span class='st'>"Yes"</span>, <span class='st'>"No"</span><span class='op'>)</span>,
      <span class='co'># TODO: temp trick to deal with the row-colouring problem</span>
      <span class='co'># levels = c("Yes", "No")),</span>
      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Yes"</span><span class='op'>)</span><span class='op'>)</span>,
    row.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster-group: "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    vs10 <span class='op'>=</span> <span class='va'>vs10_colours</span>,
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure">
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-12-vs-9_10-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title." width="624" />
<p class="caption">
(#fig:heat-uniquely-up-logExp-cluster-12-vs-9_10)Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title.
</p>
</div>
</div>
<p>DGE lists of these comparisons are available in <a href="..output/marker_genes/S3_only/uniquely_up/cluster_9_10_vs_12/"><code>output/marker_genes/S3_only/uniquely_up/cluster_9_10_vs_12/</code></a>.</p>
<h4 id="summary-9_10-vs-12-s-vs-t">SUMMARY: 9_10 vs 12 (S vs T)</h4>
<ul>
<li>cluster 9_10 (S3.mix.more.thymus.1.and.2 &gt;&gt;&gt; lot of markers on cluster 9_10 (e/g/ AIP, NIM, POLE3, etc.)</li>
<li>cluster 12 (S3.mix.more.thymus.4 &gt;&gt;&gt; except for the mitochondrial gene, no statistically significant markers found</li>
<li>COMMENT: consistently, 12 show no marker, uniqueness is from cluster 9_10</li>
</ul>
</div>
<div class="panel">
<h4 class="panel-name" id="cluster_10_11_vs_cluster_12"><code>cluster_10_11_vs_cluster_12</code></h4>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#########</span>
<span class='co'># U vs V</span>
<span class='co'>#########</span>

<span class='co'>##########################################################################################</span>
<span class='co'># cluster 10_11 (i.e. S3.mix.more.thymus.2.and.3) vs cluster 12 (i.e. S3.mix.more.thymus.4.center)</span>

<span class='co'># checkpoint</span>
<span class='va'>cp</span> <span class='op'>&lt;-</span> <span class='va'>sce</span>
<span class='co'># exclude cells of uninterested cluster from cp</span>
<span class='va'>cp</span> <span class='op'>&lt;-</span> <span class='va'>cp</span><span class='op'>[</span>, <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"10"</span> <span class='op'>|</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"11"</span> <span class='op'>|</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"12"</span><span class='op'>]</span>
<span class='fu'>colData</span><span class='op'>(</span><span class='va'>cp</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/droplevels.html'>droplevels</a></span><span class='op'>(</span><span class='fu'>colData</span><span class='op'>(</span><span class='va'>cp</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># classify cluster-group for comparison</span>
<span class='va'>cp</span><span class='op'>$</span><span class='va'>vs11</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='fl'>10</span> <span class='op'>|</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='fl'>11</span>, <span class='st'>"U"</span>, <span class='st'>"V"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># set vs colours</span>
<span class='va'>vs11_colours</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/setNames.html'>setNames</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/grDevices/palette.html'>palette.colors</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nlevels.html'>nlevels</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs11</span><span class='op'>)</span>, <span class='st'>"Set1"</span><span class='op'>)</span>,
  <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs11</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>cp</span><span class='op'>$</span><span class='va'>colours</span><span class='op'>$</span><span class='va'>vs11_colours</span> <span class='op'>&lt;-</span> <span class='va'>vs11_colours</span><span class='op'>[</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs11</span><span class='op'>]</span>

<span class='co'># find unique DE ./. cluster-groups</span>
<span class='va'>vs11_uniquely_up</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scran/man/findMarkers.html'>findMarkers</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  groups <span class='op'>=</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs11</span>,
  block <span class='op'>=</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>block</span>,
  pval.type <span class='op'>=</span> <span class='st'>"all"</span>,
  direction <span class='op'>=</span> <span class='st'>"up"</span><span class='op'>)</span>

<span class='co'># export DGE lists</span>
<span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span>
  <span class='va'>vs11_uniquely_up</span>,
  <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"C094_Pellicci.uniquely_up.cluster_10_11_vs_12.rds"</span><span class='op'>)</span>,
  compress <span class='op'>=</span> <span class='st'>"xz"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"output"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"uniquely_up"</span>, <span class='st'>"cluster_10_11_vs_12"</span><span class='op'>)</span>, recursive <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='va'>vs_pair</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"10_11"</span>, <span class='st'>"12"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='st'>"Writing 'uniquely_up (cluster_10_11_vs_12)' marker genes to file."</span><span class='op'>)</span>
<span class='kw'>for</span> <span class='op'>(</span><span class='va'>n</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs11_uniquely_up</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>
  <span class='va'>gzout</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>gzfile</a></span><span class='op'>(</span>
    description <span class='op'>=</span> <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span>
      <span class='st'>"output"</span>,
      <span class='st'>"marker_genes"</span>,
      <span class='st'>"S3_only"</span>,
      <span class='st'>"uniquely_up"</span>,
      <span class='st'>"cluster_10_11_vs_12"</span>,
      <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"cluster_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs11_uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span>,
             <span class='st'>"_vs_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs11_uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>,
             <span class='st'>".uniquely_up.csv.gz"</span><span class='op'>)</span><span class='op'>)</span>,
    open <span class='op'>=</span> <span class='st'>"wb"</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/write.table.html'>write.table</a></span><span class='op'>(</span>
    x <span class='op'>=</span> <span class='va'>vs11_uniquely_up</span><span class='op'>[[</span><span class='va'>n</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>%&gt;%</span>
      <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>tibble</span><span class='fu'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/rownames.html'>rownames_to_column</a></span><span class='op'>(</span><span class='st'>"gene_ID"</span><span class='op'>)</span>,
    file <span class='op'>=</span> <span class='va'>gzout</span>,
    sep <span class='op'>=</span> <span class='st'>","</span>,
    quote <span class='op'>=</span> <span class='cn'>FALSE</span>,
    row.names <span class='op'>=</span> <span class='cn'>FALSE</span>,
    col.names <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>close</a></span><span class='op'>(</span><span class='va'>gzout</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>###############################################################</span>
<span class='co'># look at cluster-group U / cluster 10_11 (i.e. S3.mix.more.thymus.2.and.3)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"U"</span>
<span class='va'>U_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>vs11_uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(cluster 10_11; S3.mix.more.thymus.2.and.3)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># U_uniquely_up_pcg &lt;- U_uniquely_up[intersect(protein_coding_gene_set, rownames(U_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>U_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>U_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>U_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>U_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>U_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>U_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>U_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>U_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>U_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>U_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs11</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"vs11"</span>,
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  annotation_row <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    Sig <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>[</span>, <span class='st'>"FDR"</span><span class='op'>]</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span>, <span class='st'>"Yes"</span>, <span class='st'>"No"</span><span class='op'>)</span>,
      <span class='co'># TODO: temp trick to deal with the row-colouring problem</span>
      <span class='co'># levels = c("Yes", "No")),</span>
      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Yes"</span><span class='op'>)</span><span class='op'>)</span>,
    row.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster-group: "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    vs11 <span class='op'>=</span> <span class='va'>vs11_colours</span>,
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure">
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-10_11-vs-12-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title." width="624" />
<p class="caption">
(#fig:heat-uniquely-up-logExp-cluster-10_11-vs-12)Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title.
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>##########################################################</span>
<span class='co'># look at cluster-group V / cluster 12 (i.e. S3.mix.more.thymus.4.center)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"V"</span>
<span class='va'>V_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>vs11_uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(cluster 12; S3.mix.more.thymus.4.center)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># V_uniquely_up_pcg &lt;- V_uniquely_up[intersect(protein_coding_gene_set, rownames(V_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>V_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>V_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>V_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>V_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>V_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>V_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>V_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>V_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>V_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>V_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs11</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"vs11"</span>,
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='co'># annotation_row = data.frame(</span>
  <span class='co'>#   Sig = factor(</span>
  <span class='co'>#     ifelse(best_set[, "FDR"] &lt; 0.05, "Yes", "No"),</span>
  <span class='co'>#     # TODO: temp trick to deal with the row-colouring problem</span>
  <span class='co'>#     # levels = c("Yes", "No")),</span>
  <span class='co'>#     levels = c("Yes")),</span>
  <span class='co'>#   row.names = rownames(best_set)),</span>
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster-group: "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    vs11 <span class='op'>=</span> <span class='va'>vs11_colours</span>,
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure">
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-12-vs-10_11-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title." width="624" />
<p class="caption">
(#fig:heat-uniquely-up-logExp-cluster-12-vs-10_11)Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title.
</p>
</div>
</div>
<p>DGE lists of these comparisons are available in <a href="..output/marker_genes/S3_only/uniquely_up/cluster_10_11_vs_12/"><code>output/marker_genes/S3_only/uniquely_up/cluster_10_11_vs_12/</code></a>.</p>
<h4 id="summary-10_11-vs-12-u-vs-v">SUMMARY: 10_11 vs 12 (U vs V)</h4>
<ul>
<li>cluster 10_11 (S3.mix.more.thymus.2.and.3 &gt;&gt;&gt; lots of markers significantly up-regulated in 10_11</li>
<li>cluster 12 (S3.mix.more.thymus.4 &gt;&gt;&gt; no statistically significant marker found on this centered cluster</li>
<li>COMMENT: consistently, cluster 12 show no marker, uniqueness is from cluster 10_11</li>
</ul>
</div>
<div class="panel">
<h4 class="panel-name" id="cluster_9_11_vs_cluster_12"><code>cluster_9_11_vs_cluster_12</code></h4>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#########</span>
<span class='co'># W vs X</span>
<span class='co'>#########</span>

<span class='co'>##########################################################################################</span>
<span class='co'># cluster 9_11 (i.e. S3.mix.more.thymus.1.and.3) vs cluster 12 (i.e. S3.mix.more.thymus.4.center)</span>

<span class='co'># checkpoint</span>
<span class='va'>cp</span> <span class='op'>&lt;-</span> <span class='va'>sce</span>
<span class='co'># exclude cells of uninterested cluster from cp</span>
<span class='va'>cp</span> <span class='op'>&lt;-</span> <span class='va'>cp</span><span class='op'>[</span>, <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"9"</span> <span class='op'>|</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"11"</span> <span class='op'>|</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='st'>"12"</span><span class='op'>]</span>
<span class='fu'>colData</span><span class='op'>(</span><span class='va'>cp</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/droplevels.html'>droplevels</a></span><span class='op'>(</span><span class='fu'>colData</span><span class='op'>(</span><span class='va'>cp</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># classify cluster-group for comparison</span>
<span class='va'>cp</span><span class='op'>$</span><span class='va'>vs12</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='fl'>9</span> <span class='op'>|</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='fl'>11</span>, <span class='st'>"W"</span>, <span class='st'>"X"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># set vs colours</span>
<span class='va'>vs12_colours</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/setNames.html'>setNames</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/grDevices/palette.html'>palette.colors</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nlevels.html'>nlevels</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs12</span><span class='op'>)</span>, <span class='st'>"Set1"</span><span class='op'>)</span>,
  <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs12</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>cp</span><span class='op'>$</span><span class='va'>colours</span><span class='op'>$</span><span class='va'>vs12_colours</span> <span class='op'>&lt;-</span> <span class='va'>vs12_colours</span><span class='op'>[</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs12</span><span class='op'>]</span>

<span class='co'># find unique DE ./. cluster-groups</span>
<span class='va'>vs12_uniquely_up</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scran/man/findMarkers.html'>findMarkers</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  groups <span class='op'>=</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs12</span>,
  block <span class='op'>=</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>block</span>,
  pval.type <span class='op'>=</span> <span class='st'>"all"</span>,
  direction <span class='op'>=</span> <span class='st'>"up"</span><span class='op'>)</span>

<span class='co'># export DGE lists</span>
<span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span>
  <span class='va'>vs12_uniquely_up</span>,
  <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"C094_Pellicci.uniquely_up.cluster_9_11_vs_12.rds"</span><span class='op'>)</span>,
  compress <span class='op'>=</span> <span class='st'>"xz"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"output"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"uniquely_up"</span>, <span class='st'>"cluster_9_11_vs_12"</span><span class='op'>)</span>, recursive <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='va'>vs_pair</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"9_11"</span>, <span class='st'>"12"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='st'>"Writing 'uniquely_up (cluster_9_11_vs_12)' marker genes to file."</span><span class='op'>)</span>
<span class='kw'>for</span> <span class='op'>(</span><span class='va'>n</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs12_uniquely_up</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>
  <span class='va'>gzout</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>gzfile</a></span><span class='op'>(</span>
    description <span class='op'>=</span> <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span>
      <span class='st'>"output"</span>,
      <span class='st'>"marker_genes"</span>,
      <span class='st'>"S3_only"</span>,
      <span class='st'>"uniquely_up"</span>,
      <span class='st'>"cluster_9_11_vs_12"</span>,
      <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"cluster_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs12_uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span>,
             <span class='st'>"_vs_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs12_uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>,
             <span class='st'>".uniquely_up.csv.gz"</span><span class='op'>)</span><span class='op'>)</span>,
    open <span class='op'>=</span> <span class='st'>"wb"</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/write.table.html'>write.table</a></span><span class='op'>(</span>
    x <span class='op'>=</span> <span class='va'>vs12_uniquely_up</span><span class='op'>[[</span><span class='va'>n</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>%&gt;%</span>
      <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>tibble</span><span class='fu'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/rownames.html'>rownames_to_column</a></span><span class='op'>(</span><span class='st'>"gene_ID"</span><span class='op'>)</span>,
    file <span class='op'>=</span> <span class='va'>gzout</span>,
    sep <span class='op'>=</span> <span class='st'>","</span>,
    quote <span class='op'>=</span> <span class='cn'>FALSE</span>,
    row.names <span class='op'>=</span> <span class='cn'>FALSE</span>,
    col.names <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>close</a></span><span class='op'>(</span><span class='va'>gzout</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>###############################################################</span>
<span class='co'># look at cluster-group W / cluster 9_11 (i.e. S3.mix.more.thymus.1.and.3)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"W"</span>
<span class='va'>W_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>vs12_uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(cluster 9_11; S3.mix.more.thymus.1.and.3)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># W_uniquely_up_pcg &lt;- W_uniquely_up[intersect(protein_coding_gene_set, rownames(W_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>W_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>W_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>W_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>W_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>W_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>W_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>W_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>W_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>W_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>W_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs12</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"vs12"</span>,
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  annotation_row <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    Sig <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>[</span>, <span class='st'>"FDR"</span><span class='op'>]</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span>, <span class='st'>"Yes"</span>, <span class='st'>"No"</span><span class='op'>)</span>,
      <span class='co'># TODO: temp trick to deal with the row-colouring problem</span>
      <span class='co'># levels = c("Yes", "No")),</span>
      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Yes"</span><span class='op'>)</span><span class='op'>)</span>,
    row.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster-group: "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    vs12 <span class='op'>=</span> <span class='va'>vs12_colours</span>,
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure">
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-9_11-vs-12-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title." width="624" />
<p class="caption">
(#fig:heat-uniquely-up-logExp-cluster-9_11-vs-12)Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title.
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>##########################################################</span>
<span class='co'># look at cluster-group X / cluster 12 (i.e.  S3.mix.more.thymus.4.center)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"X"</span>
<span class='va'>X_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>vs12_uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(cluster 12; S3.mix.more.thymus.4.center)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># X_uniquely_up_pcg &lt;- X_uniquely_up[intersect(protein_coding_gene_set, rownames(X_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>X_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>X_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>X_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>X_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>X_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>X_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>X_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>X_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>X_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>X_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs12</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"vs12"</span>,
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='co'># annotation_row = data.frame(</span>
  <span class='co'>#   Sig = factor(</span>
  <span class='co'>#     ifelse(best_set[, "FDR"] &lt; 0.05, "Yes", "No"),</span>
  <span class='co'>#     # TODO: temp trick to deal with the row-colouring problem</span>
  <span class='co'>#     # levels = c("Yes", "No")),</span>
  <span class='co'>#     levels = c("Yes")),</span>
  <span class='co'>#   row.names = rownames(best_set)),</span>
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster-group: "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    vs12 <span class='op'>=</span> <span class='va'>vs12_colours</span>,
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure">
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-12-vs-9_11-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title." width="624" />
<p class="caption">
(#fig:heat-uniquely-up-logExp-cluster-12-vs-9_11)Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title.
</p>
</div>
</div>
<p>DGE lists of these comparisons are available in <a href="..output/marker_genes/S3_only/uniquely_up/cluster_9_11_vs_12/"><code>output/marker_genes/S3_only/uniquely_up/cluster_9_11_vs_12/</code></a>.</p>
<h4 id="summary-9_11-vs-12-w-vs-x">SUMMARY: 9_11 vs 12 (W vs X)</h4>
<ul>
<li>cluster 9_11 (S3.mix.more.thymus.1.and.3 &gt;&gt;&gt; lots of marker more frequently expressed in 9_11</li>
<li>cluster 12 (S3.mix.more.thymus.4 &gt;&gt;&gt; no statistically significant markers</li>
<li>COMMENT: consistently, 12 show no marker, uniqueness is from cluster 9_11</li>
</ul>
</div>
<div class="panel">
<h4 class="panel-name" id="cluster_9_10_11_vs_cluster_12"><code>cluster_9_10_11_vs_cluster_12</code></h4>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#########</span>
<span class='co'># Y vs Z</span>
<span class='co'>#########</span>

<span class='co'>##########################################################################################</span>
<span class='co'># cluster 9_10_11 (i.e. S3.mix.more.thymus.1.and.2.and.3) vs cluster 12 (i.e. S3.mix.more.thymus.4.center)</span>

<span class='co'># checkpoint</span>
<span class='va'>cp</span> <span class='op'>&lt;-</span> <span class='va'>sce</span>

<span class='co'># classify cluster-group for comparison</span>
<span class='va'>cp</span><span class='op'>$</span><span class='va'>vs13</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='fl'>9</span> <span class='op'>|</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='fl'>10</span> <span class='op'>|</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span> <span class='op'>==</span> <span class='fl'>11</span>, <span class='st'>"Y"</span>, <span class='st'>"Z"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># set vs colours</span>
<span class='va'>vs13_colours</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/setNames.html'>setNames</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/grDevices/palette.html'>palette.colors</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nlevels.html'>nlevels</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs13</span><span class='op'>)</span>, <span class='st'>"Set1"</span><span class='op'>)</span>,
  <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs13</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>cp</span><span class='op'>$</span><span class='va'>colours</span><span class='op'>$</span><span class='va'>vs13_colours</span> <span class='op'>&lt;-</span> <span class='va'>vs13_colours</span><span class='op'>[</span><span class='va'>cp</span><span class='op'>$</span><span class='va'>vs13</span><span class='op'>]</span>

<span class='co'># find unique DE ./. cluster-groups</span>
<span class='va'>vs13_uniquely_up</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/scran/man/findMarkers.html'>findMarkers</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  groups <span class='op'>=</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs13</span>,
  block <span class='op'>=</span> <span class='va'>cp</span><span class='op'>$</span><span class='va'>block</span>,
  pval.type <span class='op'>=</span> <span class='st'>"all"</span>,
  direction <span class='op'>=</span> <span class='st'>"up"</span><span class='op'>)</span>

<span class='co'># export DGE lists</span>
<span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span>
  <span class='va'>vs13_uniquely_up</span>,
  <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"C094_Pellicci.uniquely_up.cluster_9_10_11_vs_12.rds"</span><span class='op'>)</span>,
  compress <span class='op'>=</span> <span class='st'>"xz"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"output"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"uniquely_up"</span>, <span class='st'>"cluster_9_10_11_vs_12"</span><span class='op'>)</span>, recursive <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='va'>vs_pair</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"9_10_11"</span>, <span class='st'>"12"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='st'>"Writing 'uniquely_up (cluster_9_10_11_vs_12)' marker genes to file."</span><span class='op'>)</span>
<span class='kw'>for</span> <span class='op'>(</span><span class='va'>n</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs13_uniquely_up</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>
  <span class='va'>gzout</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>gzfile</a></span><span class='op'>(</span>
    description <span class='op'>=</span> <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span>
      <span class='st'>"output"</span>,
      <span class='st'>"marker_genes"</span>,
      <span class='st'>"S3_only"</span>,
      <span class='st'>"uniquely_up"</span>,
      <span class='st'>"cluster_9_10_11_vs_12"</span>,
      <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"cluster_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs13_uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span>,
             <span class='st'>"_vs_"</span>,
             <span class='va'>vs_pair</span><span class='op'>[</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>vs13_uniquely_up</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>]</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>,
             <span class='st'>".uniquely_up.csv.gz"</span><span class='op'>)</span><span class='op'>)</span>,
    open <span class='op'>=</span> <span class='st'>"wb"</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/write.table.html'>write.table</a></span><span class='op'>(</span>
    x <span class='op'>=</span> <span class='va'>vs13_uniquely_up</span><span class='op'>[[</span><span class='va'>n</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>%&gt;%</span>
      <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>tibble</span><span class='fu'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/rownames.html'>rownames_to_column</a></span><span class='op'>(</span><span class='st'>"gene_ID"</span><span class='op'>)</span>,
    file <span class='op'>=</span> <span class='va'>gzout</span>,
    sep <span class='op'>=</span> <span class='st'>","</span>,
    quote <span class='op'>=</span> <span class='cn'>FALSE</span>,
    row.names <span class='op'>=</span> <span class='cn'>FALSE</span>,
    col.names <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>close</a></span><span class='op'>(</span><span class='va'>gzout</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>###############################################################</span>
<span class='co'># look at cluster-group Y / cluster 9_10_11 (i.e. S3.mix.more.thymus.1.and.2.and.3)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"Y"</span>
<span class='va'>Y_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>vs13_uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(cluster 9_10_11; S3.mix.more.thymus.1.and.2.and.3)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># Y_uniquely_up_pcg &lt;- Y_uniquely_up[intersect(protein_coding_gene_set, rownames(Y_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>Y_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>Y_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>Y_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>Y_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>Y_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>Y_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>Y_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>Y_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>Y_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>Y_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs13</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"vs13"</span>,
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  annotation_row <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    Sig <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>[</span>, <span class='st'>"FDR"</span><span class='op'>]</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span>, <span class='st'>"Yes"</span>, <span class='st'>"No"</span><span class='op'>)</span>,
      <span class='co'># TODO: temp trick to deal with the row-colouring problem</span>
      <span class='co'># levels = c("Yes", "No")),</span>
      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Yes"</span><span class='op'>)</span><span class='op'>)</span>,
    row.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster-group: "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    vs13 <span class='op'>=</span> <span class='va'>vs13_colours</span>,
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure">
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-9_10_11-vs-12-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title." width="624" />
<p class="caption">
(#fig:heat-uniquely-up-logExp-cluster-9_10_11-vs-12)Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title.
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>##########################################################</span>
<span class='co'># look at cluster-group Z / cluster 12 (i.e. S3.mix.more.thymus.4.center)</span>
<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"Z"</span>
<span class='va'>Z_uniquely_up</span> <span class='op'>&lt;-</span> <span class='va'>vs13_uniquely_up</span><span class='op'>[[</span><span class='va'>chosen</span><span class='op'>]</span><span class='op'>]</span>

<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(cluster 12; S3.mix.more.thymus.4.center)"</span>

<span class='co'># look only at protein coding gene (pcg)</span>
<span class='co'># NOTE: not suggest to narrow down into pcg as it remove all significant candidates (FDR &lt;&lt; 0.05) !</span>
<span class='co'># Z_uniquely_up_pcg &lt;- Z_uniquely_up[intersect(protein_coding_gene_set, rownames(Z_uniquely_up)), ]</span>

<span class='co'># get rid of noise (i.e. pseudo, ribo, mito, sex) that collaborator not interested in</span>
<span class='va'>Z_uniquely_up_noiseR</span> <span class='op'>&lt;-</span> <span class='va'>Z_uniquely_up</span><span class='op'>[</span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>Z_uniquely_up</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pseudogene_set</span>, <span class='va'>mito_set</span>, <span class='va'>ribo_set</span>, <span class='va'>sex_set</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># see if key marker, "CD4 and/or ""KLRB1/CD161"", contain in the DE list + if it is "significant (i.e FDR &lt;0.05)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CD4"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>Z_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>,
       <span class='va'>Z_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>Z_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"CD4"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"KLRB1/CD161"</span>,
       <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>Z_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>,
       <span class='va'>Z_uniquely_up_noiseR</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>Z_uniquely_up_noiseR</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>"KLRB1"</span><span class='op'>)</span>, <span class='op'>]</span><span class='op'>$</span><span class='va'>FDR</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>

<span class='co'># top25 only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>Z_uniquely_up_noiseR</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>25</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>cp</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>vs13</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>cp</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"vs13"</span>,
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='co'># annotation_row = data.frame(</span>
  <span class='co'>#   Sig = factor(</span>
  <span class='co'>#     ifelse(best_set[, "FDR"] &lt; 0.05, "Yes", "No"),</span>
  <span class='co'>#     # TODO: temp trick to deal with the row-colouring problem</span>
  <span class='co'>#     # levels = c("Yes", "No")),</span>
  <span class='co'>#     levels = c("Yes")),</span>
  <span class='co'>#   row.names = rownames(best_set)),</span>
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster-group: "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span>, <span class='st'>" - \n"</span>,
                <span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>y</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>, <span class='st'>" ; \n"</span>,
                <span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='st'>"_top "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"_significance: "</span>, <span class='va'>z</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    vs13 <span class='op'>=</span> <span class='va'>vs13_colours</span>,
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure">
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-12-vs-9_10_11-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title." width="624" />
<p class="caption">
(#fig:heat-uniquely-up-logExp-cluster-12-vs-9_10_11)Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range. Ranking of CD4 and CD161/KLRB1 from top of the DGE list sorted in ascending order of FDR and their statistical significance (TRUE = FDR &lt; 0.05) are provided in the title.
</p>
</div>
</div>
<p>DGE lists of these comparisons are available in <a href="..output/marker_genes/S3_only/uniquely_up/cluster_9_10_11_vs_12/"><code>output/marker_genes/S3_only/uniquely_up/cluster_9_10_11_vs_12/</code></a>.</p>
<h4 id="summary-9_10_11-vs-12-y-vs-z">SUMMARY: 9_10_11 vs 12 (Y vs Z)</h4>
<ul>
<li>cluster 9_10_11 (S3.mix.more.thymus.1.and.2.and.3 &gt;&gt;&gt; lots of marker more frequently expressed in 9_10_11</li>
<li>cluster 12 (i.e. S3.mix.more.thymus.4 &gt;&gt;&gt; no statistically significant marker found</li>
<li>COMMENT: consistently, cluster 12 shows no marker, uniqueness is coming from cluster 9_10_11</li>
</ul>
</div>
</div>
<h2 id="selected-pairwise-comparisons---integrated">Selected pairwise comparisons - integrated</h2>
<p>To have a comprehensive overview, the above analyses were summarized in the following heatmap per cluster:</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># NOTE: The following is a workaround to the lack of support for tabsets in </span>
<span class='co'>#       distill (see https://github.com/rstudio/distill/issues/11 and </span>
<span class='co'>#       https://github.com/rstudio/distill/issues/11#issuecomment-692142414 in </span>
<span class='co'>#       particular).</span>
<span class='fu'>xaringanExtra</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/xaringanExtra/man/panelset.html'>use_panelset</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<div class="panelset">
<section id="cluster_9_integrated" class="panel-name panel">
<h4 class="panel-name"><code>Cluster_9_integrated</code></h4>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>############</span>
<span class='co'># cluster 9</span>
<span class='co'>############</span>

<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"9"</span>
<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(S3.mix.more.thymus.1)"</span>
<span class='co'># retain only significant markers (FDR&lt;0.05) + keep only required output columns</span>
<span class='va'>A_uniquely_up_noiseR_sig</span> <span class='op'>&lt;-</span> <span class='va'>A_uniquely_up_noiseR</span><span class='op'>[</span><span class='va'>A_uniquely_up_noiseR</span><span class='op'>$</span><span class='va'>FDR</span><span class='op'>&lt;</span><span class='fl'>0.05</span>,<span class='op'>]</span><span class='op'>[</span> ,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>C_uniquely_up_noiseR_sig</span> <span class='op'>&lt;-</span> <span class='va'>C_uniquely_up_noiseR</span><span class='op'>[</span><span class='va'>C_uniquely_up_noiseR</span><span class='op'>$</span><span class='va'>FDR</span><span class='op'>&lt;</span><span class='fl'>0.05</span>,<span class='op'>]</span><span class='op'>[</span> ,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>E_uniquely_up_noiseR_sig</span> <span class='op'>&lt;-</span> <span class='va'>E_uniquely_up_noiseR</span><span class='op'>[</span><span class='va'>E_uniquely_up_noiseR</span><span class='op'>$</span><span class='va'>FDR</span><span class='op'>&lt;</span><span class='fl'>0.05</span>,<span class='op'>]</span><span class='op'>[</span> ,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>P_uniquely_up_noiseR_sig</span> <span class='op'>&lt;-</span> <span class='va'>P_uniquely_up_noiseR</span><span class='op'>[</span><span class='va'>P_uniquely_up_noiseR</span><span class='op'>$</span><span class='va'>FDR</span><span class='op'>&lt;</span><span class='fl'>0.05</span>,<span class='op'>]</span><span class='op'>[</span> ,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>cluster9_uniquely_up_noiseR_sig</span> <span class='op'>&lt;-</span> <span class='va'>cluster9_uniquely_up_noiseR</span><span class='op'>[</span><span class='va'>cluster9_uniquely_up_noiseR</span><span class='op'>$</span><span class='va'>FDR</span><span class='op'>&lt;</span><span class='fl'>0.05</span>,<span class='op'>]</span><span class='op'>[</span> ,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span>
<span class='co'># add top column</span>
<span class='va'>A_uniquely_up_noiseR_sig</span><span class='op'>$</span><span class='va'>top</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>A_uniquely_up_noiseR_sig</span><span class='op'>)</span>
<span class='va'>C_uniquely_up_noiseR_sig</span><span class='op'>$</span><span class='va'>top</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>C_uniquely_up_noiseR_sig</span><span class='op'>)</span>
<span class='va'>E_uniquely_up_noiseR_sig</span><span class='op'>$</span><span class='va'>top</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>E_uniquely_up_noiseR_sig</span><span class='op'>)</span>
<span class='va'>P_uniquely_up_noiseR_sig</span><span class='op'>$</span><span class='va'>top</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>P_uniquely_up_noiseR_sig</span><span class='op'>)</span>
<span class='va'>cluster9_uniquely_up_noiseR_sig</span><span class='op'>$</span><span class='va'>top</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>cluster9_uniquely_up_noiseR_sig</span><span class='op'>)</span>
<span class='co'># unify S4 objects, sort by top (ascending) then FDR (ascending), keep only first unique entry for each marker</span>
<span class='va'>ACEP9_uniquely_up_noiseR_sig</span> <span class='op'>&lt;-</span> <span class='fu'>rbind2</span><span class='op'>(</span><span class='va'>A_uniquely_up_noiseR_sig</span>,
                                       <span class='va'>C_uniquely_up_noiseR_sig</span>,
                                       <span class='va'>E_uniquely_up_noiseR_sig</span>,
                                       <span class='va'>P_uniquely_up_noiseR_sig</span>,
                                       <span class='va'>cluster9_uniquely_up_noiseR_sig</span><span class='op'>)</span>
<span class='va'>ACEP9_uniquely_up_noiseR_sig_sort</span> <span class='op'>&lt;-</span> <span class='va'>ACEP9_uniquely_up_noiseR_sig</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/with.html'>with</a></span><span class='op'>(</span><span class='va'>ACEP9_uniquely_up_noiseR_sig</span>, <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span><span class='va'>top</span>, <span class='va'>FDR</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>
<span class='va'>ACEP9_uniquely_up_noiseR_sig_sort_uniq</span> <span class='op'>&lt;-</span> <span class='va'>ACEP9_uniquely_up_noiseR_sig_sort</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>ACEP9_uniquely_up_noiseR_sig_sort</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>
<span class='co'># # de-select unannotated/ not well-characterised genes</span>
<span class='co'># deselected &lt;- c("NPIPB13", "NPIPB3", "NPIPB11", "NPIPB5", "NPIPB4", "EEF1A1", "ACTG1", "ACTB", "IFITM1")</span>
<span class='va'>deselected</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"MALAT1"</span>, <span class='st'>"MTRNR2L12"</span>, <span class='st'>"MTRNR2L8"</span><span class='op'>)</span>
<span class='va'>ACEP9_uniquely_up_noiseR_sig_sort_uniq_selected</span> <span class='op'>&lt;-</span> <span class='va'>ACEP9_uniquely_up_noiseR_sig_sort_uniq</span><span class='op'>[</span><span class='op'>!</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>ACEP9_uniquely_up_noiseR_sig_sort_uniq</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>deselected</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># export DGE lists</span>
<span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span>
  <span class='va'>ACEP9_uniquely_up_noiseR_sig_sort_uniq_selected</span>,
  <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"C094_Pellicci.uniquely_up.cluster_9_integrated.rds"</span><span class='op'>)</span>,
  compress <span class='op'>=</span> <span class='st'>"xz"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"output"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"uniquely_up"</span>, <span class='st'>"integrated"</span><span class='op'>)</span>, recursive <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='st'>"Writing 'uniquely_up (cluster_9_integrated)' marker genes to file."</span><span class='op'>)</span>
<span class='va'>gzout</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>gzfile</a></span><span class='op'>(</span>
  description <span class='op'>=</span> <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span>
    <span class='st'>"output"</span>,
    <span class='st'>"marker_genes"</span>,
    <span class='st'>"S3_only"</span>,
    <span class='st'>"uniquely_up"</span>,
    <span class='st'>"integrated"</span>,
    <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"cluster_9_integrated"</span>,
           <span class='st'>".uniquely_up.csv.gz"</span><span class='op'>)</span><span class='op'>)</span>,
  open <span class='op'>=</span> <span class='st'>"wb"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/write.table.html'>write.table</a></span><span class='op'>(</span>
  x <span class='op'>=</span> <span class='va'>ACEP9_uniquely_up_noiseR_sig_sort_uniq_selected</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>tibble</span><span class='fu'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/rownames.html'>rownames_to_column</a></span><span class='op'>(</span><span class='st'>"gene_ID"</span><span class='op'>)</span>,
  file <span class='op'>=</span> <span class='va'>gzout</span>,
  sep <span class='op'>=</span> <span class='st'>","</span>,
  quote <span class='op'>=</span> <span class='cn'>FALSE</span>,
  row.names <span class='op'>=</span> <span class='cn'>FALSE</span>,
  col.names <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/connections.html'>close</a></span><span class='op'>(</span><span class='va'>gzout</span><span class='op'>)</span>
<span class='co'># top only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>ACEP9_uniquely_up_noiseR_sig_sort_uniq_selected</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>50</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>sce</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  annotation_row <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    <span class='co'># TODO: temp trick to deal with the row-colouring problem</span>
    cluster9.vs.10 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>A_uniquely_up_noiseR_sig</span><span class='op'>)</span>, <span class='st'>"DE"</span>, <span class='st'>"not DE"</span><span class='op'>)</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"DE"</span><span class='op'>)</span><span class='op'>)</span>,
    cluster9.vs.11 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>C_uniquely_up_noiseR_sig</span><span class='op'>)</span>, <span class='st'>"DE"</span>, <span class='st'>"not DE"</span><span class='op'>)</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"DE"</span><span class='op'>)</span><span class='op'>)</span>,
    cluster9.vs.12 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>E_uniquely_up_noiseR_sig</span><span class='op'>)</span>, <span class='st'>"DE"</span>, <span class='st'>"not DE"</span><span class='op'>)</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"DE"</span><span class='op'>)</span><span class='op'>)</span>,
    cluster9.vs.10_11 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>P_uniquely_up_noiseR_sig</span><span class='op'>)</span>, <span class='st'>"DE"</span>, <span class='st'>"not DE"</span><span class='op'>)</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"DE"</span><span class='op'>)</span><span class='op'>)</span>,
    cluster9.vs.10.vs.11.VS.12 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>cluster9_uniquely_up_noiseR_sig</span><span class='op'>)</span>, <span class='st'>"DE"</span>, <span class='st'>"not DE"</span><span class='op'>)</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"DE"</span><span class='op'>)</span><span class='op'>)</span>,    
    row.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span id="fig:heat-uniquely-up-logExp-cluster-9-integrated"></span>
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-9-integrated-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range." width="624" />
<p class="caption">
Figure 19: Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range.
</p>
</div>
</div>
</section>
<section id="cluster_10_integrated" class="panel-name panel">
<h4 class="panel-name"><code>Cluster_10_integrated</code></h4>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>############</span>
<span class='co'># cluster 10</span>
<span class='co'>############</span>

<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"10"</span>
<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(S3.mix.more.thymus.2)"</span>
<span class='co'># retain only significant markers (FDR&lt;0.05) + keep only required output columns</span>
<span class='va'>B_uniquely_up_noiseR_sig</span> <span class='op'>&lt;-</span> <span class='va'>B_uniquely_up_noiseR</span><span class='op'>[</span><span class='va'>B_uniquely_up_noiseR</span><span class='op'>$</span><span class='va'>FDR</span><span class='op'>&lt;</span><span class='fl'>0.05</span>,<span class='op'>]</span><span class='op'>[</span> ,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>G_uniquely_up_noiseR_sig</span> <span class='op'>&lt;-</span> <span class='va'>G_uniquely_up_noiseR</span><span class='op'>[</span><span class='va'>G_uniquely_up_noiseR</span><span class='op'>$</span><span class='va'>FDR</span><span class='op'>&lt;</span><span class='fl'>0.05</span>,<span class='op'>]</span><span class='op'>[</span> ,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>I_uniquely_up_noiseR_sig</span> <span class='op'>&lt;-</span> <span class='va'>I_uniquely_up_noiseR</span><span class='op'>[</span><span class='va'>I_uniquely_up_noiseR</span><span class='op'>$</span><span class='va'>FDR</span><span class='op'>&lt;</span><span class='fl'>0.05</span>,<span class='op'>]</span><span class='op'>[</span> ,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>R_uniquely_up_noiseR_sig</span> <span class='op'>&lt;-</span> <span class='va'>R_uniquely_up_noiseR</span><span class='op'>[</span><span class='va'>R_uniquely_up_noiseR</span><span class='op'>$</span><span class='va'>FDR</span><span class='op'>&lt;</span><span class='fl'>0.05</span>,<span class='op'>]</span><span class='op'>[</span> ,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>cluster10_uniquely_up_noiseR_sig</span> <span class='op'>&lt;-</span> <span class='va'>cluster10_uniquely_up_noiseR</span><span class='op'>[</span><span class='va'>cluster10_uniquely_up_noiseR</span><span class='op'>$</span><span class='va'>FDR</span><span class='op'>&lt;</span><span class='fl'>0.05</span>,<span class='op'>]</span><span class='op'>[</span> ,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span>
<span class='co'># add top column</span>
<span class='va'>B_uniquely_up_noiseR_sig</span><span class='op'>$</span><span class='va'>top</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>B_uniquely_up_noiseR_sig</span><span class='op'>)</span>
<span class='va'>G_uniquely_up_noiseR_sig</span><span class='op'>$</span><span class='va'>top</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>G_uniquely_up_noiseR_sig</span><span class='op'>)</span>
<span class='va'>I_uniquely_up_noiseR_sig</span><span class='op'>$</span><span class='va'>top</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>I_uniquely_up_noiseR_sig</span><span class='op'>)</span>
<span class='va'>R_uniquely_up_noiseR_sig</span><span class='op'>$</span><span class='va'>top</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>R_uniquely_up_noiseR_sig</span><span class='op'>)</span>
<span class='va'>cluster10_uniquely_up_noiseR_sig</span><span class='op'>$</span><span class='va'>top</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>cluster10_uniquely_up_noiseR_sig</span><span class='op'>)</span>
<span class='co'># unify S4 objects, sort by top (ascending) then FDR (ascending), keep only first unique entry for each marker</span>
<span class='va'>BGIR10_uniquely_up_noiseR_sig</span> <span class='op'>&lt;-</span> <span class='fu'>rbind2</span><span class='op'>(</span><span class='va'>B_uniquely_up_noiseR_sig</span>,
                                        <span class='va'>G_uniquely_up_noiseR_sig</span>,
                                        <span class='va'>I_uniquely_up_noiseR_sig</span>,
                                        <span class='va'>R_uniquely_up_noiseR_sig</span>,
                                        <span class='va'>cluster10_uniquely_up_noiseR_sig</span><span class='op'>)</span>
<span class='va'>BGIR10_uniquely_up_noiseR_sig_sort</span> <span class='op'>&lt;-</span> <span class='va'>BGIR10_uniquely_up_noiseR_sig</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/with.html'>with</a></span><span class='op'>(</span><span class='va'>BGIR10_uniquely_up_noiseR_sig</span>, <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span><span class='va'>top</span>, <span class='va'>FDR</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>
<span class='va'>BGIR10_uniquely_up_noiseR_sig_sort_uniq</span> <span class='op'>&lt;-</span> <span class='va'>BGIR10_uniquely_up_noiseR_sig_sort</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>BGIR10_uniquely_up_noiseR_sig_sort</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>
<span class='co'># # de-select unannotated/ not well-characterised genes</span>
<span class='co'># deselected &lt;- c("NPIPB13", "NPIPB3", "NPIPB11", "NPIPB5", "NPIPB4", "EEF1A1", "ACTG1", "ACTB", "IFITM1")</span>
<span class='va'>deselected</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"MALAT1"</span>, <span class='st'>"MTRNR2L12"</span>, <span class='st'>"MTRNR2L8"</span><span class='op'>)</span>
<span class='va'>BGIR10_uniquely_up_noiseR_sig_sort_uniq_selected</span> <span class='op'>&lt;-</span> <span class='va'>BGIR10_uniquely_up_noiseR_sig_sort_uniq</span><span class='op'>[</span><span class='op'>!</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>BGIR10_uniquely_up_noiseR_sig_sort_uniq</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>deselected</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># export DGE lists</span>
<span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span>
  <span class='va'>BGIR10_uniquely_up_noiseR_sig_sort_uniq_selected</span>,
  <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"C094_Pellicci.uniquely_up.cluster_10_integrated.rds"</span><span class='op'>)</span>,
  compress <span class='op'>=</span> <span class='st'>"xz"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"output"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"uniquely_up"</span>, <span class='st'>"integrated"</span><span class='op'>)</span>, recursive <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='st'>"Writing 'uniquely_up (cluster_10_integrated)' marker genes to file."</span><span class='op'>)</span>
<span class='va'>gzout</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>gzfile</a></span><span class='op'>(</span>
  description <span class='op'>=</span> <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span>
    <span class='st'>"output"</span>,
    <span class='st'>"marker_genes"</span>,
    <span class='st'>"S3_only"</span>,
    <span class='st'>"uniquely_up"</span>,
    <span class='st'>"integrated"</span>,
    <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"cluster_10_integrated"</span>,
           <span class='st'>".uniquely_up.csv.gz"</span><span class='op'>)</span><span class='op'>)</span>,
  open <span class='op'>=</span> <span class='st'>"wb"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/write.table.html'>write.table</a></span><span class='op'>(</span>
  x <span class='op'>=</span> <span class='va'>BGIR10_uniquely_up_noiseR_sig_sort_uniq_selected</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>tibble</span><span class='fu'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/rownames.html'>rownames_to_column</a></span><span class='op'>(</span><span class='st'>"gene_ID"</span><span class='op'>)</span>,
  file <span class='op'>=</span> <span class='va'>gzout</span>,
  sep <span class='op'>=</span> <span class='st'>","</span>,
  quote <span class='op'>=</span> <span class='cn'>FALSE</span>,
  row.names <span class='op'>=</span> <span class='cn'>FALSE</span>,
  col.names <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/connections.html'>close</a></span><span class='op'>(</span><span class='va'>gzout</span><span class='op'>)</span>
<span class='co'># top only + gene-of-interest</span>
<span class='co'># best_set &lt;- BGIR10_uniquely_up_noiseR_sig_sort_uniq_selected[1:50, ]</span>
<span class='co'># NOTE: have 28 markers only</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>BGIR10_uniquely_up_noiseR_sig_sort_uniq_selected</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>28</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>sce</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  annotation_row <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    <span class='co'># TODO: temp trick to deal with the row-colouring problem</span>
    cluster10.vs.9 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>B_uniquely_up_noiseR_sig</span><span class='op'>)</span>, <span class='st'>"DE"</span>, <span class='st'>"not DE"</span><span class='op'>)</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"DE"</span><span class='op'>)</span><span class='op'>)</span>,
    cluster10.vs.11 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>G_uniquely_up_noiseR_sig</span><span class='op'>)</span>, <span class='st'>"DE"</span>, <span class='st'>"not DE"</span><span class='op'>)</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"DE"</span><span class='op'>)</span><span class='op'>)</span>,
    cluster10.vs.12 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>I_uniquely_up_noiseR_sig</span><span class='op'>)</span>, <span class='st'>"DE"</span>, <span class='st'>"not DE"</span><span class='op'>)</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"DE"</span><span class='op'>)</span><span class='op'>)</span>,
    cluster10.vs.9_11 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>R_uniquely_up_noiseR_sig</span><span class='op'>)</span>, <span class='st'>"DE"</span>, <span class='st'>"not DE"</span><span class='op'>)</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"DE"</span><span class='op'>)</span><span class='op'>)</span>,
    cluster10.vs.9.vs.11.VS.12 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>cluster10_uniquely_up_noiseR_sig</span><span class='op'>)</span>, <span class='st'>"DE"</span>, <span class='st'>"not DE"</span><span class='op'>)</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"DE"</span><span class='op'>)</span><span class='op'>)</span>,    
    row.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span id="fig:heat-uniquely-up-logExp-cluster-10-integrated"></span>
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-10-integrated-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range." width="624" />
<p class="caption">
Figure 20: Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range.
</p>
</div>
</div>
</section>
<section id="cluster_11_integrated" class="panel-name panel">
<h4 class="panel-name"><code>Cluster_11_integrated</code></h4>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>############</span>
<span class='co'># cluster 11</span>
<span class='co'>############</span>

<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"11"</span>
<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(S3.mix.more.thymus.3)"</span>
<span class='co'># retain only significant markers (FDR&lt;0.05) + keep only required output columns</span>
<span class='va'>D_uniquely_up_noiseR_sig</span> <span class='op'>&lt;-</span> <span class='va'>D_uniquely_up_noiseR</span><span class='op'>[</span><span class='va'>D_uniquely_up_noiseR</span><span class='op'>$</span><span class='va'>FDR</span><span class='op'>&lt;</span><span class='fl'>0.05</span>,<span class='op'>]</span><span class='op'>[</span> ,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>H_uniquely_up_noiseR_sig</span> <span class='op'>&lt;-</span> <span class='va'>H_uniquely_up_noiseR</span><span class='op'>[</span><span class='va'>H_uniquely_up_noiseR</span><span class='op'>$</span><span class='va'>FDR</span><span class='op'>&lt;</span><span class='fl'>0.05</span>,<span class='op'>]</span><span class='op'>[</span> ,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>K_uniquely_up_noiseR_sig</span> <span class='op'>&lt;-</span> <span class='va'>K_uniquely_up_noiseR</span><span class='op'>[</span><span class='va'>K_uniquely_up_noiseR</span><span class='op'>$</span><span class='va'>FDR</span><span class='op'>&lt;</span><span class='fl'>0.05</span>,<span class='op'>]</span><span class='op'>[</span> ,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>N_uniquely_up_noiseR_sig</span> <span class='op'>&lt;-</span> <span class='va'>N_uniquely_up_noiseR</span><span class='op'>[</span><span class='va'>N_uniquely_up_noiseR</span><span class='op'>$</span><span class='va'>FDR</span><span class='op'>&lt;</span><span class='fl'>0.05</span>,<span class='op'>]</span><span class='op'>[</span> ,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>cluster11_uniquely_up_noiseR_sig</span> <span class='op'>&lt;-</span> <span class='va'>cluster11_uniquely_up_noiseR</span><span class='op'>[</span><span class='va'>cluster11_uniquely_up_noiseR</span><span class='op'>$</span><span class='va'>FDR</span><span class='op'>&lt;</span><span class='fl'>0.05</span>,<span class='op'>]</span><span class='op'>[</span> ,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span>
<span class='co'># add top column</span>
<span class='va'>D_uniquely_up_noiseR_sig</span><span class='op'>$</span><span class='va'>top</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>D_uniquely_up_noiseR_sig</span><span class='op'>)</span>
<span class='va'>K_uniquely_up_noiseR_sig</span><span class='op'>$</span><span class='va'>top</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>K_uniquely_up_noiseR_sig</span><span class='op'>)</span>
<span class='co'># TODO: fix error - exclude list from rbind2 if empty</span>
<span class='co'># H_uniquely_up_noiseR_sig$top &lt;- 1:nrow(H_uniquely_up_noiseR_sig)</span>
<span class='co'># N_uniquely_up_noiseR_sig$top &lt;- 1:nrow(N_uniquely_up_noiseR_sig)</span>
<span class='co'># cluster11_uniquely_up_noiseR_sig$top &lt;- 1:nrow(cluster11_uniquely_up_noiseR_sig)</span>
<span class='co'># unify S4 objects, sort by top (ascending) then FDR (ascending), keep only first unique entry for each marker</span>
<span class='va'>DHKN11_uniquely_up_noiseR_sig</span> <span class='op'>&lt;-</span> <span class='fu'>rbind2</span><span class='op'>(</span><span class='va'>D_uniquely_up_noiseR_sig</span>,
                                        <span class='va'>H_uniquely_up_noiseR_sig</span>,
                                        <span class='va'>K_uniquely_up_noiseR_sig</span>,
                                        <span class='va'>N_uniquely_up_noiseR_sig</span>,
                                        <span class='va'>cluster11_uniquely_up_noiseR_sig</span><span class='op'>)</span>
<span class='va'>DHKN11_uniquely_up_noiseR_sig_sort</span> <span class='op'>&lt;-</span> <span class='va'>DHKN11_uniquely_up_noiseR_sig</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/with.html'>with</a></span><span class='op'>(</span><span class='va'>DHKN11_uniquely_up_noiseR_sig</span>, <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span><span class='va'>top</span>, <span class='va'>FDR</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>
<span class='va'>DHKN11_uniquely_up_noiseR_sig_sort_uniq</span> <span class='op'>&lt;-</span> <span class='va'>DHKN11_uniquely_up_noiseR_sig_sort</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>DHKN11_uniquely_up_noiseR_sig_sort</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>
<span class='co'># # de-select unannotated/ not well-characterised genes</span>
<span class='co'># deselected &lt;- c("NPIPB13", "NPIPB3", "NPIPB11", "NPIPB5", "NPIPB4", "EEF1A1", "ACTG1", "ACTB", "IFITM1")</span>
<span class='va'>deselected</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"MALAT1"</span>, <span class='st'>"MTRNR2L12"</span>, <span class='st'>"MTRNR2L8"</span><span class='op'>)</span>
<span class='va'>DHKN11_uniquely_up_noiseR_sig_sort_uniq_selected</span> <span class='op'>&lt;-</span> <span class='va'>DHKN11_uniquely_up_noiseR_sig_sort_uniq</span><span class='op'>[</span><span class='op'>!</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>DHKN11_uniquely_up_noiseR_sig_sort_uniq</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>deselected</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># export DGE lists</span>
<span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span>
  <span class='va'>DHKN11_uniquely_up_noiseR_sig_sort_uniq_selected</span>,
  <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"C094_Pellicci.uniquely_up.cluster_11_integrated.rds"</span><span class='op'>)</span>,
  compress <span class='op'>=</span> <span class='st'>"xz"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"output"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"uniquely_up"</span>, <span class='st'>"integrated"</span><span class='op'>)</span>, recursive <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='st'>"Writing 'uniquely_up (cluster_11_integrated)' marker genes to file."</span><span class='op'>)</span>
<span class='va'>gzout</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>gzfile</a></span><span class='op'>(</span>
  description <span class='op'>=</span> <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span>
    <span class='st'>"output"</span>,
    <span class='st'>"marker_genes"</span>,
    <span class='st'>"S3_only"</span>,
    <span class='st'>"uniquely_up"</span>,
    <span class='st'>"integrated"</span>,
    <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"cluster_11_integrated"</span>,
           <span class='st'>".uniquely_up.csv.gz"</span><span class='op'>)</span><span class='op'>)</span>,
  open <span class='op'>=</span> <span class='st'>"wb"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/write.table.html'>write.table</a></span><span class='op'>(</span>
  x <span class='op'>=</span> <span class='va'>DHKN11_uniquely_up_noiseR_sig_sort_uniq_selected</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>tibble</span><span class='fu'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/rownames.html'>rownames_to_column</a></span><span class='op'>(</span><span class='st'>"gene_ID"</span><span class='op'>)</span>,
  file <span class='op'>=</span> <span class='va'>gzout</span>,
  sep <span class='op'>=</span> <span class='st'>","</span>,
  quote <span class='op'>=</span> <span class='cn'>FALSE</span>,
  row.names <span class='op'>=</span> <span class='cn'>FALSE</span>,
  col.names <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/connections.html'>close</a></span><span class='op'>(</span><span class='va'>gzout</span><span class='op'>)</span>
<span class='co'># top only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>DHKN11_uniquely_up_noiseR_sig_sort_uniq_selected</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>50</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>sce</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  annotation_row <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    <span class='co'># TODO: temp trick to deal with the row-colouring problem</span>
    cluster11.vs.9 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>D_uniquely_up_noiseR_sig</span><span class='op'>)</span>, <span class='st'>"DE"</span>, <span class='st'>"not DE"</span><span class='op'>)</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"DE"</span><span class='op'>)</span><span class='op'>)</span>,
    cluster11.vs.12 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>K_uniquely_up_noiseR_sig</span><span class='op'>)</span>, <span class='st'>"DE"</span>, <span class='st'>"not DE"</span><span class='op'>)</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"DE"</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='co'># TODO: work out how to remove `fill` from `not_DE`</span>
    <span class='co'># cluster11.vs.10 = factor(ifelse(rownames(best_set) %in% rownames(H_uniquely_up_noiseR_sig), "DE", "not DE"), levels = c("DE")),</span>
    <span class='co'># cluster11.vs.9_10 = factor(ifelse(rownames(best_set) %in% rownames(N_uniquely_up_noiseR_sig), "DE", "not DE"), levels = c("DE")),</span>
    <span class='co'># cluster11.vs.9.vs.10.VS.12 = factor(ifelse(rownames(best_set) %in% rownames(cluster11_uniquely_up_noiseR_sig), "DE", "not DE"), levels = c("DE")),    </span>
    row.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span id="fig:heat-uniquely-up-logExp-cluster-11-integrated"></span>
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-11-integrated-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range." width="624" />
<p class="caption">
Figure 21: Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range.
</p>
</div>
</div>
</section>
<section id="cluster_12_integrated" class="panel-name panel">
<h4 class="panel-name"><code>Cluster_12_integrated</code></h4>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>############</span>
<span class='co'># cluster 12</span>
<span class='co'>############</span>

<span class='va'>chosen</span> <span class='op'>&lt;-</span> <span class='st'>"12"</span>
<span class='co'># add description for the chosen cluster-group</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"(S3.mix.more.thymus.4.center)"</span>
<span class='co'># retain only significant markers (FDR&lt;0.05) + keep only required output columns</span>
<span class='co'># F_uniquely_up_noiseR_sig &lt;- F_uniquely_up_noiseR[F_uniquely_up_noiseR$FDR&lt;0.05,][ ,c(1:3)]</span>
<span class='co'># J_uniquely_up_noiseR_sig &lt;- J_uniquely_up_noiseR[J_uniquely_up_noiseR$FDR&lt;0.05,][ ,c(1:3)]</span>
<span class='co'># L_uniquely_up_noiseR_sig &lt;- L_uniquely_up_noiseR[L_uniquely_up_noiseR$FDR&lt;0.05,][ ,c(1:3)]</span>
<span class='co'># T_uniquely_up_noiseR_sig &lt;- T_uniquely_up_noiseR[T_uniquely_up_noiseR$FDR&lt;0.05,][ ,c(1:3)]</span>
<span class='co'># V_uniquely_up_noiseR_sig &lt;- V_uniquely_up_noiseR[V_uniquely_up_noiseR$FDR&lt;0.05,][ ,c(1:3)]</span>
<span class='co'># X_uniquely_up_noiseR_sig &lt;- X_uniquely_up_noiseR[X_uniquely_up_noiseR$FDR&lt;0.05,][ ,c(1:3)]</span>
<span class='co'># Z_uniquely_up_noiseR_sig &lt;- Z_uniquely_up_noiseR[Z_uniquely_up_noiseR$FDR&lt;0.05,][ ,c(1:3)]</span>
<span class='co'># cluster12_uniquely_up_noiseR_sig &lt;- cluster12_uniquely_up_noiseR[cluster12_uniquely_up_noiseR$FDR&lt;0.05,][ ,c(1:3)]</span>
<span class='co'># NOTE: none of them are significantly different, thus needed an alternative path to make the plot</span>
<span class='va'>F_uniquely_up_noiseR_sig</span> <span class='op'>&lt;-</span> <span class='va'>F_uniquely_up_noiseR</span><span class='op'>[</span><span class='va'>F_uniquely_up_noiseR</span><span class='op'>$</span><span class='va'>FDR</span><span class='op'>&lt;</span><span class='fl'>1</span>,<span class='op'>]</span><span class='op'>[</span> ,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>J_uniquely_up_noiseR_sig</span> <span class='op'>&lt;-</span> <span class='va'>J_uniquely_up_noiseR</span><span class='op'>[</span><span class='va'>J_uniquely_up_noiseR</span><span class='op'>$</span><span class='va'>FDR</span><span class='op'>&lt;</span><span class='fl'>1</span>,<span class='op'>]</span><span class='op'>[</span> ,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>L_uniquely_up_noiseR_sig</span> <span class='op'>&lt;-</span> <span class='va'>L_uniquely_up_noiseR</span><span class='op'>[</span><span class='va'>L_uniquely_up_noiseR</span><span class='op'>$</span><span class='va'>FDR</span><span class='op'>&lt;</span><span class='fl'>1</span>,<span class='op'>]</span><span class='op'>[</span> ,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>T_uniquely_up_noiseR_sig</span> <span class='op'>&lt;-</span> <span class='va'>T_uniquely_up_noiseR</span><span class='op'>[</span><span class='va'>T_uniquely_up_noiseR</span><span class='op'>$</span><span class='va'>FDR</span><span class='op'>&lt;</span><span class='fl'>1</span>,<span class='op'>]</span><span class='op'>[</span> ,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>V_uniquely_up_noiseR_sig</span> <span class='op'>&lt;-</span> <span class='va'>V_uniquely_up_noiseR</span><span class='op'>[</span><span class='va'>V_uniquely_up_noiseR</span><span class='op'>$</span><span class='va'>FDR</span><span class='op'>&lt;</span><span class='fl'>1</span>,<span class='op'>]</span><span class='op'>[</span> ,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>X_uniquely_up_noiseR_sig</span> <span class='op'>&lt;-</span> <span class='va'>X_uniquely_up_noiseR</span><span class='op'>[</span><span class='va'>X_uniquely_up_noiseR</span><span class='op'>$</span><span class='va'>FDR</span><span class='op'>&lt;</span><span class='fl'>1</span>,<span class='op'>]</span><span class='op'>[</span> ,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>Z_uniquely_up_noiseR_sig</span> <span class='op'>&lt;-</span> <span class='va'>Z_uniquely_up_noiseR</span><span class='op'>[</span><span class='va'>Z_uniquely_up_noiseR</span><span class='op'>$</span><span class='va'>FDR</span><span class='op'>&lt;</span><span class='fl'>1</span>,<span class='op'>]</span><span class='op'>[</span> ,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>cluster12_uniquely_up_noiseR_sig</span> <span class='op'>&lt;-</span> <span class='va'>cluster12_uniquely_up_noiseR</span><span class='op'>[</span><span class='va'>cluster12_uniquely_up_noiseR</span><span class='op'>$</span><span class='va'>FDR</span><span class='op'>&lt;</span><span class='fl'>0.05</span>,<span class='op'>]</span><span class='op'>[</span> ,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span>
<span class='co'># add top column</span>
<span class='va'>F_uniquely_up_noiseR_sig</span><span class='op'>$</span><span class='va'>top</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>F_uniquely_up_noiseR_sig</span><span class='op'>)</span>
<span class='va'>J_uniquely_up_noiseR_sig</span><span class='op'>$</span><span class='va'>top</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>J_uniquely_up_noiseR_sig</span><span class='op'>)</span>
<span class='va'>L_uniquely_up_noiseR_sig</span><span class='op'>$</span><span class='va'>top</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>L_uniquely_up_noiseR_sig</span><span class='op'>)</span>
<span class='va'>T_uniquely_up_noiseR_sig</span><span class='op'>$</span><span class='va'>top</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>T_uniquely_up_noiseR_sig</span><span class='op'>)</span>
<span class='va'>V_uniquely_up_noiseR_sig</span><span class='op'>$</span><span class='va'>top</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>V_uniquely_up_noiseR_sig</span><span class='op'>)</span>
<span class='va'>X_uniquely_up_noiseR_sig</span><span class='op'>$</span><span class='va'>top</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>X_uniquely_up_noiseR_sig</span><span class='op'>)</span>
<span class='va'>Z_uniquely_up_noiseR_sig</span><span class='op'>$</span><span class='va'>top</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>Z_uniquely_up_noiseR_sig</span><span class='op'>)</span>
<span class='co'># TODO: fix error - exclude list from rbind2 if empty</span>
<span class='co'># cluster12_uniquely_up_noiseR_sig$top &lt;- 1:nrow(cluster12_uniquely_up_noiseR_sig)</span>
<span class='co'># unify S4 objects, sort by top (ascending) then FDR (ascending), keep only first unique entry for each marker</span>
<span class='va'>FJLTVXZ12_uniquely_up_noiseR_sig</span> <span class='op'>&lt;-</span> <span class='fu'>rbind2</span><span class='op'>(</span><span class='va'>F_uniquely_up_noiseR_sig</span>,
                                           <span class='va'>J_uniquely_up_noiseR_sig</span>,
                                           <span class='va'>L_uniquely_up_noiseR_sig</span>,
                                           <span class='va'>T_uniquely_up_noiseR_sig</span>,
                                           <span class='va'>V_uniquely_up_noiseR_sig</span>,
                                           <span class='va'>X_uniquely_up_noiseR_sig</span>,
                                           <span class='va'>Z_uniquely_up_noiseR_sig</span>,
                                           <span class='va'>cluster12_uniquely_up_noiseR_sig</span><span class='op'>)</span>
<span class='va'>FJLTVXZ12_uniquely_up_noiseR_sig_sort</span> <span class='op'>&lt;-</span> <span class='va'>FJLTVXZ12_uniquely_up_noiseR_sig</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/with.html'>with</a></span><span class='op'>(</span><span class='va'>FJLTVXZ12_uniquely_up_noiseR_sig</span>, <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span><span class='va'>top</span>, <span class='va'>FDR</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>
<span class='va'>FJLTVXZ12_uniquely_up_noiseR_sig_sort_uniq</span> <span class='op'>&lt;-</span> <span class='va'>FJLTVXZ12_uniquely_up_noiseR_sig_sort</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>FJLTVXZ12_uniquely_up_noiseR_sig_sort</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>]</span>
<span class='co'># # de-select unannotated/ not well-characterised genes</span>
<span class='co'># deselected &lt;- c("NPIPB13", "NPIPB3", "NPIPB11", "NPIPB5", "NPIPB4", "EEF1A1", "ACTG1", "ACTB", "IFITM1")</span>
<span class='va'>deselected</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"MALAT1"</span>, <span class='st'>"MTRNR2L12"</span>, <span class='st'>"MTRNR2L8"</span><span class='op'>)</span>
<span class='va'>FJLTVXZ12_uniquely_up_noiseR_sig_sort_uniq_selected</span> <span class='op'>&lt;-</span> <span class='va'>FJLTVXZ12_uniquely_up_noiseR_sig_sort_uniq</span><span class='op'>[</span><span class='op'>!</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>FJLTVXZ12_uniquely_up_noiseR_sig_sort_uniq</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='va'>deselected</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'># export DGE lists</span>
<span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span>
  <span class='va'>FJLTVXZ12_uniquely_up_noiseR_sig_sort_uniq_selected</span>,
  <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"C094_Pellicci.uniquely_up.cluster_12_integrated.rds"</span><span class='op'>)</span>,
  compress <span class='op'>=</span> <span class='st'>"xz"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"output"</span>, <span class='st'>"marker_genes"</span>, <span class='st'>"S3_only"</span>, <span class='st'>"uniquely_up"</span>, <span class='st'>"integrated"</span><span class='op'>)</span>, recursive <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='st'>"Writing 'uniquely_up (cluster_12_integrated)' marker genes to file."</span><span class='op'>)</span>
<span class='va'>gzout</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/connections.html'>gzfile</a></span><span class='op'>(</span>
  description <span class='op'>=</span> <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span>
    <span class='st'>"output"</span>,
    <span class='st'>"marker_genes"</span>,
    <span class='st'>"S3_only"</span>,
    <span class='st'>"uniquely_up"</span>,
    <span class='st'>"integrated"</span>,
    <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"cluster_12_integrated"</span>,
           <span class='st'>".uniquely_up.csv.gz"</span><span class='op'>)</span><span class='op'>)</span>,
  open <span class='op'>=</span> <span class='st'>"wb"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/write.table.html'>write.table</a></span><span class='op'>(</span>
  x <span class='op'>=</span> <span class='va'>FJLTVXZ12_uniquely_up_noiseR_sig_sort_uniq_selected</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>tibble</span><span class='fu'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/rownames.html'>rownames_to_column</a></span><span class='op'>(</span><span class='st'>"gene_ID"</span><span class='op'>)</span>,
  file <span class='op'>=</span> <span class='va'>gzout</span>,
  sep <span class='op'>=</span> <span class='st'>","</span>,
  quote <span class='op'>=</span> <span class='cn'>FALSE</span>,
  row.names <span class='op'>=</span> <span class='cn'>FALSE</span>,
  col.names <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/connections.html'>close</a></span><span class='op'>(</span><span class='va'>gzout</span><span class='op'>)</span>
<span class='co'># top only + gene-of-interest</span>
<span class='va'>best_set</span> <span class='op'>&lt;-</span> <span class='va'>FJLTVXZ12_uniquely_up_noiseR_sig_sort_uniq_selected</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>50</span>, <span class='op'>]</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># heatmap</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>sce</span>,
  features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>best_set</span><span class='op'>)</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span>
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>plate_number</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>CD4</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>CD161</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span>,
    <span class='st'>"CD4"</span>,
    <span class='st'>"CD161"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='co'># annotation_row = data.frame(</span>
  <span class='co'>#   # TODO: temp trick to deal with the row-colouring problem</span>
  <span class='co'>#   cluster12.vs.9 = factor(ifelse(rownames(best_set) %in% rownames(F_uniquely_up_noiseR_sig), "DE", "not DE"), levels = c("DE")),</span>
  <span class='co'>#   cluster12.vs.10 = factor(ifelse(rownames(best_set) %in% rownames(J_uniquely_up_noiseR_sig), "DE", "not DE"), levels = c("DE")),</span>
  <span class='co'>#   cluster12.vs.11 = factor(ifelse(rownames(best_set) %in% rownames(L_uniquely_up_noiseR_sig), "DE", "not DE"), levels = c("DE")),</span>
  <span class='co'>#   cluster12.vs.9_10 = factor(ifelse(rownames(best_set) %in% rownames(T_uniquely_up_noiseR_sig), "DE", "not DE"), levels = c("DE")),</span>
  <span class='co'>#   cluster12.vs.10_11 = factor(ifelse(rownames(best_set) %in% rownames(V_uniquely_up_noiseR_sig), "DE", "not DE"), levels = c("DE")),</span>
  <span class='co'>#   cluster12.vs.9_11 = factor(ifelse(rownames(best_set) %in% rownames(X_uniquely_up_noiseR_sig), "DE", "not DE"), levels = c("DE")),</span>
  <span class='co'>#   cluster12.vs.9_10_11 = factor(ifelse(rownames(best_set) %in% rownames(Z_uniquely_up_noiseR_sig), "DE", "not DE"), levels = c("DE")),</span>
  <span class='co'>#   cluster12.vs.9.vs.10.VS.11 = factor(ifelse(rownames(best_set) %in% rownames(cluster12_uniquely_up_noiseR_sig), "DE", "not DE"), levels = c("DE")),    </span>
  <span class='co'>#   row.names = rownames(best_set)),</span>
  main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cluster "</span>, <span class='va'>chosen</span>, <span class='st'>" "</span>, <span class='va'>x</span><span class='op'>)</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># Sig = c("Yes" = "red", "No" = "lightgrey"),</span>
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span id="fig:heat-uniquely-up-logExp-cluster-12-integrated"></span>
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-uniquely-up-logExp-cluster-12-integrated-1.png" alt="Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range." width="624" />
<p class="caption">
Figure 22: Heatmap of log-expression values in each sample for the top uniquely upregulated marker genes. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range.
</p>
</div>
</div>
</section>
</div>
<p>DGE lists of these comparisons are available in <a href="..output/marker_genes/S3_only/uniquely_up/integrated/"><code>output/marker_genes/S3_only/uniquely_up/integrated/</code></a>.</p>
<p><strong>Summary</strong>: As in the minibulk with 20 DE only and we cannot tell the difference between thymus.s3 and blood.s3, there is no standout feature in terms of tissue-of-origin for each cluster of the “S3 only” subset and all of them are S3-mix (with mostly thymus.s3 blended with some blood.s3). Having said so, it may indicate that, S3 cells are somehow in common between thymus and blood, and based on gene expression difference, this subset of cells can be sub-divided into different sub-types.</p>
<p>By default parameter of the SNN algorithm, the “S3 only” subset contains six different clusters, but based on the UMAP, the clustering algorithm seems struggling, and based on my explorative analysis, four clusters is sufficient and can best demonstrate the heterogeneity of this subset dataset.</p>
<p>Based on the pairwise DE detection, each of the peripheral clusters (i.e. cluster 9, 10, 11) do have unique markers up-regulated and driving them apart.</p>
<p>For instance:</p>
<p>For cluster <code>9</code>, the only global unique marker that can be found is IL7R, but when pairwise compare cluster 9 with the other clusters one by one, cluster 9 did show a number of gene feature that the other clusters do not have, such as gene LTB when compare 9 to 10, IFITM3, TOMM7 and S100A10 when compare 9 to 11, and lots of marker gene (such as CAPZA1, TPI1, and SLK) when compared 9 to 12.</p>
<p>Same applied to cluster <code>10</code>, in which, the NPIPB gene family and the long non-coding RNA (AC009022.1) was shown as the global unique marker for cluster 10, then when pairwise compare cluster 9 with the other clusters one by one, cluster 10 did show a number of unique gene features, such as KLRD1 and CCL5 when compare 10 to 9, SYNE2 when compare 10 to 11, and series of markers (such as MBNL1 and RSF1) when compare 10 to 12.</p>
<p>For cluster <code>11</code>, one can easily tell apart the cluster 9, 11, and 12, because CCL5 was up-regulated in cluster 11, but not cluster 9, whilst, a series of gene (such as MYO9B, SLK and CD1E) expressed in cluster 11, but not in 12. In contrast, we find no up-regulated markers when 11 to 10, but SYNE2, AC009022.1, and the NPIPB gene family when compare 10 to 11. All in all, cluster 11 is a separated cluster.</p>
<p>For cluster <code>12</code>, no significantly up-regulated genes can be spotted when compare cluster 12 to all other 3 clusters. But as I shown you before, there are pack of genes significantly up-regulated in cluster 9, 10, and 11, but not in cluster 12. From the biological point of view, one possibility could be that the cluster 12 is a <strong>progenitor</strong> cell-type in the “S3 only” subset of the gamma-delta T cells, which could be multipotent and could be developed into either cluster 9, 10, or 11 cells depending on which set of markers it is going to express.</p>
<h2 id="supplemental-info">Supplemental info</h2>
<h3 id="comparison-of-key-marker-expression-by-clusters">Comparison of key marker expression by clusters</h3>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>assay</span><span class='op'>(</span><span class='va'>sce</span>, <span class='st'>"log2cpm"</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'>edgeR</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/edgeR/man/cpm.html'>cpm</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/pkg/SingleCellExperiment/man/assays.html'>counts</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>)</span>,
  log <span class='op'>=</span> <span class='cn'>TRUE</span>,
  lib.size <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>colSums</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/SingleCellExperiment/man/assays.html'>counts</a></span><span class='op'>(</span><span class='va'>sce</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://wilkelab.org/cowplot/reference/plot_grid.html'>plot_grid</a></span><span class='op'>(</span>
  
  <span class='co'># cluster 9</span>
  <span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotExpression.html'>plotExpression</a></span><span class='op'>(</span>
    <span class='va'>sce</span>,
    features <span class='op'>=</span> <span class='st'>"IL7R"</span>,
    x <span class='op'>=</span> <span class='st'>"cluster"</span>,
    exprs_values <span class='op'>=</span> <span class='st'>"log2cpm"</span>,
    colour_by <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>axis.text.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>45</span>, hjust <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_colour_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>cluster_colours</span>, name <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span>,
  
  <span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotExpression.html'>plotExpression</a></span><span class='op'>(</span>
    <span class='va'>sce</span>,
    features <span class='op'>=</span> <span class='st'>"LTB"</span>,
    x <span class='op'>=</span> <span class='st'>"cluster"</span>,
    exprs_values <span class='op'>=</span> <span class='st'>"log2cpm"</span>,
    colour_by <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>axis.text.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>45</span>, hjust <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_colour_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>cluster_colours</span>, name <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span>,
  
  <span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotExpression.html'>plotExpression</a></span><span class='op'>(</span>
    <span class='va'>sce</span>,
    features <span class='op'>=</span> <span class='st'>"IFITM3"</span>,
    x <span class='op'>=</span> <span class='st'>"cluster"</span>,
    exprs_values <span class='op'>=</span> <span class='st'>"log2cpm"</span>,
    colour_by <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>axis.text.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>45</span>, hjust <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_colour_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>cluster_colours</span>, name <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span>,

  <span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotExpression.html'>plotExpression</a></span><span class='op'>(</span>
    <span class='va'>sce</span>,
    features <span class='op'>=</span> <span class='st'>"TOMM7"</span>,
    x <span class='op'>=</span> <span class='st'>"cluster"</span>,
    exprs_values <span class='op'>=</span> <span class='st'>"log2cpm"</span>,
    colour_by <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>axis.text.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>45</span>, hjust <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_colour_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>cluster_colours</span>, name <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span>,

  <span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotExpression.html'>plotExpression</a></span><span class='op'>(</span>
    <span class='va'>sce</span>,
    features <span class='op'>=</span> <span class='st'>"S100A10"</span>,
    x <span class='op'>=</span> <span class='st'>"cluster"</span>,
    exprs_values <span class='op'>=</span> <span class='st'>"log2cpm"</span>,
    colour_by <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>axis.text.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>45</span>, hjust <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_colour_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>cluster_colours</span>, name <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span>,
      
  <span class='co'># cluster 10 and 11</span>
  <span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotExpression.html'>plotExpression</a></span><span class='op'>(</span>
    <span class='va'>sce</span>,
    features <span class='op'>=</span> <span class='st'>"AC009022.1"</span>,
    x <span class='op'>=</span> <span class='st'>"cluster"</span>,
    exprs_values <span class='op'>=</span> <span class='st'>"log2cpm"</span>,
    colour_by <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>axis.text.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>45</span>, hjust <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_colour_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>cluster_colours</span>, name <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span>,
  
  <span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotExpression.html'>plotExpression</a></span><span class='op'>(</span>
    <span class='va'>sce</span>,
    features <span class='op'>=</span> <span class='st'>"SYNE2"</span>,
    x <span class='op'>=</span> <span class='st'>"cluster"</span>,
    exprs_values <span class='op'>=</span> <span class='st'>"log2cpm"</span>,
    colour_by <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>axis.text.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>45</span>, hjust <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_colour_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>cluster_colours</span>, name <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span>,

  <span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotExpression.html'>plotExpression</a></span><span class='op'>(</span>
    <span class='va'>sce</span>,
    features <span class='op'>=</span> <span class='st'>"KLRD1"</span>,
    x <span class='op'>=</span> <span class='st'>"cluster"</span>,
    exprs_values <span class='op'>=</span> <span class='st'>"log2cpm"</span>,
    colour_by <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>axis.text.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>45</span>, hjust <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_colour_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>cluster_colours</span>, name <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span>,
    
  <span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotExpression.html'>plotExpression</a></span><span class='op'>(</span>
    <span class='va'>sce</span>,
    features <span class='op'>=</span> <span class='st'>"CCL5"</span>,
    x <span class='op'>=</span> <span class='st'>"cluster"</span>,
    exprs_values <span class='op'>=</span> <span class='st'>"log2cpm"</span>,
    colour_by <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>axis.text.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>45</span>, hjust <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_colour_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>cluster_colours</span>, name <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span>,
    
  <span class='co'># cluster 12</span>
  <span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotExpression.html'>plotExpression</a></span><span class='op'>(</span>
    <span class='va'>sce</span>,
    features <span class='op'>=</span> <span class='st'>"ACTG1"</span>,
    x <span class='op'>=</span> <span class='st'>"cluster"</span>,
    exprs_values <span class='op'>=</span> <span class='st'>"log2cpm"</span>,
    colour_by <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>axis.text.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>45</span>, hjust <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_colour_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>cluster_colours</span>, name <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span>,
  
  <span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotExpression.html'>plotExpression</a></span><span class='op'>(</span>
    <span class='va'>sce</span>,
    features <span class='op'>=</span> <span class='st'>"MBNL1"</span>,
    x <span class='op'>=</span> <span class='st'>"cluster"</span>,
    exprs_values <span class='op'>=</span> <span class='st'>"log2cpm"</span>,
    colour_by <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>axis.text.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>45</span>, hjust <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_colour_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>cluster_colours</span>, name <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span>,

  <span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotExpression.html'>plotExpression</a></span><span class='op'>(</span>
    <span class='va'>sce</span>,
    features <span class='op'>=</span> <span class='st'>"CAPZA1"</span>,
    x <span class='op'>=</span> <span class='st'>"cluster"</span>,
    exprs_values <span class='op'>=</span> <span class='st'>"log2cpm"</span>,
    colour_by <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>axis.text.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>45</span>, hjust <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_colour_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>cluster_colours</span>, name <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span>,

  <span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotExpression.html'>plotExpression</a></span><span class='op'>(</span>
    <span class='va'>sce</span>,
    features <span class='op'>=</span> <span class='st'>"SLK"</span>,
    x <span class='op'>=</span> <span class='st'>"cluster"</span>,
    exprs_values <span class='op'>=</span> <span class='st'>"log2cpm"</span>,
    colour_by <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>axis.text.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>45</span>, hjust <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_colour_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>cluster_colours</span>, name <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span>,

  <span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotExpression.html'>plotExpression</a></span><span class='op'>(</span>
    <span class='va'>sce</span>,
    features <span class='op'>=</span> <span class='st'>"CD1E"</span>,
    x <span class='op'>=</span> <span class='st'>"cluster"</span>,
    exprs_values <span class='op'>=</span> <span class='st'>"log2cpm"</span>,
    colour_by <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>axis.text.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>45</span>, hjust <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_colour_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>cluster_colours</span>, name <span class='op'>=</span> <span class='st'>"cluster"</span><span class='op'>)</span>,
        
  ncol <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span id="fig:violin-key-markers-cluster"></span>
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/violin-key-markers-cluster-1.png" alt="Violin plot showing the expression of key markers stratified by clusters" width="624" />
<p class="caption">
Figure 23: Violin plot showing the expression of key markers stratified by clusters
</p>
</div>
</div>
<h3 id="expression-of-minibulk-de-in-the-single-cell-dataset">Expression of minibulk DE in the single-cell dataset</h3>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>###############################################</span>
<span class='co'># Heatmap using minibulk sig markers as feature</span>

<span class='co'># laod package for read in csv.gz</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://r-datatable.com'>data.table</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/HenrikBengtsson/R.utils'>R.utils</a></span><span class='op'>)</span>

<span class='co'># read in</span>
<span class='va'>a</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/fread.html'>fread</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"output"</span>, <span class='st'>"DEGs"</span>, <span class='st'>"excluding_blood_1-3"</span>, <span class='st'>"Thymus.S3_vs_Blood.S3.aggregated_tech_reps.DEGs.csv.gz"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># extract DEGlist (FDR &lt; 0.05)</span>
<span class='va'>minibulkDEG.a</span> <span class='op'>&lt;-</span> <span class='va'>a</span><span class='op'>$</span><span class='va'>ENSEMBL.GENENAME</span><span class='op'>[</span><span class='va'>a</span><span class='op'>$</span><span class='va'>FDR</span><span class='op'>&lt;</span><span class='fl'>0.05</span><span class='op'>]</span>

<span class='co'># keep only unique markers</span>
<span class='va'>uniq.minibulkDEG.a</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/funprog.html'>Reduce</a></span><span class='op'>(</span><span class='va'>setdiff</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>minibulkDEG.a</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># check number of unique minibulkDEG in each</span>
<span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>uniq.minibulkDEG.a</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>[1] 20</code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># keep only top50</span>
<span class='va'>top.uniq.minibulkDEG.a</span> <span class='op'>&lt;-</span> <span class='kw'>if</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>uniq.minibulkDEG.a</span><span class='op'>)</span> <span class='op'>&gt;=</span><span class='fl'>50</span><span class='op'>)</span><span class='op'>{</span><span class='va'>uniq.minibulkDEG.a</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>50</span><span class='op'>]</span><span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span><span class='va'>uniq.minibulkDEG.a</span><span class='op'>}</span>
<span class='va'>minibulk_markers</span> <span class='op'>&lt;-</span> <span class='va'>top.uniq.minibulkDEG.a</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://bioconductor.org/packages/scater/'>scater</a></span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>sce</span>,
  features <span class='op'>=</span> <span class='va'>minibulk_markers</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/setorder.html'>order</a></span><span class='op'>(</span>
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>cluster</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>plate_number</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"cluster"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"group"</span>,
    <span class='st'>"plate_number"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='co'># TODO: temp trick to deal with the row-colouring problem</span>
  annotation_row <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    thymus.s3.vs.blood.s3 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/fifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>minibulk_markers</span> <span class='op'>%in%</span> <span class='va'>top.uniq.minibulkDEG.a</span>, <span class='st'>"DE"</span>, <span class='st'>"not DE"</span><span class='op'>)</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"DE"</span><span class='op'>)</span><span class='op'>)</span>,
    row.names <span class='op'>=</span> <span class='va'>minibulk_markers</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='st'>"Row-normalized log expression of top unique markers from minibulk against different clusters"</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    cluster <span class='op'>=</span> <span class='va'>cluster_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span id="fig:heat-minibulk-by-cluster"></span>
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-minibulk-by-cluster-1.png" alt="Heatmap of log-expression values in each sample for the marker genes identified from the mini-bulk analysis. Cells are ordered by `cluster`. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range." width="624" />
<p class="caption">
Figure 24: Heatmap of log-expression values in each sample for the marker genes identified from the mini-bulk analysis. Cells are ordered by <code>cluster</code>. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range.
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://bioconductor.org/packages/scater/'>scater</a></span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>sce</span>,
  features <span class='op'>=</span> <span class='va'>minibulk_markers</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/setorder.html'>order</a></span><span class='op'>(</span>
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>plate_number</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"group"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"plate_number"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='co'># TODO: temp trick to deal with the row-colouring problem</span>
  annotation_row <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    thymus.s3.vs.blood.s3 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/fifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>minibulk_markers</span> <span class='op'>%in%</span> <span class='va'>top.uniq.minibulkDEG.a</span>, <span class='st'>"DE"</span>, <span class='st'>"not DE"</span><span class='op'>)</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"DE"</span><span class='op'>)</span><span class='op'>)</span>,
    row.names <span class='op'>=</span> <span class='va'>minibulk_markers</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='st'>"Row-normalized log expression of top unique markers from minibulk against different groups"</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span id="fig:heat-minibulk-by-group"></span>
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-minibulk-by-group-1.png" alt="Heatmap of log-expression values in each sample for the marker genes identified from the mini-bulk analysis. Cells are ordered by `group`. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range." width="624" />
<p class="caption">
Figure 25: Heatmap of log-expression values in each sample for the marker genes identified from the mini-bulk analysis. Cells are ordered by <code>group</code>. Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range.
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://bioconductor.org/packages/scater/'>scater</a></span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/scater/man/plotHeatmap.html'>plotHeatmap</a></span><span class='op'>(</span>
  <span class='va'>sce</span>,
  features <span class='op'>=</span> <span class='va'>minibulk_markers</span>,
  columns <span class='op'>=</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/setorder.html'>order</a></span><span class='op'>(</span>
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>group</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>stage</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>tissue</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>donor</span>,
    <span class='va'>sce</span><span class='op'>$</span><span class='va'>plate_number</span><span class='op'>)</span>,
  colour_columns_by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"group"</span>,
    <span class='st'>"stage"</span>,
    <span class='st'>"tissue"</span>,
    <span class='st'>"donor"</span>,
    <span class='st'>"plate_number"</span><span class='op'>)</span>,
  cluster_cols <span class='op'>=</span> <span class='cn'>TRUE</span>,
  center <span class='op'>=</span> <span class='cn'>TRUE</span>,
  symmetric <span class='op'>=</span> <span class='cn'>TRUE</span>,
  zlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,
  show_colnames <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='co'># TODO: temp trick to deal with the row-colouring problem</span>
  annotation_row <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    thymus.s3.vs.blood.s3 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/fifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>minibulk_markers</span> <span class='op'>%in%</span> <span class='va'>top.uniq.minibulkDEG.a</span>, <span class='st'>"DE"</span>, <span class='st'>"not DE"</span><span class='op'>)</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"DE"</span><span class='op'>)</span><span class='op'>)</span>,
    row.names <span class='op'>=</span> <span class='va'>minibulk_markers</span><span class='op'>)</span>,
  main <span class='op'>=</span> <span class='st'>"Row-normalized log expression of top unique markers from minibulk against different groups (column-clustered)"</span>,
  column_annotation_colors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    group <span class='op'>=</span> <span class='va'>group_colours</span>,
    stage <span class='op'>=</span> <span class='va'>stage_colours</span>,
    tissue <span class='op'>=</span> <span class='va'>tissue_colours</span>,
    donor <span class='op'>=</span> <span class='va'>donor_colours</span>,
    plate_number <span class='op'>=</span> <span class='va'>plate_number_colours</span><span class='op'>)</span>,
  color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>hcl.colors</a></span><span class='op'>(</span><span class='fl'>101</span>, <span class='st'>"Blue-Red 3"</span><span class='op'>)</span>,
  fontsize <span class='op'>=</span> <span class='fl'>7</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span id="fig:heat-minibulk-by-group-clustcol"></span>
<img src="C094_Pellicci.single-cell.annotate.S3_only_files/heat-minibulk-by-group-clustcol-1.png" alt="Heatmap of log-expression values in each sample for the marker genes identified from the mini-bulk analysis. Cells are ordered by `group` (column-clustered). Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range." width="624" />
<p class="caption">
Figure 26: Heatmap of log-expression values in each sample for the marker genes identified from the mini-bulk analysis. Cells are ordered by <code>group</code> (column-clustered). Each column is a sample, each row a gene. Colours are capped at -3 and 3 to preserve dynamic range.
</p>
</div>
</div>
<h1 class="appendix" id="session-info">Session info</h1>
<summary>
The analysis and this document were prepared using the following software (click triangle to expand)
</summary>
<details>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>sessioninfo</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/sessioninfo/man/session_info.html'>session_info</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>─ Session info ─────────────────────────────────────────────────────
 setting  value                       
 version  R version 4.0.3 (2020-10-10)
 os       CentOS Linux 7 (Core)       
 system   x86_64, linux-gnu           
 ui       X11                         
 language (EN)                        
 collate  en_US.UTF-8                 
 ctype    en_US.UTF-8                 
 tz       Australia/Melbourne         
 date     2021-09-07                  

─ Packages ─────────────────────────────────────────────────────────
 ! package              * version  date       lib
 P annotate               1.68.0   2020-10-27 [?]
 P AnnotationDbi          1.52.0   2020-10-27 [?]
 P assertthat             0.2.1    2019-03-21 [?]
 P batchelor            * 1.6.3    2021-04-16 [?]
 P beachmat               2.6.4    2020-12-20 [?]
 P beeswarm               0.3.1    2021-03-07 [?]
 P Biobase              * 2.50.0   2020-10-27 [?]
 P BiocGenerics         * 0.36.0   2020-10-27 [?]
 P BiocManager            1.30.12  2021-03-28 [?]
 P BiocNeighbors          1.8.2    2020-12-07 [?]
 P BiocParallel         * 1.24.1   2020-11-06 [?]
 P BiocSingular           1.6.0    2020-10-27 [?]
 P BiocStyle            * 2.18.1   2020-11-24 [?]
 P bit                    4.0.4    2020-08-04 [?]
 P bit64                  4.0.5    2020-08-30 [?]
 P bitops                 1.0-6    2013-08-17 [?]
 P blob                   1.2.1    2020-01-20 [?]
 P bluster                1.0.0    2020-10-27 [?]
 P bslib                  0.2.4    2021-01-25 [?]
 P cachem                 1.0.4    2021-02-13 [?]
 P cellranger             1.1.0    2016-07-27 [?]
 P cli                    2.4.0    2021-04-05 [?]
 P colorspace             2.0-0    2020-11-11 [?]
 P cowplot              * 1.1.1    2020-12-30 [?]
 P crayon                 1.4.1    2021-02-08 [?]
 P data.table           * 1.14.0   2021-02-21 [?]
 P DBI                    1.1.1    2021-01-15 [?]
 P DelayedArray           0.16.3   2021-03-24 [?]
 P DelayedMatrixStats     1.12.3   2021-02-03 [?]
 P DESeq2                 1.30.1   2021-02-19 [?]
 P digest                 0.6.27   2020-10-24 [?]
 P distill                1.2      2021-01-13 [?]
 P downlit                0.2.1    2020-11-04 [?]
 P dplyr                * 1.0.5    2021-03-05 [?]
 P dqrng                  0.2.1    2019-05-17 [?]
 P edgeR                * 3.32.1   2021-01-14 [?]
 P ellipsis               0.3.1    2020-05-15 [?]
 P evaluate               0.14     2019-05-28 [?]
 P fansi                  0.4.2    2021-01-15 [?]
 P farver                 2.1.0    2021-02-28 [?]
 P fastmap                1.1.0    2021-01-25 [?]
 P genefilter             1.72.1   2021-01-21 [?]
 P geneplotter            1.68.0   2020-10-27 [?]
 P generics               0.1.0    2020-10-31 [?]
 P GenomeInfoDb         * 1.26.4   2021-03-10 [?]
 P GenomeInfoDbData       1.2.4    2020-12-07 [?]
 P GenomicRanges        * 1.42.0   2020-10-27 [?]
 P ggbeeswarm             0.6.0    2017-08-07 [?]
 P ggplot2              * 3.3.3    2020-12-30 [?]
 P ggrepel              * 0.9.1    2021-01-15 [?]
 P Glimma               * 2.0.0    2020-10-27 [?]
 P glue                   1.4.2    2020-08-27 [?]
 P gridExtra              2.3      2017-09-09 [?]
 P gtable                 0.3.0    2019-03-25 [?]
 P here                 * 1.0.1    2020-12-13 [?]
   highr                  0.9      2021-04-16 [1]
 P htmltools              0.5.1.1  2021-01-22 [?]
 P htmlwidgets            1.5.3    2020-12-10 [?]
 P httr                   1.4.2    2020-07-20 [?]
 P igraph                 1.2.6    2020-10-06 [?]
 P IRanges              * 2.24.1   2020-12-12 [?]
 P irlba                  2.3.3    2019-02-05 [?]
 P janitor              * 2.1.0    2021-01-05 [?]
 P jquerylib              0.1.3    2020-12-17 [?]
 P jsonlite               1.7.2    2020-12-09 [?]
   knitr                  1.33     2021-04-24 [1]
 P labeling               0.4.2    2020-10-20 [?]
 P lattice                0.20-41  2020-04-02 [3]
 P lifecycle              1.0.0    2021-02-15 [?]
 P limma                * 3.46.0   2020-10-27 [?]
 P locfit                 1.5-9.4  2020-03-25 [?]
 P lubridate              1.7.10   2021-02-26 [?]
 P magrittr             * 2.0.1    2020-11-17 [?]
 P Matrix                 1.2-18   2019-11-27 [3]
 P MatrixGenerics       * 1.2.1    2021-01-30 [?]
 P matrixStats          * 0.58.0   2021-01-29 [?]
 P memoise                2.0.0    2021-01-26 [?]
 P msigdbr              * 7.2.1    2020-10-02 [?]
 P munsell                0.5.0    2018-06-12 [?]
 P patchwork            * 1.1.1    2020-12-17 [?]
 P pheatmap             * 1.0.12   2019-01-04 [?]
 P pillar                 1.5.1    2021-03-05 [?]
 P pkgconfig              2.0.3    2019-09-22 [?]
 P purrr                  0.3.4    2020-04-17 [?]
 P R.methodsS3          * 1.8.1    2020-08-26 [?]
 P R.oo                 * 1.24.0   2020-08-26 [?]
 P R.utils              * 2.10.1   2020-08-26 [?]
 P R6                     2.5.0    2020-10-28 [?]
 P RColorBrewer           1.1-2    2014-12-07 [?]
 P Rcpp                   1.0.6    2021-01-15 [?]
 P RCurl                  1.98-1.3 2021-03-16 [?]
 P readxl               * 1.3.1    2019-03-13 [?]
 P ResidualMatrix         1.0.0    2020-10-27 [?]
   rlang                  0.4.11   2021-04-30 [1]
 P rmarkdown            * 2.7      2021-02-19 [?]
 P rprojroot              2.0.2    2020-11-15 [?]
 P RSQLite                2.2.5    2021-03-27 [?]
 P rsvd                   1.0.3    2020-02-17 [?]
 P S4Vectors            * 0.28.1   2020-12-09 [?]
 P sass                   0.3.1    2021-01-24 [?]
 P scales                 1.1.1    2020-05-11 [?]
 P scater               * 1.18.6   2021-02-26 [?]
 P scran                * 1.18.5   2021-02-04 [?]
 P scuttle                1.0.4    2020-12-17 [?]
 P sessioninfo            1.1.1    2018-11-05 [?]
 P SingleCellExperiment * 1.12.0   2020-10-27 [?]
 P snakecase              0.11.0   2019-05-25 [?]
 P sparseMatrixStats      1.2.1    2021-02-02 [?]
 P statmod                1.4.35   2020-10-19 [?]
   stringi                1.7.3    2021-07-16 [1]
 P stringr                1.4.0    2019-02-10 [?]
 P SummarizedExperiment * 1.20.0   2020-10-27 [?]
 P survival               3.2-7    2020-09-28 [3]
 P tibble                 3.1.0    2021-02-25 [?]
 P tidyr                * 1.1.3    2021-03-03 [?]
 P tidyselect             1.1.0    2020-05-11 [?]
 P utf8                   1.2.1    2021-03-12 [?]
 P vctrs                  0.3.7    2021-03-29 [?]
 P vipor                  0.4.5    2017-03-22 [?]
 P viridis                0.5.1    2018-03-29 [?]
 P viridisLite            0.3.0    2018-02-01 [?]
 P withr                  2.4.1    2021-01-26 [?]
   xaringanExtra          0.5.4    2021-07-22 [1]
   xfun                   0.24     2021-06-15 [1]
 P XML                    3.99-0.6 2021-03-16 [?]
 P xtable                 1.8-4    2019-04-21 [?]
 P XVector                0.30.0   2020-10-27 [?]
 P yaml                   2.2.1    2020-02-01 [?]
 P zlibbioc               1.36.0   2020-10-27 [?]
 source                                  
 Bioconductor                            
 Bioconductor                            
 CRAN (R 4.0.0)                          
 Bioconductor                            
 Bioconductor                            
 CRAN (R 4.0.2)                          
 Bioconductor                            
 Bioconductor                            
 CRAN (R 4.0.3)                          
 Bioconductor                            
 Bioconductor                            
 Bioconductor                            
 Bioconductor                            
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.0)                          
 Bioconductor                            
 CRAN (R 4.0.2)                          
 CRAN (R 4.0.2)                          
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.3)                          
 CRAN (R 4.0.2)                          
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.3)                          
 CRAN (R 4.0.2)                          
 CRAN (R 4.0.2)                          
 Bioconductor                            
 Bioconductor                            
 Bioconductor                            
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.2)                          
 CRAN (R 4.0.0)                          
 Bioconductor                            
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.2)                          
 CRAN (R 4.0.2)                          
 CRAN (R 4.0.2)                          
 Bioconductor                            
 Bioconductor                            
 CRAN (R 4.0.0)                          
 Bioconductor                            
 Bioconductor                            
 Bioconductor                            
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.2)                          
 CRAN (R 4.0.5)                          
 Bioconductor                            
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.3)                          
 CRAN (R 4.0.2)                          
 CRAN (R 4.0.2)                          
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.0)                          
 Bioconductor                            
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.3)                          
 CRAN (R 4.0.2)                          
 CRAN (R 4.0.2)                          
 CRAN (R 4.0.3)                          
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.3)                          
 CRAN (R 4.0.2)                          
 Bioconductor                            
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.3)                          
 CRAN (R 4.0.2)                          
 CRAN (R 4.0.3)                          
 Bioconductor                            
 CRAN (R 4.0.2)                          
 CRAN (R 4.0.2)                          
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.2)                          
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.2)                          
 CRAN (R 4.0.5)                          
 CRAN (R 4.0.0)                          
 Bioconductor                            
 CRAN (R 4.0.3)                          
 CRAN (R 4.0.2)                          
 CRAN (R 4.0.2)                          
 CRAN (R 4.0.3)                          
 CRAN (R 4.0.0)                          
 Bioconductor                            
 CRAN (R 4.0.2)                          
 CRAN (R 4.0.0)                          
 Bioconductor                            
 Bioconductor                            
 Bioconductor                            
 CRAN (R 4.0.0)                          
 Bioconductor                            
 CRAN (R 4.0.0)                          
 Bioconductor                            
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.3)                          
 CRAN (R 4.0.0)                          
 Bioconductor                            
 CRAN (R 4.0.3)                          
 CRAN (R 4.0.2)                          
 CRAN (R 4.0.3)                          
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.2)                          
 CRAN (R 4.0.3)                          
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.0)                          
 CRAN (R 4.0.2)                          
 Github (gadenbuie/xaringanExtra@5e2d80b)
 CRAN (R 4.0.3)                          
 CRAN (R 4.0.5)                          
 CRAN (R 4.0.0)                          
 Bioconductor                            
 CRAN (R 4.0.0)                          
 Bioconductor                            

[1] /stornext/Home/data/allstaff/h/ho.w/C094_Pellicci/renv/library/R-4.0/x86_64-pc-linux-gnu
[2] /tmp/RtmpEfHIyA/renv-system-library
[3] /stornext/System/data/apps/R/R-4.0.3/lib64/R/library

 P ── Loaded and on-disk path mismatch.</code></pre>
</div>
</details>
<div class="sourceCode" id="cb3"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-soneson2018bias" class="csl-entry" role="doc-biblioentry">
Soneson, C., and M. D. Robinson. 2018. <span>“Bias, Robustness and Scalability in Single-Cell Differential Expression Analysis.”</span> <em>Nat. Methods</em> 15 (4): 255–61. <a href="https://www.ncbi.nlm.nih.gov/pubmed/29481549">https://www.ncbi.nlm.nih.gov/pubmed/29481549</a>.
</div>
</div>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>Differential expression analyses is performed on the original log-expression values. We do not use the MNN-corrected values here except to obtain the clusters to be characterized.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
<h3 id="references">References</h3>
<div id="references-listing"></div>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
